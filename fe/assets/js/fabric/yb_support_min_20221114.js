var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(p){return p.raw=p};$jscomp.createTemplateTagFirstArgWithRaw=function(p,u){p.raw=u;return p};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(p,u,q){if(p==Array.prototype||p==Object.prototype)return p;p[u]=q.value;return p};$jscomp.getGlobal=function(p){p=["object"==typeof globalThis&&globalThis,p,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var u=0;u<p.length;++u){var q=p[u];if(q&&q.Math==Math)return q}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(p,u){var q=$jscomp.propertyToPolyfillSymbol[u];if(null==q)return p[u];q=p[q];return void 0!==q?q:p[u]};
$jscomp.polyfill=function(p,u,q,t){u&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(p,u,q,t):$jscomp.polyfillUnisolated(p,u,q,t))};$jscomp.polyfillUnisolated=function(p,u,q,t){q=$jscomp.global;p=p.split(".");for(t=0;t<p.length-1;t++){var x=p[t];if(!(x in q))return;q=q[x]}p=p[p.length-1];t=q[p];u=u(t);u!=t&&null!=u&&$jscomp.defineProperty(q,p,{configurable:!0,writable:!0,value:u})};
$jscomp.polyfillIsolated=function(p,u,q,t){var x=p.split(".");p=1===x.length;t=x[0];t=!p&&t in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var X=0;X<x.length-1;X++){var M=x[X];if(!(M in t))return;t=t[M]}x=x[x.length-1];q=$jscomp.IS_SYMBOL_NATIVE&&"es6"===q?t[x]:null;u=u(q);null!=u&&(p?$jscomp.defineProperty($jscomp.polyfills,x,{configurable:!0,writable:!0,value:u}):u!==q&&(void 0===$jscomp.propertyToPolyfillSymbol[x]&&(q=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[x]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(x):$jscomp.POLYFILL_PREFIX+q+"$"+x),$jscomp.defineProperty(t,$jscomp.propertyToPolyfillSymbol[x],{configurable:!0,writable:!0,value:u})))};$jscomp.polyfill("Array.prototype.fill",function(p){return p?p:function(u,q,t){var x=this.length||0;0>q&&(q=Math.max(0,x+q));if(null==t||t>x)t=x;t=Number(t);0>t&&(t=Math.max(0,x+t));for(q=Number(q||0);q<t;q++)this[q]=u;return this}},"es6","es3");$jscomp.typedArrayFill=function(p){return p?p:Array.prototype.fill};
$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$(document).ready(function(){function p(a){if(a)if("CzImage"==S){$(".image_menus").hide();var c=a.getBoundingRect();a=c.width;var d=c.height,e=c.left;c=c.top;ma=e;a<fa?ma=e-(fa-a)/2:a>fa&&(ma=e+(a-fa)/2);Y=e;a<Y?Y=e-(Da-a)/2:a>Y&&(Y=e+(a-Da)/2);$("#top_image_menu").css({position:"absolute",top:c-bb-yb+"px",left:Y+"px"});$("#bot_image_menu").css({position:"absolute",top:c+d+cb+"px",left:ma+"px"});$(".image_menus").show()}else"Textbox"==S&&($(".text_menus").hide(),c=a.getBoundingRect(),a=c.width,d=
c.height,e=c.left,c=c.top,na=e,a<ha?na=e-(ha-a)/2:a>ha&&(na=e+(a-ha)/2),Z=e,a<Z?Z=e-(Ea-a)/2:a>Z&&(Z=e+(a-Ea)/2),$("#top_text_menu").css({position:"absolute",top:c-bb-zb+"px",left:Z+"px"}),$("#bot_text_menu").css({position:"absolute",top:c+d+cb+"px",left:na+"px"}),$(".text_menus").show())}function u(){f.forEachObject(function(a){"CzImage"!==a.type||"border"==a.graphic||a.panel||("clipTo"in a&&a.clipTo&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?
v.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||0!=a.cx||0!=a.cy||a.cw!=a.width||a.ch!=a.height)&&v.frame_round_border(null,a))})}function q(){f.forEachObject(function(a){"CzImage"===a.type?(a.stateProperties.push("borderDashArray","filters","frame_round_border","my","cw","ch"),a.saveState()):"Textbox"===a.type&&(a.stateProperties.push("borderDashArray","filters","my"),a.saveState())})}function t(a,c,d){setTimeout(function(){if(d){var e=oa();N({stroke:1,strokeWidth:1,strokeDashArray:1,
strokeLineJoin:1,oval_width:e.oval_width,oval_height:e.oval_height,radius:e.radius},!1)}setTimeout(function(){c&&f.getActiveObject().applyFilters(f.renderAll.bind(f));a&&x()},200)},100);y=!0}function x(){f.off("mouse:move");cropping=!1;f.item(T).lockMovementX=f.item(T).lockMovementY=!1;f.item(T).lockScalingX=f.item(T).lockScalingY=!1;f.item(T).lockRotation=!1;f.item(T).setControlsVisibility({br:!0,bl:!0});$("#crop_parent").remove();$("#zoom_div").hide();$(".image_menu_divs").show()}function X(){pa=
!1;clearInterval(db);qa=!0;Fa?Fa=!1:t(!1,!0,!0);ra=!1;ia=0}function M(a,c){var d=null;0<a.filters.length&&$.each(a.filters,function(e,b){if(b&&b.type.toLowerCase()==c.toLowerCase())return d=e,!1});return d}function sa(a,c){"brightness"==a?$("#brightness_image_value_text").html("Brightness:&nbsp;&nbsp;"+c):"contrast"==a&&$("#contrast_image_value_text").html("Contrast:&nbsp;&nbsp;"+c)}function Ga(a,c){$("#shadow_"+a+"_blur_text").html("Blur:&nbsp;&nbsp;"+c.blur);$("#shadow_"+a+"_offsetx_text").html("Offset-X:&nbsp;&nbsp;"+
c.offsetX);$("#shadow_"+a+"_offsety_text").html("Offset-Y:&nbsp;&nbsp;"+c.offsetY)}function eb(a){$("#font_text_fontlineheight_text").html("Line Height:&nbsp;&nbsp;"+a.lineHeight);$("#font_text_fontstrokewidth_text").html("Stroke Width:&nbsp;&nbsp;"+a.strokeWidth)}function fb(){return{lineHeight:$("#font_text_fontlineheight").val(),strokeWidth:$("#font_text_fontstrokewidth").val()}}function N(a,c){var d=$("#border_image_status").val(),e=$("#border_image_frame_style").val(),b=f.getActiveObject(),g=
!1;if(b){"my"in b||(b.my={});if("ON"==d){b.my.hasBorder="ON";var h=$("#border_image_colorpicker").spectrum("get").toRgbString();d=Number($("#border_image_size").val());var k="dashed"==$("#border_image_line_style").val()?[15,10]:[];"CzImage"===b.type&&b.filters.length&&b.set("opacity",.1);a=oa();b.strokeWidth=0;var n=$("#border_image_frame_radius").val(),w=Number(a.oval_width);a=Number(a.oval_height);var z=b.get("width"),D=b.get("height");e={radius:Number(n),rx:w,ry:a,stroke:h,ow:z,oh:D,offsetx:Number($("#border_image_frame_radius_offsetx").val()),
offsety:Number($("#border_image_frame_radius_offsety").val()),strokeWidth:2*d,strokeDashArray:k,style:e};b.my.strokeWidth=d;v.frame_round_border(e,b)}else b.my.hasBorder="OFF",b.stroke="#000000",b.strokeWidth=0,b.strokeDashArray=[],b.strokeLineJoin="miter",v.frame_round_border(null,b);c?Ha(!1):g=!0;g&&gb(b)}}function gb(a){var c=$("#opacity_image_value").val();"CzImage"===a.type&&a.filters.length?setTimeout(function(){a.applyFilters(f.renderAll.bind(f));a.set("opacity",.01*c);f.renderAll()},150):
(a.set("opacity",.01*c),f.renderAll());y=!0;0==qa?E():qa=!1}function hb(a){"round"==a?($(".image_frame").show(),$(".image_frame_oval").hide(),$(".border_image_radius_frame").hide()):"oval"==a?($(".image_frame").show(),$(".image_frame_round").hide(),$(".border_image_radius_frame").hide()):"square"==a&&($(".image_frame").hide(),$(".border_image_radius_frame").show());var c=$("#border_image_status").val();"round"!=a&&"oval"!=a||"ON"!=c?$(".shadow_image_btn").attr("disabled",!1):$(".shadow_image_btn").attr("disabled",
!0)}function Ia(a){$("#border_image_frame_radius_text").html("Radius:&nbsp;&nbsp;"+a.radius);$("#border_image_frame_radius_offsetx_text").html("Offset-X:&nbsp;&nbsp;"+a.offsetx);$("#border_image_frame_radius_offsety_text").html("Offset-Y:&nbsp;&nbsp;"+a.offsety);$("#border_image_frame_radius_width_text").html("Width:&nbsp;&nbsp;"+a.oval_width);$("#border_image_frame_radius_height_text").html("Height:&nbsp;&nbsp;"+a.oval_height)}function oa(){return{radius:$("#border_image_frame_radius").val(),offsetx:$("#border_image_frame_radius_offsetx").val(),
offsety:$("#border_image_frame_radius_offsety").val(),oval_width:$("#border_image_frame_radius_width").val(),oval_height:$("#border_image_frame_radius_height").val()}}function Ha(a){var c=$("#border_image_status").val(),d=f.getActiveObject(),e=!1,b=oa();Ia(b);"my"in d||(d.my={});d.my.radius=b.radius;d.my.offsetx=b.offsetx;d.my.offsety=b.offsety;d.my.oval_width=b.oval_width;d.my.oval_height=b.oval_height;var g=$("#border_image_frame_style").val();d.my.frame_style=g;if("ON"==c){d.my.hasBorder="ON";
"CzImage"===d.type&&d.filters.length&&d.set("opacity",.1);d.shadow=null;var h=d.get("width");c=d.get("height");if("round"==g)g=h>c?b.radius/100*(c/2):b.radius/100*(h/2),h=b.offsetx/100*(h/2)*((h/2-g)/(h/2)),c=b.offsety/100*(c/2)*((c/2-g)/(c/2)),d.my.x=h,d.my.y=c,d.my.circle_radius=g,d.clipTo=function(n){n.arc(this.my.x,this.my.y,this.my.circle_radius,0,2*Math.PI,!1)};else if("square"==g){g=b.oval_width;var k=b.oval_height;g=g/100*h;k=k/100*c;h=b.offsetx/100*(h/2)*((h/2-g/2)/(h/2));c=b.offsety/100*
(c/2)*((c/2-k/2)/(c/2));d.my.x=h;d.my.y=c;d.my.oval_rx=g;d.my.oval_ry=k;d.opacity=1;d.hasBorders=!1;d.my.strokeWidth=Number($("#border_image_size").val());d.my.stroke=$("#border_image_colorpicker").spectrum("get").toRgbString();d.my.corner_radius=Number($("#border_image_radius").val());d.clipTo=function(n){fabric.Object.drawRoundRect(n,this.my.x,this.my.y,this.width,this.height,this.my.corner_radius)}}else g=b.oval_width,k=b.oval_height,g=g/100*h,k=k/100*c,h=b.offsetx/100*(h/2)*((h/2-g/2)/(h/2)),
c=b.offsety/100*(c/2)*((c/2-k/2)/(c/2)),d.my.x=h,d.my.y=c,d.my.oval_rx=g,d.my.oval_ry=k,d.clipTo=function(n){fabric.Object.drawEllipse(n,this.my.x,this.my.y,1.3*this.my.oval_rx,this.my.oval_ry)};a?(a={stroke:1,strokeWidth:1,strokeDashArray:1,strokeLineJoin:1,oval_width:b.oval_width,oval_height:b.oval_height,radius:b.radius},N(a,!1)):e=!0}else d.my.hasBorder="OFF",d.clipTo=null,a?(a={},N(a,!1)):e=!0;e&&gb(d)}function Ja(){var a=new BigNumber(f.width),c=new BigNumber($("#canvas_size").width());new BigNumber(1);
if(f.width!=$("#canvas_size").width()){$(".all_menus").remove();f.deactivateAll();c=c.div(a);m=m?Number(c.times(m).toFixed(C)):a.lt(aa)?Number(c.times(a.div(aa)).toFixed(C)):Number(c.times(aa.div(a)).toFixed(C));a=f.getObjects();for(var d in a)a[d].scaleX=Number(c.times(a[d].scaleX).toFixed(C)),a[d].scaleY=Number(c.times(a[d].scaleY).toFixed(C)),a[d].left=Number(c.times(a[d].left).toFixed(C)),a[d].top=Number(c.times(a[d].top).toFixed(C)),a[d].setCoords();f.backgroundImage&&(f.backgroundImage.scaleX=
Number(c.times(f.backgroundImage.scaleX).toFixed(C)),f.backgroundImage.scaleY=Number(c.times(f.backgroundImage.scaleY).toFixed(C)));d=Number(c.times(f.getWidth()).toFixed(C));c=Number(c.times(f.getHeight()).toFixed(C));f.setWidth(d);f.setHeight(c);f.renderAll();f.calcOffset();$("#canvas_div").css("width",d);$("#canvas_div").css("height",c)}else c=a.div(c),m=m?Number(c.times(m).toFixed(C)):a.lt(aa)?Number(c.times(a.div(aa)).toFixed(C)):Number(c.times(aa.div(a)).toFixed(C))}function ib(){$(".all_menus").remove();
f.deactivateAll();new BigNumber(1);var a=new BigNumber(m);m+=ta;O+=ta;.2>m?(O=m=.2,$(".canvas-zoom-out").attr("disabled",!0)):$(".canvas-zoom-out").removeAttr("disabled");2<m?(O=m=2,$(".canvas-zoom-in").attr("disabled",!0)):$(".canvas-zoom-in").removeAttr("disabled");a=(new BigNumber(m)).div(a);var c=f.getObjects();for(d in c)c[d].scaleX=Number(a.times(c[d].scaleX).toFixed(C)),c[d].scaleY=Number(a.times(c[d].scaleY).toFixed(C)),c[d].left=Number(a.times(c[d].left).toFixed(C)),c[d].top=Number(a.times(c[d].top).toFixed(C)),
c[d].setCoords();f.backgroundImage&&(f.backgroundImage.scaleX=Number(a.times(f.backgroundImage.scaleX).toFixed(C)),f.backgroundImage.scaleY=Number(a.times(f.backgroundImage.scaleY).toFixed(C)));var d=Number(a.times(f.getWidth()).toFixed(C));a=Number(a.times(f.getHeight()).toFixed(C));f.setWidth(d);f.setHeight(a);f.renderAll();f.calcOffset();$("#canvas_div").css("width",d);$("#canvas_div").css("height",a)}function jb(a){if(a.target){var c=a.target.get("type"),d=a.target.get("name");if("Textbox"==c||
"line"==c&&"gridLine"==d)a.target=null}r&&f.fire("object:over",{e:a})}function kb(a){if(r){var c=!0,d=a.e.target,e=$(r).attr("graphic");if(d&&(-1==d.primarySrc.indexOf("placeholder")&&(c=!1),c&&"clipart"!==e)){d.hoverCursor="crosshair";f.renderAll();var b=$(r).attr("graphic")?$(r).attr("graphic"):null,g=$(r).attr("group_photo")?$(r).attr("group_photo"):null,h=$(r).attr("im_id");var k="im";$(r).attr("group_photo")?k="grp":$(r).attr("graphic")&&(k="gr");var n=document.getElementById(k+"_"+h).naturalWidth,
w=document.getElementById(k+"_"+h).naturalHeight;d.getBoundingRect();console.log(n,w);var z=d.width,D=d.height;console.log("getroundingrect width, height",z,D,m);var G=z/n;var Ka=D/w;k=Math.max(G,Ka);b={x:G<=Ka?d.left+z/2-D*n/(2*w):d.left,y:G>Ka?d.top+D/2-z*w/(2*n):d.top,scalex:k,scaley:k,scale:m,replaced:!0,imageID:h,graphic:b,evented:!0,group_photo:g,opacity:0};d.width==d.height&&--d.width;d.remove();v.init(r.src,b,d)}d&&c&&"clipart"!==e||(a=f.getPointer(a.e.e),b=$(r).attr("graphic")?$(r).attr("graphic"):
null,g=$(r).attr("group_photo")?$(r).attr("group_photo"):null,h=$(r).attr("im_id"),b={x:a.x,y:a.y,scalex:1,scaley:1,scale:m,imageID:h,graphic:b,evented:!0,group_photo:g},v.init(r.src,b));lb();r=null;draggedAdded=ua=y=!0}}function lb(){f.off("object:over",kb);f.off("mouse:move",jb)}function va(a){function c(b){$(".all_menus").remove();f.deactivateAll();f.on("mouse:move",jb);f.on("object:over",kb);$(".item").removeClass("img_dragging");$(this).addClass("img_dragging")}function d(b){$(".item").removeClass("img_dragging")}
$(a+" .check_mark").mousedown(function(){return!1});var e=document.querySelectorAll(a+" img");$.each(e,function(b,g){if($(this).hasClass("check_mark"))return!0;this.addEventListener("dragstart",c,!1);this.addEventListener("dragend",d,!1)});e=document.getElementById("canvas_div");e.addEventListener("dragenter",function(b){this.classList.add("over")},!1);e.addEventListener("dragover",function(b){b=b||event;b.preventDefault();b.dataTransfer.dropEffect="copy";return!1},!1);e.addEventListener("dragleave",
function(b){this.classList.remove("over");lb()},!1);e.addEventListener("drop",function(b){b=b||event;b.preventDefault();r=document.querySelector(a+" img.img_dragging");return!1},!1)}function Ab(){if(0!==wa.length)$.each(wa,function(c,d){f.remove(d)}),wa=[];else{var a=f.getObjects();$(a).reverse().each(function(c,d){"line"==d.type&&"tick"==d.name&&f.remove(d)})}}function Bb(){$.each(B,function(a,c){f.remove(c)});B=[]}function La(){function a(c,d){return new fabric.Line(c,{stroke:d,strokeWidth:1,selectable:!1,
strokeDashArray:[5,5],bottom:!0})}safe1=safe*m;trim1=trim*m;bleed1=bleed*m;gutter1=gutter*m;1==numPages?(B.push(a([safe1,safe1,f.width-safe1,safe1],"green")),B.push(a([f.width-safe1,safe1,f.width-safe1,f.height-safe1],"green")),B.push(a([f.width-safe1,f.height-safe1,safe1,f.height-safe1],"green")),B.push(a([safe1,f.height-safe1,safe1,safe1],"green"))):(B.push(a([safe1,safe1,f.width/2-gutter1,safe1],"green")),B.push(a([f.width/2-gutter1,safe1,f.width/2-gutter1,f.height-safe1],"green")),B.push(a([f.width/
2-gutter1,f.height-safe1,safe1,f.height-safe1],"green")),B.push(a([safe1,f.height-safe1,safe1,safe1],"green")),B.push(a([f.width/2+gutter1,safe1,f.width-safe1,safe1],"green")),B.push(a([f.width-safe1,safe1,f.width-safe1,f.height-safe1],"green")),B.push(a([f.width-safe1,f.height-safe1,f.width/2+gutter1,f.height-safe1],"green")),B.push(a([f.width/2+gutter1,safe1,f.width/2+gutter1,f.height-safe1],"green")));B.push(a([trim1,trim1,f.width-trim1,trim1],"blue"));B.push(a([f.width-trim1,trim1,f.width-trim1,
f.height-trim1],"blue"));B.push(a([f.width-trim1,f.height-trim1,trim1,f.height-trim1],"blue"));B.push(a([trim1,f.height-trim1,trim1,trim1],"blue"));B.push(a([bleed1,bleed1,f.width-bleed1,bleed1],"red"));B.push(a([f.width-bleed1,bleed1,f.width-bleed1,f.height-bleed1],"red"));B.push(a([f.width-bleed1,f.height-bleed1,bleed1,f.height-bleed1],"red"));B.push(a([bleed1,f.height-bleed1,bleed1,bleed1],"red"));2==numPages&&B.push(a([f.width/2,0,f.width/2,f.height],"black"));$.each(B,function(c,d){f.add(d)})}
function Cb(a){H=0;$(this);$.ajax({url:base_url+"red/yrb_pges/gt_grp_ajax",data:"page="+a,type:"POST",dataType:"json",success:function(c){if(!check_login_ajax(c))return!1;if(c){if($(".image").remove(),c[0].id){$("#photos_div").show();var d=[];f.forEachObject(function(e){"CzImage"===e.type&&e.group_photo&&d.push(e.imageID)});$("#thumbs").css("height","140px");$.each(c,function(e,b){Db(b,d)});va("#thumbs")}}else $("#photo_message").html("No group photos were found.")}})}function Db(a,c){var d=a.image.split("/")[1];
c=-1!=$.inArray(a.id,c)?!0:!1;var e=thisPage.toString(),b=!1;if(null!=a.used_pages){var g=a.used_pages.split(",");0<g.length&&$.each(g,function(k,n){if(n!=e)return b=!0,!1})}g=a.grade_division_onphoto?a.grade_division_onphoto:"&nbsp;";d=d+"<br>"+g;a.is_roster_associated&&(d=a.is_roster_associated+"<br>"+g);a.teachergroup_name_onphoto&&(d=a.teachergroup_name_onphoto+"<br>"+g);g='<div class="list_image image group_thumb" title="" image_id="'+a.id+'" style="max-height:140px;">';g=g+'\t<div id="img_div">\t\t<img title="'+
(d+'" draggable="true" group_photo="group" im_id="'+a.id+'" id="grp_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >');c&&!b?g+='\t<div title="Image Used" id="used_grp_'+a.id+'" style="position:absolute;bottom:30px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':b&&null!=a.used_pages&&(g+='\t<div title="Image Used On Other Pages" id="used_grp_'+a.id+'" style="position:absolute;bottom:30px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+
img_path+'yellow_check_circle.png"></div>');g=g+'\t</div>\t<div style="font-size:12px;" >'+(d+"</div></div>");$("#thumbs").append(g);var h=new Image;h.id=a.id;h.onload=function(){$("#grp_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));setTimeout(function(){var k=$('.group_thumb[image_id="'+h.id+'"]').width();H+=k+150;$("#thumbs").css("width",H)},500)};h.src="/red/yrb_pges/get_group_thmb/"+a.image;$(".list_image.image").on("click",function(k){$(".list_image.clipart_thumb").removeClass("active");
k=$(".list_image.image");for(var n=0;n<k.length;n++)$(k[n]).attr("image_id")!=$(this).attr("image_id")&&$(k[n]).removeClass("active");$(this).addClass("active");r=this.querySelector("img")})}function mb(a){H=0;$(this);is_com_user_page()?req="/red/upload_ph/srch_pge_com_ajax":is_client_page()&&(req="/red/upload_ph/srch_pge_ajax");$.ajax({url:req,data:"page="+a+"&term=",type:"POST",dataType:"json",success:function(c){if(!check_login_ajax(c))return!1;$("#photos_div").show();if(c){if($(".image").remove(),
c[0].id){var d=[];f.forEachObject(function(e){"CzImage"!==e.type||e.group_photo||e.graphic||d.push(e.imageID)});$("#thumbs").css("height","110px");$.each(c,function(e,b){Eb(b,!1,d)});va("#thumbs")}}else $("#photo_message").html("No photos were found.")}})}function Eb(a,c,d){var e="";c||(a.image=a.image.split("|")[1],0<=a.uploaded_by.indexOf("@")&&(e="client_border"));c=-1!=$.inArray(a.id,d)?!0:!1;var b=thisPage.toString(),g=!1;1E3==a.page&&(d=a.used_pages.split("|"),0<d.length&&$.each(d,function(h,
k){if(k!=b)return g=!0,!1}));e='<div class="list_image image '+e+'" title="" image_id="'+a.id+'">';e=e+'\t<div id="img_div">\t\t<img title="'+(a.o_image_name+'" draggable="true" im_id="'+a.id+'" id="im_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >');c&&!g?e+='\t<div title="Image Used" id="used_im_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':g&&""!=a.used_pages&&
(e+='\t<div title="Image Used On Other Pages" id="used_im_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>');e+="\t</div></div>";$("#thumbs").append(e);e=new Image;e.id=a.id;e.onload=function(){$("#im_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));var h=$("#im_"+this.id).width(),k=$("#thumbs").width();H+=h+15;k<H&&$("#thumbs").css("width",H)};is_com_user_page()?e.src="/red/get_med_com/"+
a.image:e.src="/red/get_med/"+a.image;$(".list_image.image").on("click",function(h){$(".list_image.clipart_thumb").removeClass("active");h=$(".list_image.image");for(var k=0;k<h.length;k++)$(h[k]).attr("image_id")!=$(this).attr("image_id")&&$(h[k]).removeClass("active");$(this).addClass("active");r=this.querySelector("img")})}function Fb(a,c,d){setTimeout(function(){window[a].apply(this,d)},c)}function Gb(){var a="Arial;Calibri;Courier New;Myriad Pro;Delicious;Verdana;Georgia;Courier;Comic Sans MS;Impact;Monaco".split(";");
0<fonts.length?(a.push("Navajo:n4,i4,n7,i7"),WebFont.load({google:{families:fonts},classes:!1,active:function(){ba=!0},custom:{families:a}})):WebFont.load({custom:{families:a},classes:!1,active:function(){ba=!0}})}function Hb(){if(is_com_user_page())req="/red/yrb_pges/ld_pge_com_ajax",data={p:thisPage,page_template_id:page_template_id};else if(is_client_page())req="/red/yrb_pges/ld_pge_ajax",data={p:thisPage,page_template_id:page_template_id};else if(is_staff_page()){req="/templates/loadEditTemplate_ajax";
data={id:thisTemplate};var a='{"objects":[],"background":"","globalScale":1,"grid_showing":true,"grid":"30","snap_grid":true}'}$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(c){if(!check_login_ajax(c))return!1;if(c){if(is_staff_page()){var d="Template: "+c.template_name;$("#template_title").text(d)}Gb();is_staff_page()&&!c.template_json_data&&(c.template_json_data=a);if(is_client_page()||is_com_user_page())var e=$.parseJSON(c);else is_staff_page()&&(e=$.parseJSON(c.template_json_data));
c=new BigNumber(e.globalScale);var b=new BigNumber(1);b=(new BigNumber(m)).div(c);b.equals(1)||$.each(e.objects,function(g,h){h.scaleX=b.times(h.scaleX).toNumber();h.scaleY=b.times(h.scaleY).toNumber();h.left=b.times(h.left).toNumber();h.top=b.times(h.top).toNumber()});e.backgroundImage&&(e.backgroundImage.scaleX=b.times(e.backgroundImage.scaleX),e.backgroundImage.scaleY=b.times(e.backgroundImage.scaleY),e.backgroundImage.src&&0===e.backgroundImage.src.indexOf("http")&&(e.backgroundImage.src=(new URL(e.backgroundImage.src)).pathname));
$.each(e.objects,function(g,h){h.primarySrc&&0===h.primarySrc.indexOf("http")&&(h.primarySrc=(new URL(h.primarySrc)).pathname);h.src&&0===h.src.indexOf("http")&&(h.src=(new URL(h.src)).pathname)});$.each(e.objects,function(g,h){h._controlsVisibility&&(h._controlsVisibility.br=h._controlsVisibility.bl=!0);h.lockMovementX=h.lockMovementY=h.lockScalingX=h.lockScalingY=h.lockRotation=!1;h.my||(h.stroke="rgb(0, 0, 0)");h.my&&""==h.my.stroke&&(h.my.stroke="rgb(0, 0, 0)",h.stroke="rgb(0, 0, 0)");h.clipTo&&
("round"==h.my.frame_style&&(h.clipTo=function(k){k.arc(this.my.x,this.my.y,this.my.circle_radius,0,2*Math.PI,!1)}),"oval"==h.my.frame_style&&(h.clipTo=function(k){fabric.Object.drawEllipse(k,this.my.x,this.my.y,1.3*this.my.oval_rx,this.my.oval_ry)}),"square"==h.my.frame_style&&(h.hasBorders=!1,h.clipTo=function(k){fabric.Object.drawRoundRect(k,this.my.x,this.my.y,this.width,this.height,this.my.corner_radius)}))});f.loadFromDatalessJSON(e,function(){u();setTimeout(function(){Ib();q();wa=[];Ab();La();
nb(e);$("#loading").hide();if(is_com_user_page()||is_client_page())page_template_id||(thisTemplate=e.template?e.template:0)},300)})}else La(),nb(!1),$("#loading").hide();ob();$(".undo_div").show()}})}function ja(){var a=$("#c").width(),c=$("#c").height();safe1=safe*m;J=ca*m;for(var d=1;d<(a-2*safe1)/J;d++){var e=new fabric.Line([d*J+safe1,0+safe1,d*J+safe1,c-safe1],{stroke:"#ccc",selectable:!1,name:"gridLine",bottom:!0});f.add(e);f.sendToBack(e)}for(d=1;d<(c-2*safe1)/J;d++)e=new fabric.Line([0+safe1,
d*J+safe1,a-safe1,d*J+safe1],{stroke:"#ccc",selectable:!1,name:"gridLine",bottom:!0}),f.add(e),f.sendToBack(e);P=!0;Jb()}function xa(){var a=f.getObjects();$(a).reverse().each(function(c,d){"line"==d.type&&"gridLine"==d.name&&f.remove(d)})}function nb(a){a?($("#show_grid").val(1==a.grid_showing?"YES":"NO"),$("#grid_spacing").val(a.grid),ca=a.grid,$("#snap_grid").val(1==a.snap_grid?"YES":"NO"),ka=a.snap_grid,$("#show_grid").trigger("change"),a.grid_showing&&ja()):($("#show_grid").val("YES"),$("#grid_spacing").val("10"),
ca=10,$("#snap_grid").val("YES"),ka=!0,$("#show_grid").trigger("change"),ja())}function Kb(){$("#update_grid").before('<span id="grid_loading_gif"><i style="font-size: 1.5em;" class="fa fa-spinner fa-pulse fa-fw"></i></span>');setTimeout(function(){"NO"==$("#show_grid").val()?(xa(),P=!1):ca==$("#grid_spacing").val()&&P||(xa(),ca=$("#grid_spacing").val(),ja(),P=!0);$("#grid_loading_gif").remove();ka="YES"==$("#snap_grid").val()?!0:!1},20);y=!0}function ob(){pb=setInterval(function(){ya=!0;y?$("#save").trigger("click"):
ya=!1},3E5)}function Lb(){is_com_user_page()?(req="/red/yrb_pges/pg_lk_com_ajax",data={p:thisPage}):is_client_page()?(req="/red/yrb_pges/pg_lk_ajax",data={p:thisPage}):is_staff_page()&&(req="/red/yrb_pges/pg_lk_ajax",data={p:thisTemplate});$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(a){if(!check_login_ajax(a))return!1;a||alert("We could not update your page status. Please save and then reload this page. Thank You.")}})}function E(){var a=f.getActiveObject();if(a){if(0==
l&&0==A.length)A=[],F=[],K=[],U=[],L=[],V=[],draggedAdded?draggedAdded=!1:(F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,W(l,a),L[l]=null,l++),a.saveState(),F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,W(l,a),da(l,a),V.push(a.itemID);else{if(l<A.length-1){for(var c=0,d=A.length-1;0<d;--d)if(d>l||d==l&&A[d-1].itemID!=A[l].itemID)A.splice(d,1),F.splice(d,1),K.splice(d,1),U.splice(d,1),L.splice(d,1),c++;V=[];$.each(A,function(e,b){-1==$.inArray(b.itemID,V)&&V.push(b.itemID)});
za=a;l>A.length-1&&(l=A.length-1)}-1==$.inArray(a.itemID,V)?(l++,F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,W(l,a),da(l,a),l++,a.saveState(),F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,da(l,a),W(l,a),V.push(a.itemID)):(a.itemID!=za.itemID&&(l++,F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,da(l,a),W(l,a)),a.saveState(),l++,F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,da(l,a),W(l,a))}za=$.extend(!0,{},a)}else removedObject&&(a=Ma,a.saveState(),
l++,F[l]=JSON.stringify(a.originalState),A[l]=a,K[l]=a.clipTo,W(l,a),da(l,a),za=$.extend(!0,{},a));Na()}function W(a,c){U[a]=Oa?"SendBack":sendObjectFront?"SendFront":null}function da(a,c){L[a]=ua?"Added":removedObject?"Removed":Pa?"Cloned":croppedObject?"Cropped":null;ua=removedObject=Pa=croppedObject=!1}function ea(a,c,d,e){var b=f.getObjects(),g=!1;d?$(b).each(function(h,k){if(k[c]==a&&k[e]==d)return g=!0,!1}):$(b).each(function(h,k){if(k[c]==a)return g=!0,!1});return g}function Q(a,c){var d=c.imageID,
e="im",b=0;-1!=$.inArray(c.graphic,["border","background","clipart"])?e="gr":c.group_photo&&(b=18,e="grp");var g="";"background"==c.graphic?g='class="bg_used"':"border"==c.graphic&&(g='class="brdr_used"');"add"==a?(a='<div title="Image Used" id="used_'+e+"_"+d+'" '+g+' style="position:absolute;bottom:'+b+'px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>',$("#"+e+"_"+d).after(a)):ea(d,"imageID")?c.group_photo&&(ea(d,"imageID","group_photo",
"group")?"gr"==e&&(ea(d,"imageID","graphic","clipart")||ea(d,"imageID","graphic","border")||$("#used_"+e+"_"+d).remove()):$("#used_"+e+"_"+d).remove()):$("#used_"+e+"_"+d).remove()}function Na(){l>=A.length-1?$(".redo").attr("disabled",!0):$(".redo").removeAttr("disabled");0==l?$(".undo").attr("disabled",!0):$(".undo").removeAttr("disabled")}function qb(a){if(0<a.filters.length){var c=[];$.each(a.filters,function(d,e){e&&"brightness"==e.type.toLowerCase()?c.push(new fabric.Image.filters.Brightness({brightness:e.brightness})):
e&&"contrast"==e.type.toLowerCase()?c.push(new fabric.Image.filters.Contrast({contrast:e.contrast})):e&&"grayscale"==e.type.toLowerCase()&&c.push(new fabric.Image.filters.Grayscale({grayscale:e.grayscale}))});a.filters=[];0<c.length&&$.each(c,function(d,e){a.filters.push(this)})}"clipTo"in a&&a.clipTo&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?v.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||0!=a.cx||0!=a.cy||a.cw!=a.width||
a.ch!=a.height)&&v.frame_round_border(null,a);setTimeout(function(){a.applyFilters(f.renderAll.bind(f));f.renderAll()},50)}function Mb(){Aa=0;is_com_user_page()?(req="/red/yrb_pges/gt_rstr_com_ajax",data={page:thisPage}):is_client_page()?(req="/red/yrb_pges/gt_rstr_ajax",data={page:thisPage}):is_staff_page()&&(req=base_url+"templates/getRestoreTemplateThumbs_ajax",data={id:thisTemplate});$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(a){if(!check_login_ajax(a))return!1;a?($(".restore_thumb").remove(),
a&&($("#restore_div").show(),$.each(a,function(c,d){Nb(d)}))):alert("It appears there are no restore points to show, or there was a problem retrieving them.")}})}function Nb(a){var c='<div class="restore_thumb panel panel-default">\t<img title="Click to restore this page." restore_id="'+(a.id+'" id="restore_'+a.id+'" class="restore_item" src="'+img_path+'indicator_big.gif" width="210" >');c+='\t<div style="font-size:12px;" >Saved by: '+a.created_by+"<br>"+a.created_at+"</div>";c+="</div>";$("#restore_thumbs").append(c);
c=new Image;c.id=a.id;c.onload=function(){$("#restore_"+this.id).attr("src",this.src);var d=$("#restore_"+this.id).width(),e=$("#restore_thumbs").width();Aa+=d+20;e<Aa&&$("#restore_thumbs").css("width",Aa)};is_com_user_page()?c.src="/red/gt_rstr_img_com/"+a.page_thumbnail:is_client_page()&&(c.src="/red/gt_rstr_img/"+a.page_thumbnail)}function Qa(a){$.ajax({url:base_url+"red/grphc/gtCtsLst_ajax",data:is_staff_page()?{type:a}:{type:a,com:is_com_user_page()},type:"POST",dataType:"json",success:function(c){if(!check_login_ajax(c))return!1;
if(c){var d='<option value="">Select</option>';"Background"==a&&(d+='<option value="solid">Color Palette</option>');$.each(c,function(e,b){if("1"==b.catdisabled||"1"==b.subcatdisabled)return!0;d+='<option value="'+b.cid+"|"+b.scid+'" >'+b.category+"->"+b.subcategory+"</option>"});$("#"+a.toLowerCase()+"_folder").html(d);$("#"+a.toLowerCase()+"_div").show()}else alert("There was a problem. Please try again.")}})}function Ob(a,c){H=0;var d=a.toLowerCase();$.ajax({url:base_url+"red/grphc/srchClprt",
data:"type="+a+"&term="+c,type:"POST",dataType:"json",success:function(e){if(!check_login_ajax(e))return!1;$("#"+d+"_message").text("");if(e){if($("."+d+"_thumb").remove(),e[0].id){var b=[];f.forEachObject(function(g){"CzImage"===g.type&&g.graphic&&b.push(g.imageID)});$.each(e,function(g,h){rb(h,!1,b,d,a,!0)});"Clipart"==a&&va("#"+d+"_thumbs")}}else $("#"+d+"_message").text("No Images Found. Please try different search terms.")}})}function Ra(a,c){H=0;var d=c.toLowerCase();is_com_user_page()?(req=
"/red/grphc/gtClprt_com",data={subcat_id:a,type:c}):is_client_page()?(req="/red/grphc/gtClprt",data={subcat_id:a,type:c}):is_staff_page()&&(req=base_url+"red/grphc/gtClprt",data={subcat_id:a,staff:"staff"});$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(e){if(!check_login_ajax(e))return!1;$("#"+d+"_message").text("");if(e){if($("."+d+"_thumb").remove(),e[0].id){var b=[];f.forEachObject(function(g){"CzImage"===g.type&&g.graphic&&b.push(g.imageID)});$.each(e,function(g,h){rb(h,
!1,b,d,c,!1)});"Clipart"==c&&va("#"+d+"_thumbs")}}else $("#"+d+"_message").text("No Images Found. Please try a different category.")}})}function rb(a,c,d,e,b,g){c||(a.image=a.image.split("|")[1]);c=-1!=$.inArray(a.id,d)?!0:!1;var h=is_staff_page()?thisTemplate.toString():thisPage.toString(),k=!1;null!=a.used_pages&&(d=a.used_pages.split(","),0<d.length&&$.each(d,function(D,G){if(G!=h)return k=!0,!1}));d="Clipart"==b?a.o_image_name:"Click to use this style";var n=null;null!=f.backgroundImage&&(n=f.backgroundImage._element.src.replace(/^.*\/\/[^\/]+/,
""));n=null!=n&&n=="/red/grphc/get_med/"+a.image+"/"+b+"/1"?!0:!1;if("Background"==b)var w="bg_used";else"Border"==b&&(w="brdr_used");if(g){g=$("#"+e+"_folder option[value='"+a.cat_id+"']").text();var z='<div class="graphic_thumb graphic_'+e+'_thumb">\t<div style="max-height: 140px;" class="list_image '+(e+'_thumb" title="" image_id="'+a.id+'">');z=z+'\t\t<div id="img_div">\t\t\t<img graphic="'+(e+'" title="'+d+'" draggable="true" im_id="'+a.id+'" id="gr_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >');
c&&!k||n?z+='\t\t<div title="Image Used" class="'+w+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':k&&null!=a.used_pages&&(z+='\t\t<div title="Image Used On Other Pages" class="yellow '+w+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>');
z=z+'\t\t</div>\t</div>\t<div category="'+(a.cat_id+'" class="'+e+'_cat_search_link" style="font-size:10px; text-align: center; text-decoration: underline; cursor:pointer;" >'+g.replace("->",":<br>")+"</div>");z+="</div>";$("#"+e+"_thumbs").css("height","140px")}else z='<div class="list_image '+e+'_thumb" title="" image_id="'+a.id+'">',z=z+'\t<div id="img_div">\t\t<img graphic="'+(e+'" title="'+d+'" draggable="true" im_id="'+a.id+'" id="gr_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >'),
c&&!k||n?z+='\t<div title="Image Used" class="'+w+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':k&&null!=a.used_pages&&(z+='\t<div title="Image Used On Other Pages" class="yellow '+w+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>'),z+="\t</div></div>",
$("#"+e+"_thumbs").css("height","110px");$("#"+e+"_thumbs").append(z);w=new Image;w.id=a.id;w.onload=function(){$("#gr_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));var D=$("#gr_"+this.id).width(),G=$("#thumbs").width();H+=D+30;G<H&&$("#"+e+"_thumbs").css("width",H)};w.src="/red/grphc/get_med/"+a.image+"/"+b;$(".list_image."+e+"_thumb").on("click",function(D){$(".list_image.image").removeClass("active");D=$(".list_image."+e+"_thumb");for(var G=0;G<D.length;G++)$(D[G]).attr("image_id")!=
$(this).attr("image_id")&&$(D[G]).removeClass("active");$(this).addClass("active");r=this.querySelector("img")})}function Jb(){f.forEachObject(function(a){"CzImage"===a.type&&"border"==a.graphic&&a.sendToBack()})}function Pb(a){return(a=a.match(/^rgb?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""}function Qb(){$("#background_message").text("");
$("#background_search_term").val("");Ba=0;var a=null;null!=f.backgroundColor&&(a=Pb(f.backgroundColor).toUpperCase());$.each("#FF00FF #FF33FF #CC00CC #FF66FF #CC33CC #990099 #FF99FF #CC66CC #993399 #660066 #FFCCFF #CC99CC #996699 #663366 #330033 #CC00FF #CC33FF #9900CC #CC66FF #9933CC #660099 #CC99FF #9966CC #663399 #330066 #9900FF #9933FF #6600CC #9966FF #6633CC #330099 #6600FF #6633FF #3300CC #3300FF #0000FF #3333FF #0000CC #6666FF #3333CC #000099 #9999FF #6666CC #333399 #000066 #CCCCFF #9999CC #666699 #333366 #000033 #0033FF #3366FF #0033CC #0066FF #6699FF #3366CC #003399 #3399FF #0066CC #0099FF #99CCFF #6699CC #336699 #003366 #66CCFF #3399CC #006699 #33CCFF #0099CC #00CCFF #00FFFF #33FFFF #00CCCC #66FFFF #33CCCC #009999 #99FFFF #66CCCC #339999 #006666 #CCFFFF #99CCCC #669999 #336666 #003333 #00FFCC #33FFCC #00CC99 #66FFCC #33CC99 #009966 #99FFCC #66CC99 #339966 #006633 #00FF99 #33FF99 #00CC66 #66FF99 #33CC66 #009933 #00FF66 #33FF66 #00CC33 #00FF33 #00FF00 #33FF33 #00CC00 #66FF66 #33CC33 #009900 #99FF99 #66CC66 #339933 #006600 #CCFFCC #99CC99 #669966 #336633 #003300 #33FF00 #66FF33 #33CC00 #66FF00 #99FF66 #66CC33 #339900 #99FF33 #66CC00 #99FF00 #CCFF99 #99CC66 #669933 #336600 #CCFF66 #99CC33 #669900 #CCFF33 #99CC00 #CCFF00 #FFFF00 #FFFF33 #CCCC00 #FFFF66 #CCCC33 #999900 #FFFF99 #CCCC66 #999933 #666600 #FFFFCC #CCCC99 #999966 #666633 #333300 #FFCC00 #FFCC33 #CC9900 #FFCC66 #CC9933 #996600 #FFCC99 #CC9966 #996633 #663300 #FF9900 #FF9933 #CC6600 #FF9966 #CC6633 #993300 #FF6600 #FF6633 #CC3300 #FF3300 #FF0000 #FF3333 #CC0000 #FF6666 #CC3333 #990000 #FF9999 #CC6666 #993333 #660000 #FFCCCC #CC9999 #996666 #663333 #330000 #FF0033 #FF3366 #CC0033 #FF0066 #FF6699 #CC3366 #990033 #FF3399 #CC0066 #FF0099 #FF99CC #CC6699 #993366 #660033 #FF66CC #CC3399 #990066 #FF33CC #CC0099 #FF00CC #FFFFFF #CCCCCC #999999 #666666 #333333 #000000".split(" "),
function(c,d){c='<div class="background_thumb color" id="clr_'+c+'" title="Select This Color" style="background-color:'+d+'">&nbsp;';a==d&&(c+='<div title="Color Used" class="bg_used" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>');c+="</div>";$("#background_thumbs").append(c);d=$("#background_thumbs").width();Ba+=104;d<Ba&&$("#background_thumbs").css("width",Ba)});$("#background_div").show()}
function Rb(){$.ajax({url:base_url+"red/tmplt/gtPgTmpltsLst_ajax",data:{cats:"cats",com:is_com_user_page()},type:"POST",dataType:"json",success:function(a){if(!check_login_ajax(a))return!1;var c="";a?($.each(a,function(d,e){c+='<option value="'+e.cid+"|"+e.scid+'" >'+e.category+"->"+e.subcategory+"</option>"}),$("#template_category").html(c),$("#template_category").trigger("change")):alert("Errr..., no categories exist!")}})}function Sb(a){$("#template_message").html("");Ca=0;$(this);$.ajax({url:base_url+
"red/tmplt/gtPgTmplts_ajax",data:{subcat_id:a,client:"client",com:is_com_user_page()},type:"POST",dataType:"json",success:function(c){if(!check_login_ajax(c))return!1;c?($(".template_thumb").remove(),c[0].id&&($("#template_div").show(),$.each(c,function(d,e){Tb(e)}))):($(".template_thumb").remove(),$("#template_message").html("No results found."))}})}function Tb(a){if(a.image)var c=a.image,d="";else c="new_template.png",d="newtemplate";var e=a.template_name?a.template_name:"No Name Entered";d='<div class="template_thumb panel panel-default '+
d+'" title="" image_id="'+a.id+'" >';d+='\t\t<img title="'+e+'" template_id="'+a.id+'" id="template_'+a.id+'" class="template_item" src="'+img_path+'indicator_big.gif" width="210" >';if(a.used||a.id==thisTemplate)d+='\t<div title="Template Used" template_id="used_template_'+a.id+'" style="position:absolute;bottom:18px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>';d+='\t<div style="font-size:12px;" >'+e+"</div></div>";$("#template_thumbs").append(d);
e=new Image;e.id=a.id;e.onload=function(){$("#template_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));var b=$("#template_"+this.id).width(),g=$("#template_thumbs").width();Ca+=b+15;g<Ca&&$("#template_thumbs").css("width",Ca)};e.src="/red/tmplt/get_tmpl_med/"+c}function Sa(){ba&&(setTimeout(function(){Hb()},5E3),"undefined"!=typeof Ta&&clearInterval(Ta))}function sb(){$(".list_image").removeClass("active");r=null}function Ua(a){var c="";"photos"===a&&(c="clipart_thumb");"clipart"===a&&
(c="image");a=$(".list_image."+c);c=!0;for(var d=0;d<a.length;d++)if($(a[d]).hasClass("active")){c=!1;break}c&&(r=null)}function tb(a){var c="";"photos"===a&&(c="clipart_thumb");"clipart"===a&&(c="image");a=$(".list_image."+c);c=!0;for(var d=0;d<a.length;d++)if($(a[d]).hasClass("active")){c=!1;break}return c}fabric.Image.filters.Contrast=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:"Contrast",initialize:function(a){a||(a={});this.contrast=a.contrast||0},applyTo:function(a){doFilter=
!0;var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var d=a.data,e=Math.pow((this.contrast+100)/100,2);var b=0;for(var g=d.length;b<g;b+=4){var h=d[b],k=d[b+1],n=d[b+2];h/=255;h-=.5;h*=e;h+=.5;h*=255;k/=255;k-=.5;k*=e;k+=.5;k*=255;n/=255;n-=.5;n*=e;n+=.5;n*=255;d[b]=h;d[b+1]=k;d[b+2]=n}doFilter=!1;c.putImageData(a,0,0)},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{contrast:this.contrast})}});fabric.Image.filters.Contrast.fromObject=function(a){return new fabric.Image.filters.Contrast(a)};
fabric.util.loadImage=function(a,c,d,e){if(a){var b=fabric.util.createImage();b.onload=function(){c&&c.call(d,b);b=b.onload=b.onerror=null};b.onerror=function(){fabric.log("Error loading "+b.src);c&&c.call(d,null,!0);b=b.onload=b.onerror=null};b.src=a}else c&&c.call(d,a)};fabric.Textbox.prototype.initialize=function(a,c){this.ctx=fabric.util.createCanvasElement().getContext("2d");this.callSuper("initialize",a,c);this.set({lockUniScaling:!1,lockScalingY:!0,lockScalingFlip:!0,hasBorders:!0});this._dimensionAffectingProps.width=
!0};fabric.IText.prototype.onInput=function(a){if(this.isEditing){var c=this.selectionStart||0;c=this.hiddenTextarea.value.slice(c,c+(this.hiddenTextarea.value.length-this.text.length+(this.selectionEnd||0)-c));this.insertChars(c);a.stopPropagation()}};fabric.Canvas.prototype._setCornerCursor=function(a,c){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};if("bl"===a)this.setCursor(this.rotationCursor);else if("br"===a)"CzImage"==c.type?this.setCursor("se-resize"):"Textbox"==c.type&&this.setCursor("w-resize");
else if(a in d)this.setCursor(this._getRotatedCornerCursor(a,c));else return this.setCursor(this.defaultCursor),!1};fabric.Canvas.prototype._getActionFromCorner=function(a,c){a="drag";c&&(a="mr"===c?"move":"mt"===c||"mb"===c?"scaleY":"bl"===c?"rotate":"scale");return a};fabric.Object.prototype.drawBorders=function(a){if(!this.hasBorders)return this;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;a.lineWidth=1/this.borderScaleFactor;var c=this._calculateCurrentDimensions(!0),
d=c.x;c=c.y;this.group&&(d*=this.group.scaleX,c*=this.group.scaleY);var e=~~-(d/2)-.5,b=~~-(c/2)-.5;d=~~d+1;var g=~~c+1;this.borderDashArray&&(a.beginPath(),fabric.util.drawDashedLine(a,e,b,e+d,b,this.borderDashArray),fabric.util.drawDashedLine(a,e+d,b,e+d,b+g,this.borderDashArray),fabric.util.drawDashedLine(a,e+d,b+g,e,b+g,this.borderDashArray),fabric.util.drawDashedLine(a,e,b+g,e,b,this.borderDashArray),a.stroke(),a.closePath());this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&
this.hasControls&&(c=-c/2,a.beginPath(),a.moveTo(0,c),a.lineTo(0,c-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this};fabric.Canvas.prototype._drawControl=function(a,c,d,e,b){this.isControlVisible(a)&&(a=this.cornerSize,isVML()||this.transparentCorners||c.clearRect(e,b,a,a),c[d](e,b,a,a))};fabric.Object.prototype.drawControls=function(a){if(!this.hasControls)return this;var c=this._calculateCurrentDimensions(!0),d=c.x;c=c.y;var e=-(d/2),b=-(c/2),g=this.cornerSize/2,h=this.transparentCorners?
"strokeRect":"fillRect";a.save();a.lineWidth=1;a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,h,e-g,b-g);this._drawControl("tr",a,h,e+d-g,b-g);h=new Image;h.src=rotateSRC;a.drawImage(h,e-g,b+c-g,25,25);h=new Image;"CzImage"==this.type?h.src=scale1SRC:"Textbox"==this.type&&(h.src=scale2SRC);a.drawImage(h,e+d-g,b+c-g,25,25);a.restore();return this};fabric.Canvas.prototype.__onMouseMove=function(a){if(cropping){var c=this.findTarget(a);
this._setCursorFromEvent(a,c);this.fire("mouse:move",{target:c,e:a});c&&c.fire("mousemove",{e:a})}else if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!("undefined"!==typeof a.touches&&1<a.touches.length)){var d=this._groupSelector;if(d){var e=this.getPointer(a,!0);d.left=e.x-d.ex;d.top=e.y-d.ey;this.renderTop()}else this._currentTransform?this._transformObject(a):(c=this.findTarget(a),!c||c&&!c.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,c));this.fire("mouse:move",
{target:c,e:a});c&&c.fire("mousemove",{e:a})}};fabric.Canvas.prototype.__onMouseUp=function(a){if(cropping){var c=this.findTarget(a);this._maybeGroupObjects(a);this._handleCursorAndEvent(a,c)}else if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else{this._currentTransform?(this._finalizeCurrentTransform(),c=this._currentTransform.target):c=this.findTarget(a,!0);var d=this._shouldRender(c,this.getPointer(a));this._maybeGroupObjects(a);c&&(c.isMoving=!1);d&&this.renderAll();
this._handleCursorAndEvent(a,c)}};fabric.Canvas.prototype.__onMouseDown=function(a){if(("which"in a?1===a.which:1===a.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var c=this.findTarget(a),d=this.getPointer(a,!0);this._previousPointer=d;var e=this._shouldRender(c,d),b=this._shouldGroup(a,c);this._shouldClearSelection(a,c)?this._clearSelection(a,c,d):b&&(this._handleGrouping(a,c),c=this.getActiveGroup());c&&c.selectable&&!b&&
(this._beforeTransform(a,c),this._setupCurrentTransform(a,c));e&&this.renderAll();this.fire("mouse:down",{target:c,e:a});c&&c.fire("mousedown",{e:a})}};var y=!1,Va=0,V=[],Fa=!1;fabric.CzImage=fabric.util.createClass(fabric.Image,{type:"CzImage",zoomedXY:!1,initialize:function(a,c){c||(c={});this.callSuper("initialize",a,c);this.set({primarySrc:c.primarySrc,cx:c.cx?c.cx:0,cy:c.cy?c.cy:0,cw:c.cw?c.cw:a.width,ch:c.ch?c.ch:a.height,itemID:Va++,imageID:c.imageID,origWidth:a.width,origHeight:a.height})},
zoomBy:function(a,c,d,e){var b=this.cw,g=this.ch,h=this.cx,k=this.cy;if(a||c)this.zoomedXY=!0;console.log("cx, cy before zoom --------",this.cx,this.cy);this.cx+=a;this.cy+=c;d&&(this.cw-=d,this.ch-=d/(this.width/this.height));a=!1;var n=c=0;if(this.width<this.origWidth||this.height<this.origHeight)a=!0,c=this.cropX,n=this.cropY;d&&!this.zoomedXY?(this.cx=this.width/2-this.cw/2+c,this.cy=this.height/2-this.ch/2+n):d&&a&&(this.cx+=d/2,this.cy+=d/(this.width/this.height)/2);a?this.cw>this.origWidth||
this.ch>this.origHeight?(this.cw=b,this.ch=g,this.cx=h,this.cy=k,Fa=!0):(1>this.cw&&(this.cw=1),1>this.ch&&(this.ch=1),this.cx>this.origWidth-this.cw&&(this.cx=this.origWidth-this.cw),this.cy>this.origHeight-this.ch&&(this.cy=this.origHeight-this.ch),0>this.cx&&(this.cx=0),0>this.cy&&(this.cy=0)):(this.cw>this.width&&(this.cw=this.width),this.ch>this.height&&(this.ch=this.height),1>this.cw&&(this.cw=1),1>this.ch&&(this.ch=1),0>this.cx&&(this.cx=0),0>this.cy&&(this.cy=0),this.cx>this.width-this.cw&&
(this.cx=this.width-this.cw),this.cy>this.height-this.ch&&(this.cy=this.height-this.ch));console.log("cx, cy after zoom --------",this.cx,this.cy);this.rerender(!1,e)},crop:function(a){var c=$("#crop_div").width()/m,d=$("#crop_div").height()/m,e=$("#crop_div").position(),b=e.top/m;this.cx+=e.left/m/this.width*this.cw;this.cy+=b/this.height*this.ch;this.cw*=c/this.width;this.ch*=d/this.height;this.width=this.cw;this.height=this.ch;this.scaleX=this.scaleY=m;this.cropX=this.cx;this.cropY=this.cy;this.rerender(!1,
a)},cropDrag:function(a,c){var d=a.getWidth()/m,e=a.getHeight()/m,b=this.getBoundingRect(),g=b.width,h=b.height,k=b.left;b=b.top;0!=a.angle?g='<div id="crop_parent" style="width:'+g+"px;height:"+h+"px;top:"+b+"px;left:"+k+'px; position:absolute;background:transparent;pointer-events:none;">\t<div id="crop_div" style="width:'+(.5*d+"px;height:"+.5*e+"px;top:"+e/2+"px;left:"+d/2+'px;pointer-events:auto;"></div></div>'):(h=this.height/2-e/2,k=this.width/2-d/2,g='<div id="crop_parent" style="width:'+this.width+
"px;height:"+this.height+"px;top:"+this.top+"px;left:"+this.left+'px; position:absolute;background:transparent;pointer-events:none;">',g+='\t<div id="crop_div" style="width:'+d+"px;height:"+e+"px;top:"+h+"px;left:"+k+'px;pointer-events:auto;"></div></div>');$("#canvas_div").append(g);0!=a.angle&&$("#crop_div").rotate(a.angle,{x:"left",y:"top"});g=$("#crop_div").position();a=g.left;g=g.top;$("#crop_parent").remove();d>=this.width||e>=this.height?(this.cx=this.cy=0,this.cw=d,this.ch=e,this.width=this.cw,
this.height=this.ch,this.scaleX=this.scaleY=m,this.cropX=this.cx,this.cropY=this.cy,d>=this.width&&(this.cx+=a/this.width*this.cw,this.width=this.cw*=d/this.width,this.cropX=this.cx),e>=this.height&&(this.cy+=g/this.height*this.ch,this.height=this.ch*=e/this.height,this.cropY=this.cy),d=d>=e?Math.round(this.cw-this.origWidth+6):Math.round(this.width/this.height*(this.height-this.origHeight)+6)):(this.cx+=a/this.width*this.cw,this.cy+=g/this.height*this.ch,this.cw*=d/this.width,this.ch*=e/this.height,
this.width=this.cw,this.height=this.ch,this.scaleX=this.scaleY=m,this.cropX=this.cx,this.cropY=this.cy,d=d>=e?Math.round(this.cw-this.origWidth+6):Math.round(this.width/this.height*(this.height-this.origHeight)+6));this.zoomBy(0,0,d,c)},rerender:function(a,c){var d=new Image,e=this;d.crossOrigin="";d.round_border=a;d.objWidth=e.getWidth();d.objHeight=e.getHeight();d.onload=function(){var b=fabric.util.createCanvasElement(),g=new Image;b.width=e.width;b.height=e.height;var h=b.getContext("2d");h.drawImage(this,
e.cx,e.cy,e.cw,e.ch,0,0,e.width,e.height);if(this.round_border&&e.frame_round_border){var k=e.frame_round_border;h.setLineDash(k.strokeDashArray);h.fillStyle="transparent";h.lineWidth=k.strokeWidth;h.strokeStyle=k.stroke;if("round"==this.round_border){var n=k.ow>k.oh?k.radius/100*(k.oh/2):k.radius/100*(k.ow/2),w=(k.ow/2-n)/(k.ow/2),z=(k.oh/2-n)/(k.oh/2);w=k.offsetx/100*(k.ow/2)*w+k.ow/2;k=k.offsety/100*(k.oh/2)*z+k.oh/2;h.arc(w,k,n,0,2*Math.PI,!1)}else if("oval"==this.round_border){n=k.rx/100*k.ow;
var D=k.ry/100*k.oh;w=(k.ow/2-n/2)/(k.ow/2);z=(k.oh/2-D/2)/(k.oh/2);w=k.offsetx/100*(k.ow/2)*w+k.ow/2;k=k.offsety/100*(k.oh/2)*z+k.oh/2;fabric.Object.drawEllipse(h,w,k,1.3*n,D)}else fabric.Object.drawRoundRect(h,e.my.x,e.my.y,e.width,e.height,e.my.corner_radius,!0);h.stroke()}g.onload=function(){e.setElement(this,null,{width:e.width,height:e.height});f.renderAll();e.set({left:e.left,top:e.top,angle:e.angle});e.setCoords();c&&c(e)};g.src=b.toDataURL("image/png")};d.src=this.primarySrc},frame_round_border:null,
toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{primarySrc:this.primarySrc,src:this.primarySrc,cx:this.cx,cy:this.cy,cw:this.cw,ch:this.ch,imageID:this.imageID,cropX:this.cropX,cropY:this.cropY,graphic:this.graphic,selectable:this.selectable,evented:this.evented,group_photo:this.group_photo,panel:this.panel})}});fabric.CzImage.async=!0;fabric.CzImage.fromObject=function(a,c){fabric.util.loadImage(a.src.replace(/^.*\/\/[^\/]+/,""),function(d){fabric.Image.prototype._initFilters.call(a,
a.filters,function(e){a.filters=e||[];fabric.Image.prototype._initFilters.call(a,a.resizeFilters,function(b){a.resizeFilters=b||[];b=new fabric.CzImage(d,a);c&&c(b)})})},null,a.crossOrigin)};var v={canvas:null,zoomBy:function(a,c,d){v.canvas=f;var e=v.canvas.getActiveObject();e&&e.zoomBy(a,c,d,null)},crop_by_placeholder:function(a,c){if(!a)return!0;a.clipTo=function(d){fabric.Object.drawRoundRect(d,c.left-this.left-this.width/2,c.top-this.top-this.height/2,c.width,c.height,c.my.corner_radius,!0)};
f.renderAll()},crop:function(a,c){a||(a=v.canvas.getActiveObject());if(!a)return!0;c?a.cropDrag(c,function(){a.replaced?setTimeout(function(){"clipTo"in a&&a.clipTo&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?v.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||0!=a.cx||0!=a.cy||a.cw!=a.width||a.ch!=a.height)&&v.frame_round_border(null,a)},200):(a.set("opacity",1),a.applyFilters(f.renderAll.bind(f)),f.setActiveObject(a),a.saveState())}):
a.crop(function(){p(a);$("#bot_image_menu").hide();a.applyFilters(f.renderAll.bind(f))})},objManip:function(a,c){var d=v.canvas.getActiveObject();if(!d)return!0;switch(a){case "zoomBy-x":d.zoomBy(c,0,0,null);break;case "zoomBy-y":d.zoomBy(0,c,0,null);break;case "zoomBy-z":d.zoomBy(0,0,c,null);break;default:d.set(a,d.get(a)+c)}"left"!==a&&"top"!==a||d.setCoords();v.canvas.renderAll();return!1},frame_round_border:function(a,c){v.canvas=f;c&&a?(c.frame_round_border=a,c.rerender(a.style,function(){c.replaced&&
(c.applyFilters(f.renderAll.bind(f)),f.setActiveObject(c),c.saveState());f.renderAll()})):(c.rerender(!1,function(){c.replaced&&(c.applyFilters(f.renderAll.bind(f)),f.setActiveObject(c),c.saveState());f.renderAll()}),c.frame_round_border=null)},init:function(a,c,d){v.canvas=f;var e=new Image;e.onload=function(){var b=new fabric.CzImage(this,{originX:"left",originY:"top",left:c.x,top:c.y,scaleX:c.scalex*c.scale,scaleY:c.scaley*c.scale,primarySrc:e.src,imageID:c.imageID,graphic:c.graphic,evented:c.evented,
selectable:c.evented,group_photo:c.group_photo,opacity:c.hasOwnProperty("opacity")?0==c.opacity?0:1:1});c.width&&(b.width=c.width);c.height&&(b.height=c.height);b.hasRotatingPoint=!1;b.cornerSize=20;b.padding=7;b.borderDashArray=[10,5];b.setControlsVisibility({tl:!1,tr:!1,mt:!1,mb:!1,mr:!1,ml:!1,br:!0,bl:!0});c.replaced&&b.set("replaced",!0);b.stateProperties.push("borderDashArray","filters","frame_round_border","my","cw","ch","clipTo","imageID","cropY","cropX","graphic","selectable","evented","group_photo",
"panel");v.canvas.add(b);"border"==b.graphic?(b.sendToBack(),$("#border_loading_gif").remove(),b.saveState()):d?(b.replaced&&Ub(d,b),v.crop(b,d),b.set("left",d.left),b.set("top",d.top),f.renderAll()):(v.canvas.setActiveObject(b),b.saveState());Q("add",b)};e.src=a}},Ub=function(a,c){c.set("opacity",a.opacity);c.set("my",a.my);c.my.radius=a.my.radius*a.scaleX/m;"0"!=a.my.offsetx&&(c.my.offsetx=a.my.offsetx*a.scaleX/m);"0"!=a.my.offsety&&(c.my.offsety=a.my.offsety*a.scaleX/m);"0"!=a.my.corner_radius&&
(c.my.corner_radius=a.my.corner_radius/2/m);0!=a.my.x&&(c.my.x=a.my.x*a.scaleX/m);0!=a.my.y&&(c.my.y=a.my.y*a.scaleX/m);0<a.my.circle_radius&&(c.my.circle_radius=a.my.circle_radius*a.scaleX/m);0<a.my.strokeWidth&&(c.my.strokeWidth=a.my.strokeWidth*a.scaleX/m,c.my.strokeWidth=1<=c.my.strokeWidth?c.my.strokeWidth:1);0!=a.my.oval_rx&&(c.my.oval_rx=a.my.oval_rx*a.scaleX/m);0!=a.my.oval_ry&&(c.my.oval_ry=a.my.oval_ry*a.scaleX/m);c.set("frame_round_border",a.frame_round_border);a.frame_round_border&&(c.frame_round_border.radius=
a.frame_round_border.radius/m,0!=a.frame_round_border.ow&&(c.frame_round_border.ow=a.frame_round_border.ow*a.scaleX/m),0!=a.frame_round_border.oh&&(c.frame_round_border.oh=a.frame_round_border.oh*a.scaleX/m),0<a.frame_round_border.strokeWidth&&(c.frame_round_border.strokeWidth=a.frame_round_border.strokeWidth*a.scaleX/m));a.clipTo&&("round"==a.my.frame_style&&(c.clipTo=function(d){d.arc(this.my.x,this.my.y,this.my.circle_radius,0,2*Math.PI,!1)}),"oval"==a.my.frame_style&&(c.clipTo=function(d){fabric.Object.drawEllipse(d,
this.my.x,this.my.y,1.3*this.my.oval_rx,this.my.oval_ry)}),"square"==a.my.frame_style&&(c.hasBorders=!1,c.clipTo=function(d){fabric.Object.drawRoundRect(d,this.my.x,this.my.y,this.width,this.height,this.my.corner_radius)}));c.set("angle",a.angle);c.set("stroke",a.stroke);c.set("strokeWidth",a.strokeWidth*a.scaleX/m);c.set("strokeLineJoin",a.strokeLineJoin);c.set("strokeDashArray",a.strokeDashArray);a.shadow&&(c.set("shadow",a.shadow),0<a.shadow.blur&&(c.shadow.blur=Math.round(a.shadow.blur*a.scaleX/
m)),0<a.shadow.offsetX&&(c.shadow.offsetX=Math.round(a.shadow.offsetX*a.scaleX/m)),0<a.shadow.offsetY&&(c.shadow.offsetY=Math.round(a.shadow.offsetY*a.scaleX/m)));c.set("filters",a.filters)};aspectRatio=canvasWidth*numPages/canvasHeight;var ub=$("#canvas_size").width(),Vb=Math.round(ub/aspectRatio);$("#canvas_div").css("width",ub);$("#canvas_div").css("height",Vb);var f=new fabric.Canvas("c",{rotationCursor:"url("+rotationCursorSRC+"), default",uniScaleTransform:!1,width:canvasWidth*numPages,height:canvasHeight});
fabric.Object.NUM_FRACTION_DIGITS=10;var I,fa=250,Da=350,Y,ma,yb=30,ha=250,Ea=250,Z,na,zb=30,bb=40,cb=20,S;f.on("object:selected",function(a){a.target&&a.target.type||$(".all_menus").remove();var c=f.getObjects().indexOf(a.target),d=a.target;a=!1;S=d.get("type");var e=d.get("replaced");c!=I&&cropping&&(x(),$(".all_menus").remove());if("CzImage"==S){if(0==$(".image_menus").length||I!=c||e||la){$(".all_menus").remove();var b="";b+='<div class="image_menus all_menus panel" id="top_image_menu" style="display:none; width:'+
Da+'px;">';b+='\t<div id="top_image_menu_div" class="image_menu_divs">';b+='\t\t<button class="bring_front btn btn-default col-md-3" title="Bring Forward" type="button"><img src="'+img_path+'bring_front.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="send_back btn btn-default col-md-3" title="Send Backward" type="button"><img src="'+img_path+'send_back.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="crop_mode btn btn-default col-md-3" title="Crop Image" type="button"><img src="'+
img_path+'crop_zoom.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="copy_object copy_image btn btn-default col-md-3" title="Copy Image" type="button"><img src="'+img_path+'copy.png" width="20" height="20" alt=""/></button>';b+="\t</div>";b+='\t<div id="zoom_div" class="text-right" style="display:none;">';b+='\t\t<div class="col-md-6" style="padding-left: 0px; padding-right: 0px;">';b+='\t\t<button title="Zoom In" class="btn btn-default crop_btn zoom-in col-md-3 gi-1-5x" type="button"><span class="glyphicon glyphicon-zoom-in"></span></button>';
b+='\t\t<button title="Zoom Out" class="btn btn-default crop_btn zoom-out col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-zoom-out"></span></button>';b+='\t\t<button title="Move Left" class="btn btn-default crop_btn arrow-left col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-left"></span></button>';b+='\t\t<button title="Move Up" class="btn btn-default crop_btn arrow-up col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-up"></span></button>';
b+="\t\t</div>";b+='\t\t<div class="col-md-6" style="padding-left: 0px; padding-right: 0px;">';b+='\t\t<button title="Move Down" class="btn btn-default crop_btn arrow-down col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-down"></span></button>';b+='\t\t<button title="Move Right" class="btn btn-default crop_btn arrow-right col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-right"></span></button>';
b+='\t\t<button title="Set Crop" disabled class="btn btn-default set_crop col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><i class="fa fa-crop"></i></button>';b+='\t\t<button title="Crop" disabled class="btn btn-default crop_now col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button" style="font-size:15px;">OK</button>';b+="\t\t</div>";b+='\t\t<button title="Exit Crop Mode" style="width:100%" class="btn btn-default exit_crop_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Crop Mode</span></button>';
b+="\t</div>";b+="</div>";b+='<div class="image_menus panel all_menus image_menu_divs" id="bot_image_menu" style="display:none; width:'+fa+'px;" >';b+='\t<div id="bottom_image_menu_div" class="image_menu_divs" >';b+='\t\t<button class="brightcon_image_btn btn btn-default col-md-2" title="Adjust Brightness/Contrast" type="button"><img src="'+img_path+'brightness_contrast.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="opacity_image_btn btn btn-default col-md-2" title="Adjust Opacity" type="button"><img src="'+
img_path+'opacity.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="grayscale_image_btn btn btn-default col-md-2" title="Grayscale" type="button"><img src="'+img_path+'grayscale.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="border_image_btn btn btn-default col-md-2" title="Border" type="button"><img src="'+img_path+'border.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="shadow_image_btn btn btn-default col-md-2" title="Shadow" type="button"><img src="'+
img_path+'shadow.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="delete_btn btn btn-default col-md-2" title="Delete" type="button"><img src="'+img_path+'trash.png" width="20" height="20" alt=""/></button>';b+="\t</div>";b+='\t<div id="border_image_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="border_image_status" class="col-md-7 control-label small">Border:</label>';
b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<select class="form-control small" id="border_image_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="border_image_size" class="col-md-7 text-left control-label small">Size:</label>';b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<select class="form-control small" id="border_image_size" >';for(a=1;100>=
a;a++)b+='\t\t\t\t\t\t\t<option value="'+a+'">'+a+"</option>";b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="border_image_colorpicker" class="col-md-8 text-left control-label small">Color:</label>';b+='\t\t\t\t\t<div class="col-md-4">';b+='\t\t\t\t\t\t<input id="border_image_colorpicker" class="colorpicker"/>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="border_image_line_style" class="col-md-6 text-left control-label small">Line Style:</label>';
b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<select class="form-control small" id="border_image_line_style" >';b+='\t\t\t\t\t\t\t<option value="solid">Solid</option><option value="dashed">Dashed</option>';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="border_image_frame_style" class="col-md-6 text-left control-label small">Frame Style:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<select class="form-control small" id="border_image_frame_style" >';
b+='\t\t\t\t\t\t\t<option value="square">Square</option><option value="round">Round</option><option value="oval">Oval</option>';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group image_frame image_frame_round" style="display:none;">';b+='\t\t\t\t\t<label id="border_image_frame_radius_text" for="border_image_frame_radius" class="col-md-6 control-label small">Radius:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="border_image_frame_radius" class="image_frame_option" type="range" max="100" min="10" step="5" value="30">';
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group image_frame" style="display:none;">';b+='\t\t\t\t\t<label id="border_image_frame_radius_offsetx_text" for="border_image_frame_radius_offsetx" class="col-md-6 control-label small">Offset-X:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="border_image_frame_radius_offsetx" class="image_frame_option" type="range" max="100" min="-100" step="5" value="0">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+=
'\t\t\t\t<div class="form-group image_frame" style="display:none;">';b+='\t\t\t\t\t<label id="border_image_frame_radius_offsety_text" for="border_image_frame_radius_offsety" class="col-md-6 control-label small">Offset-Y:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="border_image_frame_radius_offsety" class="image_frame_option" type="range" max="100" min="-100" step="5" value="0">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group image_frame image_frame_oval" style="display:none;">';
b+='\t\t\t\t\t<label id="border_image_frame_radius_width_text" for="border_image_frame_radius_width" class="col-md-6 control-label small">Width:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="border_image_frame_radius_width" class="image_frame_option" type="range" max="100" min="10" step="5" value="100">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group image_frame image_frame_oval" style="display:none;">';b+='\t\t\t\t\t<label id="border_image_frame_radius_height_text" for="border_image_frame_radius_height" class="col-md-6 control-label small">Height:</label>';
b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="border_image_frame_radius_height" class="image_frame_option" type="range" max="100" min="10" step="5" value="100">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group border_image_radius_frame">';b+='\t\t\t\t\t<label for="border_image_radius" class="col-md-6 text-left control-label small">Border Radius:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="border_image_radius" class="form-control" type="number" max="100" min="1" value="0" step="1" value="5">';
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Border Mode" style="width:100%" class="btn btn-default exit_image_border_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Border Mode</span></button>';b+="\t</div>";b+='\t<div id="shadow_image_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="shadow_image_status" class="col-md-7 control-label small">Shadow:</label>';
b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<select class="form-control small shadow_image" id="shadow_image_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="shadow_image_blur_text" for="shadow_image_blur" class="col-md-6 text-left control-label small">Blur:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="shadow_image_blur" class="shadow_image" type="range" max="50" min="0" step="2" value="10">';
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="shadow_image_offsetx_text" for="shadow_image_offsetx" class="col-md-6 text-left control-label small">Offset-X:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="shadow_image_offsetx" class="shadow_image" type="range" max="50" min="-50" step="2" value="10">';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="shadow_image_offsety_text" for="shadow_image_offsety" class="col-md-6 text-left control-label small">Offset-Y:</label>';
b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="shadow_image_offsety" class="shadow_image" type="range" max="50" min="-50" step="2" value="10">';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="shadow_image_colorpicker" class="col-md-8 text-left control-label small">Color:</label>';b+='\t\t\t\t\t<div class="col-md-4">';b+='\t\t\t\t\t\t<input class="shadow_image colorpicker" id="shadow_image_colorpicker"/>';
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Shadow Mode" style="width:100%" class="btn btn-default exit_image_shadow_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Shadow Mode</span></button>';b+="\t</div>";b+='\t<div id="grayscale_image_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="grayscale_image_status" class="col-md-7 control-label small">Grayscale:</label>';
b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<select class="form-control small grayscale_image" id="grayscale_image_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Grayscale Mode" style="width:100%" class="btn btn-default exit_image_grayscale_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Grayscale Mode</span></button>';b+="\t</div>";
b+='\t<div id="opacity_image_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="opacity_image_value_text" for="opacity_image_value" class="col-md-7 text-left control-label small">Opacity:</label>';b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<input id="opacity_image_value" type="range" min="0" max="100" step="5" value="100">';b+="\t\t\t\t\t\t</select>";
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Opacity Mode" style="width:100%" id="exit_image_opacity_mode" class="btn btn-default" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Opacity Mode</span></button>';b+="\t</div>";b+='\t<div id="brightcon_image_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';
b+='\t\t\t\t\t<label id="brightness_image_value_text" for="brightness_image_value" class="col-md-6 text-left control-label small">Brightness:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="brightness_image_value" type="range" max="100" min="-100" step="5" value="0">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="contrast_image_value_text" for="contrast_image_value" class="col-md-6 text-left control-label small">Contrast:</label>';
b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="contrast_image_value" type="range" min="-100" max="100" step="5" value="0">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Brightness-Contrast Mode" style="width:100%" class="btn btn-default exit_image_brightcon_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Brightness-Contrast Mode</span></button>';b+="\t</div>";b+="</div>";a=!0}}else if("Textbox"==
S&&(0==$(".text_menus").length||I!=c||la)){$(".all_menus").remove();b="";b+='<div class="text_menus all_menus panel" id="top_text_menu" style="display:none; width:'+Ea+'px;">';b+='\t<div id="top_text_menu_div" class="text_menu_divs">';b+='\t\t<button class="bring_front btn btn-default col-md-4" title="Bring Forward" type="button"><img src="'+img_path+'bring_front.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="send_back btn btn-default col-md-4" title="Send Backward" type="button"><img src="'+
img_path+'send_back.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="copy_object copy_text btn btn-default col-md-4" title="Copy Text" type="button"><img src="'+img_path+'copy.png" width="20" height="20" alt=""/></button>';b+="\t</div>";b+="</div>";b+='<div class="text_menus panel all_menus text_menu_divs" id="bot_text_menu" style="display:none; width:'+ha+'px;" >';b+='\t<div id="bottom_text_menu_div" class="text_menu_divs" >';b+='\t\t<button class="opacity_text_btn btn btn-default col-md-3" title="Adjust Opacity" type="button"><img src="'+
img_path+'opacity.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="font_text_btn btn btn-default col-md-3" title="Change Font" type="button"><img src="'+img_path+'font-icon.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="shadow_text_btn btn btn-default col-md-3" title="Shadow" type="button"><img src="'+img_path+'shadow.png" width="20" height="20" alt=""/></button>';b+='\t\t<button class="delete_btn btn btn-default col-md-3" title="Delete" type="button"><img src="'+
img_path+'trash.png" width="20" height="20" alt=""/></button>';b+="\t</div>";b+='\t<div id="font_text_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="font_text_fontsize" class="col-md-7 text-left control-label small">Font Size:</label>';b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontsize" >';
for(a=1;150>=a;a++)b+="\t\t\t\t\t\t\t<option "+(20==a?'selected="selected"':"")+' value="'+a+'">'+a+"</option>";b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="font_text_fontfamily" class="col-md-3 text-left control-label small">Font Family:</label>';b+='\t\t\t\t\t<div class="col-md-9">';b+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontfamily" >';a="Arial;Calibri;Courier New;Myriad Pro;Delicious;Verdana;Georgia;Courier;Comic Sans MS;Impact;Monaco".split(";");
0<fonts.length&&(a=$.merge(a,fonts),a.sort());$.each(a,function(g,h){h=h.split(":");g=h[0];1<h.length?(h=h[1],"italic"==h?b+='\t\t\t\t\t\t\t<option style="font-family:'+g+'; font-style:italic" value="'+g+':italic">'+g+" (Italic)</option>":"bold"==h?b+='\t\t\t\t\t\t\t<option style="font-family:'+g+'; font-weight:bold; font-style:normal" value="'+g+':bold">'+g+" (Bold)</option>":"bolditalic"==h&&(b+='\t\t\t\t\t\t\t<option style="font-family:'+g+'; font-weight:bold; font-style:italic" value="'+g+':bolditalic">'+
g+" (Bold-Italic)</option>")):b+='\t\t\t\t\t\t\t<option style="font-family:'+g+'" value="'+g+'">'+g+"</option>"});b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="font_text_color_colorpicker" class="col-md-8 text-left control-label small">Font Color:</label>';b+='\t\t\t\t\t<div class="col-md-4">';b+='\t\t\t\t\t\t<input id="font_text_color_colorpicker" class="colorpicker font_option"/>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";
b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="font_text_textalign" class="col-md-6 text-left control-label small">Text Align:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_textalign" >';b+='\t\t\t\t\t\t\t<option value="left">Left</option>';b+='\t\t\t\t\t\t\t<option value="center">Center</option>';b+='\t\t\t\t\t\t\t<option value="right">Right</option>';b+='\t\t\t\t\t\t\t<option value="justify">Justify</option>';
b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group" style="display:none;">';b+='\t\t\t\t\t<label for="font_text_fontstyle" class="col-md-6 text-left control-label small">Font Style:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontstyle" >';b+='\t\t\t\t\t\t\t<option value="normal">Normal</option>';b+='\t\t\t\t\t\t\t<option value="italic">Italic</option>';b+='\t\t\t\t\t\t\t<option value="oblique">Oblique</option>';
b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="font_text_textdecoration" class="col-md-6 text-left control-label small">Font Decoration:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_textdecoration" >';b+='\t\t\t\t\t\t\t<option value="normal">Normal</option>';b+='\t\t\t\t\t\t\t<option value="underline">Underline</option>';b+='\t\t\t\t\t\t\t<option value="overline">Overline</option>';
b+='\t\t\t\t\t\t\t<option value="line-through">Line-Through</option>';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group" style="display:none;">';b+='\t\t\t\t\t<label for="font_text_fontweight" class="col-md-6 text-left control-label small">Font Weight:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontweight" >';b+='\t\t\t\t\t\t\t<option value="normal">Normal</option>';
b+='\t\t\t\t\t\t\t<option value="bold">Bold</option>';b+='\t\t\t\t\t\t\t<option value="400">400</option>';b+='\t\t\t\t\t\t\t<option value="600">600</option>';b+='\t\t\t\t\t\t\t<option value="800">800</option>';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="font_text_fontlineheight_text" for="font_text_fontlineheight" style="width:55%;" class="col-md-7 control-label small">Line Height:</label>';b+='\t\t\t\t\t<div class="col-md-5" style="width:45%;">';
b+='\t\t\t\t\t\t<input id="font_text_fontlineheight" class="font_option" type="range" max="3" min="1" step=".1" value="1">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="font_text_fontstrokewidth_text" for="font_text_fontstrokewidth" style="width:55%;" class="col-md-7 text-left control-label small">Stroke Width:</label>';b+='\t\t\t\t\t<div class="col-md-5" style="width:45%;">';b+='\t\t\t\t\t\t\t<input id="font_text_fontstrokewidth" class="font_option" type="range" max="5" min="0" step=".25" value="0">';
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="font_text_fontstroke_colorpicker_text" class="col-md-8 text-left control-label small">Stroke Color:</label>';b+='\t\t\t\t\t<div class="col-md-4">';b+='\t\t\t\t\t\t<input id="font_text_fontstroke_colorpicker" class="colorpicker font_option"/>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Font Mode" id="exit_font_text_mode" style="width:100%" class="btn btn-default" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Font Mode</span></button>';
b+="\t</div>";b+='\t<div id="shadow_text_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="shadow_text_status" class="col-md-7 control-label small">Shadow:</label>';b+='\t\t\t\t\t<div class="col-md-5">';b+='\t\t\t\t\t\t<select class="form-control small shadow_text" id="shadow_text_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="shadow_text_blur_text" for="shadow_text_blur" class="col-md-6 text-left control-label small">Blur:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="shadow_text_blur" class="shadow_text" type="range" max="50" min="0" step="2" value="10">';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="shadow_text_offsetx_text" for="shadow_text_offsetx" class="col-md-6 text-left control-label small">Offset-X:</label>';
b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="shadow_text_offsetx" class="shadow_text" type="range" max="50" min="-50" step="2" value="10">';b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="shadow_text_offsety_text" for="shadow_text_offsety" class="col-md-6 text-left control-label small">Offset-Y:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="shadow_text_offsety" class="shadow_text" type="range" max="50" min="-50" step="2" value="10">';
b+="\t\t\t\t\t\t</select>";b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label for="shadow_text_colorpicker" class="col-md-8 text-left control-label small">Color:</label>';b+='\t\t\t\t\t<div class="col-md-4">';b+='\t\t\t\t\t\t<input class="shadow_text colorpicker" id="shadow_text_colorpicker"/>';b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Shadow Mode" style="width:100%" class="btn btn-default exit_text_shadow_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Shadow Mode</span></button>';
b+="\t</div>";b+='\t<div id="opacity_text_div" class="" style="display:none;">';b+='\t\t<div class="panel panel-default">';b+='\t\t\t<div class="panel-body form-horizontal">';b+='\t\t\t\t<div class="form-group">';b+='\t\t\t\t\t<label id="opacity_text_value_text" for="opacity_text_value" class="col-md-6 text-left control-label small">Opacity:</label>';b+='\t\t\t\t\t<div class="col-md-6">';b+='\t\t\t\t\t\t<input id="opacity_text_value" type="range" min="0" max="100" step="5" value="100">';b+="\t\t\t\t\t\t</select>";
b+="\t\t\t\t\t</div>";b+="\t\t\t\t</div>";b+="\t\t\t</div>";b+="\t\t</div>";b+='\t\t<button title="Exit Opacity Mode" style="width:100%" id="exit_text_opacity_mode" class="btn btn-default" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Opacity Mode</span></button>';b+="\t</div>";b+="</div>";a=!0}a&&(d.set("replaced",!1),$("#canvas_div").append(b),$(".colorpicker").spectrum({showPalette:!0,clickoutFiresChange:!0,color:"#000000",showAlpha:!0,palette:["#000 #444 #666 #999 #ccc #eee #f3f3f3 #fff".split(" "),
"#f00 #f90 #ff0 #0f0 #0ff #00f #90f #f0f".split(" "),"#f4cccc #fce5cd #fff2cc #d9ead3 #d0e0e3 #cfe2f3 #d9d2e9 #ead1dc".split(" "),"#ea9999 #f9cb9c #ffe599 #b6d7a8 #a2c4c9 #9fc5e8 #b4a7d6 #d5a6bd".split(" "),"#e06666 #f6b26b #ffd966 #93c47d #76a5af #6fa8dc #8e7cc3 #c27ba0".split(" "),"#c00 #e69138 #f1c232 #6aa84f #45818e #3d85c6 #674ea7 #a64d79".split(" "),"#900 #b45f06 #bf9000 #38761d #134f5c #0b5394 #351c75 #741b47".split(" "),"#600 #783f04 #7f6000 #274e13 #0c343d #073763 #20124d #4c1130".split(" ")]}),
setTimeout(function(){p(d);$(".text_menus").show();loadMenuValues(d);la=!1},50));I=c});loadMenuValues=function(a){if("Textbox"==S)$("#font_text_fontsize").val(a.fontSize),$("#font_text_color_colorpicker").spectrum("set",a.fill),$("#font_text_textalign").val(a.textAlign),$("#font_text_fontstyle").val(a.fontStyle),$("#font_text_fontweight").val(a.fontWeight),"italic"==a.fontStyle&&"bold"==a.fontWeight?$("#font_text_fontfamily").val(a.fontFamily+":bolditalic"):"normal"==a.fontStyle&&"bold"==a.fontWeight?
$("#font_text_fontfamily").val(a.fontFamily+":bold"):"italic"==a.fontStyle&&"normal"==a.fontWeight?$("#font_text_fontfamily").val(a.fontFamily+":italic"):$("#font_text_fontfamily").val(a.fontFamily),$("#font_text_textdecoration").val(a.textDecoration),$("#font_text_fontlineheight").val(a.lineHeight),$("#font_text_fontlineheight_text").html("Line Height:&nbsp;&nbsp;"+a.lineHeight),$("#font_text_fontstroke_colorpicker").spectrum("set",a.stroke),$("#font_text_fontstrokewidth").val(a.strokeWidth),$("#font_text_fontstrokewidth_text").html("Stroke Width:&nbsp;&nbsp;"+
a.strokeWidth),a.shadow&&($("#shadow_text_status").val("ON"),$("#shadow_text_blur").val(a.shadow.blur),$("#shadow_text_offsetx").val(a.shadow.offsetX),$("#shadow_text_offsety").val(a.shadow.offsetY),$("#shadow_text_colorpicker").spectrum("set",a.shadow.color),Ga("text",a.shadow)),$("#opacity_text_value").val(a.opacity/.01),$("#opacity_text_value_text").html("Opacity:&nbsp;&nbsp;"+a.opacity/.01);else if("CzImage"==S){0==a.strokeWidth&&null!=a.frame_round_border?$("#border_image_size").val(a.my.strokeWidth):
0==a.strokeWidth?$("#border_image_size").val(1):$("#border_image_size").val(a.strokeWidth);null!=a.frame_round_border?$("#border_image_colorpicker").spectrum("set",a.frame_round_border.stroke):a.stroke&&$("#border_image_colorpicker").spectrum("set",a.stroke);a.strokeDashArray&&$("#border_image_line_style").val($.isEmptyObject(a.strokeDashArray)?"solid":"dashed");a.my?($("#border_image_status").val(a.my.hasBorder),$("#border_image_frame_style").val(a.my.frame_style),hb(a.my.frame_style),$("#border_image_frame_radius").val(a.my.radius),
$("#border_image_frame_radius_offsetx").val(a.my.offsetx),$("#border_image_frame_radius_offsety").val(a.my.offsety),$("#border_image_frame_radius_width").val(a.my.oval_width),$("#border_image_frame_radius_height").val(a.my.oval_height),$("#border_image_radius").val(a.my.corner_radius),$("#border_image_colorpicker").val(a.my.stroke),Ia(a.my)):($("#border_image_status").val("OFF"),Ha(!0));a.shadow&&($("#shadow_image_status").val("ON"),$("#shadow_image_blur").val(a.shadow.blur),$("#shadow_image_offsetx").val(a.shadow.offsetX),
$("#shadow_image_offsety").val(a.shadow.offsetY),$("#shadow_image_colorpicker").spectrum("set",a.shadow.color),Ga("image",a.shadow));a.my&&a.my.hasGrayscale&&"ON"==a.my.hasGrayscale?$("#grayscale_image_status").val("ON"):$("#grayscale_image_status").val("OFF");var c=0,d=M(a,"Brightness");null!=d&&(c=Math.round(a.filters[d].brightness/2.55));$("#brightness_image_value").val(c);sa("brightness",c);c=0;d=M(a,"Contrast");null!=d&&(c=a.filters[d].contrast);$("#contrast_image_value").val(c);sa("contrast",
c);$("#opacity_image_value").val(a.opacity/.01);$("#opacity_image_value_text").html("Opacity:&nbsp;&nbsp;"+a.opacity/.01)}};f.on("object:scaling",function(a){a=f.getActiveObject();$(".all_menus").is(":visible")&&$(".all_menus").hide();xlimit=ylimit=30*m;a.scaleX>xlimit&&(a.scaleX=xlimit);a.scaleY>ylimit&&(a.scaleY=ylimit);xmin=ymin=.05*m;a.scaleX<xmin&&(a.scaleX=xmin);a.scaleY<ymin&&(a.scaleY=ymin)});f.on("object:rotating",function(a){f.getActiveObject();$(".all_menus").hide()});f.on("object:modified",
function(a){a=f.getActiveObject();p(a);y=!0;E()});f.on("mouse:up",function(a){!cropping&&a.target&&a.target.type&&p(a.target)});f.on("object:moving",function(a){if(Wa)return Wa=!1;if(!cropping){$(".all_menus").hide();var c=a.target,d=c.getWidth()/2,e=c.getHeight()/2,b=-d,g=-e;d=c.canvas.width-d;e=c.canvas.height-e;if(c.top<g||c.left<b)c.top=Math.max(c.top,g),c.left=Math.max(c.left,b);if(c.top>e||c.left>d)c.top=Math.min(c.top,e),c.left=Math.min(c.left,d);ka&&P&&a.target.set({left:Math.round(a.target.left/
(J*m))*J*m+safe*m,top:Math.round(a.target.top/(J*m))*J*m+safe*m})}});var Xa,Ya,Za=!1,R,vb,wb,$a=!1,Wa=!1;f.on("mouse:down",function(a){Wa=!0;if(cropping){if(f.getObjects().indexOf(a.target)!=I)return x(),$(".all_menus").remove(),!1;R=f.getPointer(a.e);Xa=R.x;Ya=R.y;f.on("mouse:move",function(c){if(cropping&&!Za&&(Za=!0,setTimeout(function(){Za=!1;R=f.getPointer(c.e);vb=Xa-R.x;wb=Ya-R.y;v.zoomBy(vb,wb,0);Xa=R.x;Ya=R.y},50),0==$a)){var d=function(e){$a=!1;f.off("mouse:move");f.off("mouse:up",d);t(!1,
!0,!0)};f.on("mouse:up",d);$a=!0}})}else a.target&&a.target.type||$(".all_menus").remove()});var Ib=function(){f.forEachObject(function(a){"CzImage"===a.type&&a.filters.length&&a.applyFilters(f.renderAll.bind(f))})};$("#add_text").click(function(a){a=new fabric.Textbox("Start Typing",{fontFamily:"Arial",fontSize:20,left:f.width/6,top:f.height/6,width:150,cornerSize:20,fill:"#000",padding:7,borderDashArray:[10,5],hasRotatingPoint:!1,type:"Textbox",originX:"center",originY:"center",scaleX:m,scaleY:m,
lockScalingY:!1,stroke:"#000",strokeWidth:0,fontStyle:"normal",textDecoration:"normal",lineHeight:1,textAlign:"left",_controlsVisibility:{tl:!1,tr:!1,mt:!1,mb:!1,mr:!1,ml:!1,br:!0,bl:!0,mtr:!1},itemID:Va++});f.add(a).setActiveObject(a);a.selectAll();a.enterEditing();a.hiddenTextarea.focus();a.stateProperties.push("borderDashArray","filters","my");a.saveState();y=ua=!0;E()});var Ma;$("#canvas_div").on("click",".delete_btn",function(a){if(!confirm("Are you sure you want to remove this?"))return!1;Ma=
a=f.getActiveObject();a.remove();Q("remove",Ma);$(".all_menus").remove();removedObject=y=!0;E()});var Oa=sendObjectFront=!1;$("#canvas_div").on("click",".send_back",function(a){a=f.getActiveObject();a=f.getObjects().indexOf(a)-1;if(1==f._objects[a].bottom)return!1;f.getActiveObject().sendBackwards();Oa=y=!0;E();Oa=!1});$("#canvas_div").on("click",".bring_front",function(a){a=f.getActiveObject();a=f.getObjects().indexOf(a)+1;if(1==f._objects[a].bottom)return!1;f.getActiveObject().bringForward();sendObjectFront=
y=!0;E();sendObjectFront=!1});var T;$("#canvas_div").on("click",".crop_mode",function(a){$("#zoom_div").is(":visible")?x():(f.item(I).lockMovementX=f.item(I).lockMovementY=!0,f.item(I).lockScalingX=f.item(I).lockScalingY=!0,f.item(I).lockRotation=!0,f.item(I).setControlsVisibility({br:!1,bl:!1}),cropping=!0,T=I,$("#zoom_div, .image_menu_divs").toggle(),"square"==$("#border_image_frame_style").val()?$(".set_crop").removeAttr("disabled"):$(".set_crop").attr("disabled",!0))});$("#canvas_div").on("click",
".set_crop",function(a){if($("#crop_div").is(":visible"))return $(this).attr("disabled",!0),!1;a=f.getActiveObject();var c=a.getWidth(),d=a.getHeight(),e=a.getBoundingRect(),b=e.width,g=e.height,h=e.left;e=e.top;0!=a.angle?b='<div id="crop_parent" style="width:'+b+"px;height:"+g+"px;top:"+e+"px;left:"+h+'px; position:absolute;background:transparent;pointer-events:none;">\t<div id="crop_div" style="width:'+(.5*c+"px;height:"+.5*d+"px;top:"+d/2+"px;left:"+c/2+'px;pointer-events:auto;"></div></div>'):
(b='<div id="crop_parent" style="width:'+c+"px;height:"+d+"px;top:"+a.top+"px;left:"+a.left+'px; position:absolute;background:transparent;pointer-events:none;">',b+='\t<div id="crop_div" style="width:'+.5*c+"px;height:"+.5*d+"px;top:"+d/4+"px;left:"+c/4+'px;pointer-events:auto;"></div></div>');$("#canvas_div").append(b);$("#crop_div").resizable({handles:"n, e, s, w, nw, ne, sw,se",containment:"parent"});$("#crop_div").draggable({containment:"parent"});0!=a.angle&&$("#crop_div").rotate(a.angle,{x:"left",
y:"top"});$(".crop_now").removeAttr("disabled");$(this).attr("disabled",!0)});$("#canvas_div").on("resize","#crop_div",function(a){a.stopPropagation()});$("#canvas_div").on("click",".crop_now",function(a){if(!$("#crop_div").is(":visible"))return $(".set_crop").removeAttr("disabled"),$(".crop_now").attr("disabled",!0),!1;v.crop(!1,!1);$("#crop_parent").remove();$(".set_crop").removeAttr("disabled");$(".crop_now").attr("disabled",!0);croppedObject=y=!0;E()});var qa=!1;$("#canvas_div").on("click",".exit_crop_mode",
function(a){t(!0,!0,!0);qa=!0});var db,ia,pa=!1,ra=!1;$("#canvas_div").on("mousedown",".crop_btn",function(a){a=f.getActiveObject();if(a.width==a.cw&&a.height==a.ch&&this.width>=this.origWidth&&this.height>=this.origHeight&&!$(this).hasClass("zoom-in"))return!1;if(!pa){ia=0;ra=!1;var c=$(this);db=setInterval(function(){ra&&0<ia?X():(ia++,c.hasClass("zoom-in")?v.zoomBy(0,0,10):c.hasClass("zoom-out")?v.zoomBy(0,0,-10):c.hasClass("arrow-left")?v.zoomBy(-5,0,0):c.hasClass("arrow-up")?v.zoomBy(0,-5,0):
c.hasClass("arrow-down")?v.zoomBy(0,5,0):c.hasClass("arrow-right")&&v.zoomBy(5,0,0))},220);y=pa=!0}});$("#canvas_div").on("mouseup",".crop_btn",function(a){if(pa)if(0<ia)X();else return ra=!0,!1});var Pa=!1;$("#canvas_div").on("click",".copy_object",function(a){a=f.getActiveObject();if($(this).hasClass("copy_text"))a=fabric.Textbox.fromObject(a.toObject());else if($(this).hasClass("copy_image"))a=$.extend(!0,{},a);else return!1;a.set({top:a.get("top")+200*m,left:a.get("left")+100*m,itemID:Va++});
f.add(a).setActiveObject(a);Pa=y=!0;E()});$("#canvas_div").on("click",".brightcon_image_btn",function(a){$("#brightcon_image_div").show();$("#bottom_image_menu_div").hide();$("#top_image_menu").css("visibility","hidden")});$("#canvas_div").on("change","#brightness_image_value",function(a){a=f.getActiveObject();var c=Number($("#brightness_image_value").val());sa("brightness",c);var d=M(a,"Brightness"),e=Math.round(2.55*c);0!=c&&null==d?a.filters.push(new fabric.Image.filters.Brightness({brightness:e})):
0!=c&&0<=d?a.filters[d].brightness=e:delete a.filters[d?d:0];a.applyFilters(f.renderAll.bind(f));y=!0;E()});$("#canvas_div").on("change","#contrast_image_value",function(a){a=f.getActiveObject();var c=Number($("#contrast_image_value").val());sa("contrast",c);var d=M(a,"Contrast");0!=c&&null==d?a.filters.push(new fabric.Image.filters.Contrast({contrast:c})):0!=c&&0<=d?a.filters[d].contrast=c:delete a.filters[d?d:0];a.applyFilters(f.renderAll.bind(f));y=!0;E()});$("#canvas_div").on("click",".exit_image_brightcon_mode",
function(a){$("#brightcon_image_div").hide();$("#bottom_image_menu_div").show();$("#top_image_menu").css("visibility","")});$("#canvas_div").on("click",".opacity_image_btn, .opacity_text_btn",function(a){var c;$(this).hasClass("opacity_image_btn")?c="image":$(this).hasClass("opacity_text_btn")&&(c="text");$("#opacity_"+c+"_div").show();$("#bottom_"+c+"_menu_div").hide();$("#top_"+c+"_menu").css("visibility","hidden")});$("#canvas_div").on("change","#opacity_image_value,#opacity_text_value",function(a){a=
f.getActiveObject();var c=$(this).attr("id"),d;"opacity_image_value"==c?d="image":"opacity_text_value"==c&&(d="text");c=$("#opacity_"+d+"_value").val();$("#opacity_"+d+"_value_text").html("Opacity:&nbsp;&nbsp;"+c);a.set("opacity",.01*c);f.renderAll();y=!0;E()});$("#canvas_div").on("click","#exit_image_opacity_mode, #exit_text_opacity_mode",function(a){var c;a=$(this).attr("id");"exit_image_opacity_mode"==a?c="image":"exit_text_opacity_mode"==a&&(c="text");$("#opacity_"+c+"_div").hide();$("#bottom_"+
c+"_menu_div").show();$("#top_"+c+"_menu").css("visibility","")});$("#canvas_div").on("click",".grayscale_image_btn",function(a){$("#grayscale_image_div").show();$("#bottom_image_menu_div").hide();$("#top_image_menu").css("visibility","hidden")});$("#canvas_div").on("change","#grayscale_image_status",function(a){var c=$("#grayscale_image_status").val();a=f.getActiveObject();"my"in a||(a.my={});"ON"==c?(a.my.hasGrayscale="ON",a.filters.push(new fabric.Image.filters.Grayscale)):(c=M(a,"Grayscale"),
a.my.hasGrayscale="OFF",delete a.filters[c?c:0]);a.applyFilters(f.renderAll.bind(f));y=!0;E()});$("#canvas_div").on("click",".exit_image_grayscale_mode",function(a){$("#grayscale_image_div").hide();$("#bottom_image_menu_div").show();$("#top_image_menu").css("visibility","")});$("#canvas_div").on("click",".shadow_image_btn, .shadow_text_btn",function(a){var c;$(this).hasClass("shadow_image_btn")?c="image":$(this).hasClass("shadow_text_btn")&&(c="text");$("#shadow_"+c+"_div").show();$("#bottom_"+c+
"_menu_div").hide();$("#top_"+c+"_menu").css("visibility","hidden")});$("#canvas_div").on("change",".shadow_image, .shadow_text",function(a){var c;$(this).hasClass("shadow_image")?c="image":$(this).hasClass("shadow_text")&&(c="text");$(this);var d=$("#shadow_"+c+"_status").val();a=f.getActiveObject();var e={};e.blur=Number($("#shadow_"+c+"_blur").val());e.offsetX=Number($("#shadow_"+c+"_offsetx").val());e.offsetY=Number($("#shadow_"+c+"_offsety").val());Ga(c,e);c="ON"==d?{color:$("#shadow_"+c+"_colorpicker").spectrum("get").toRgbString(),
blur:e.blur,offsetX:e.offsetX,offsetY:e.offsetY,affectStroke:!1}:null;a.shadow=c;f.renderAll();y=!0;E()});$("#canvas_div").on("click",".exit_image_shadow_mode, .exit_text_shadow_mode",function(a){var c;$(this).hasClass("exit_image_shadow_mode")?c="image":$(this).hasClass("exit_text_shadow_mode")&&(c="text");a=c;$("#shadow_"+a+"_div").hide();$("#bottom_"+a+"_menu_div").show();$("#top_"+a+"_menu").css("visibility","")});$("#canvas_div").on("click",".border_image_btn, .font_text_btn",function(a){if($(this).hasClass("border_image_btn")){var c=
"border_image";var d="image"}else $(this).hasClass("font_text_btn")&&(c="font_text",d="text");$("#"+c+"_div").show();$("#bottom_"+d+"_menu_div").hide();$("#top_"+d+"_menu").css("visibility","hidden");"image"==d?(a=oa(),Ia(a)):"text"==d&&(a=fb(),eb(a))});$("#canvas_div").on("change",".font_option",function(a){a=$(this).attr("id");var c;"font_text_fontsize"==a?c={fontSize:1}:"font_text_fontfamily"==a?c={fontFamily:1}:"font_text_color_colorpicker"==a?c={fill:1}:"font_text_textalign"==a?c={textAlign:1}:
"font_text_fontlineheight"==a?c={lineHeight:1}:"font_text_fontstrokewidth"==a?c={strokeWidth:1}:"font_text_fontstroke_colorpicker"==a?c={stroke:1}:"font_text_fontstyle"==a?c={fontStyle:1}:"font_text_textdecoration"==a?c={textDecoration:1}:"font_text_fontweight"==a&&(c={fontWeight:1});a=f.getActiveObject();var d=fb();eb(d);var e=Number($("#font_text_fontsize").val()),b=$("#font_text_fontfamily option:selected").css("font-family"),g=$("#font_text_color_colorpicker").spectrum("get").toRgbString(),h=
$("#font_text_textalign").val(),k=$("#font_text_fontfamily option:selected").css("font-style"),n=$("#font_text_textdecoration").val(),w=$("#font_text_fontfamily option:selected").css("font-weight");"400"==w?w="normal":"700"==w&&(w="bold");var z=Number(d.lineHeight),D=$("#font_text_fontstroke_colorpicker").spectrum("get").toRgbString();d=Number(d.strokeWidth);if(c.fontFamily||c.fontStyle||c.fontWeight)a.set("fontFamily",b),a.set("fontStyle",k),a.set("fontWeight",w);c.fontSize&&a.set("fontSize",e);
c.fill&&a.set("fill",g);c.textAlign&&a.set("textAlign",h);c.textDecoration&&a.set("textDecoration",n);c.lineHeight&&a.set("lineHeight",z);c.stroke&&a.set("stroke",D);c.strokeWidth&&a.set("strokeWidth",d);f.renderAll();p(a);y=!0;E()});$("#canvas_div").on("click","#exit_font_text_mode",function(a){$("#font_text_div").hide();$("#bottom_text_menu_div").show();$("#top_text_menu").css("visibility","")});$("#canvas_div").on("change","#border_image_status",function(a){N({stroke:1,strokeWidth:1,strokeDashArray:1,
strokeLineJoin:1},!0)});$("#canvas_div").on("change.spectrum move.spectrum","#border_image_colorpicker",function(a){N({stroke:1,strokeLineJoin:1},!0)});$("#canvas_div").on("change","#border_image_size",function(a){N({strokeWidth:1},!0)});$("#canvas_div").on("change","#border_image_radius",function(a){N({strokeLineJoin:1},!0)});$("#canvas_div").on("change","#border_image_line_style",function(a){N({strokeDashArray:1},!0)});$("#canvas_div").on("change",".image_frame_option,#border_image_frame_style",
function(a){a=$("#border_image_frame_style").val();hb(a);Ha(!0)});fabric.Object.drawEllipse=function(a,c,d,e,b){a.beginPath();a.moveTo(c,d-b/2);a.bezierCurveTo(c+e/2,d-b/2,c+e/2,d+b/2,c,d+b/2);a.bezierCurveTo(c-e/2,d+b/2,c-e/2,d-b/2,c,d-b/2);a.closePath()};fabric.Object.drawRoundRect=function(a,c,d,e,b,g,h){var k=c-e/2,n=d-b/2;if(void 0===h?0:h)k=c,n=d;a.beginPath();a.moveTo(k+g,n);a.lineTo(k+e-g,n);a.quadraticCurveTo(k+e,n,k+e,n+g);a.lineTo(k+e,n+b-g);a.quadraticCurveTo(k+e,n+b,k+e-g,n+b);a.lineTo(k+
g,n+b);a.quadraticCurveTo(k,n+b,k,n+b-g);a.lineTo(k,n+g);a.quadraticCurveTo(k,n,k+g,n);a.closePath()};$("#canvas_div").on("click",".exit_image_border_mode",function(a){$("#border_image_div").hide();$("#bottom_image_menu_div").show();$("#top_image_menu").css("visibility","")});var m;BigNumber.config({DECIMAL_PLACES:15});BigNumber.config({ROUNDING_MODE:BigNumber.ROUND_HALF_UP});BigNumber.config({ERRORS:!1});var ab;window.onresize=function(){ab&&clearTimeout(ab);ab=setTimeout(function(){Ja()},100)};
var aa=new BigNumber(canvasWidth*numPages),C=10;$(".canvas-zoom-in, .canvas-zoom-out, .canvas-zoom-reset").click(function(a){if($(this).hasClass("canvas-zoom-in")){if(2==O)return!1;ta=.1;ib()}else if($(this).hasClass("canvas-zoom-out")){if(.2==O)return!1;ta=-.1;ib()}else{if(1==O)return!1;Ja();O=1;$(".canvas-zoom-out,.canvas-zoom-in").removeAttr("disabled")}$(".zoom_status").text("Zoom Scale: "+O.toFixed(1)+"x")});var ta=0,O=1;$(".canvas-zoom-out,.canvas-zoom-in").removeAttr("disabled");var r,ua=removedObject=
draggedAdded=croppedObject=!1,B=[],wa=[];$("#add_photos").click(function(a){if($("#photos_div").is(":visible"))return!1;$("#photo_message").html("");$("#photos_folder").prop("selectedIndex",0);mb(thisPage)});$("#photos_folder").change(function(a){Ua("photos");$(".image").remove();$("#thumbs").width("");a=$(this).val();$("#photo_message").html("");$.isNumeric(a)?mb(a):Cb(a)});var H=0,Ba=0;$(".panel").on("click",".close_option",function(a){a=$(this).attr("pnl");$("#"+a).hide();"background_div"==a?($(".background_thumb").remove(),
$("#background_thumbs").width("")):"photos_div"==a?($(".image").remove(),$("#thumbs").width("")):"restore_div"==a&&($(".restore_thumb").remove(),$("#restore_thumbs").width(""))});var Wb=["globalScale","grid_showing","grid","snap_grid","template"];$("#save").click(function(a){$("#save").attr("disabled",!0);y=!1;$("div.progress > div.progress-bar").css("width","0%");$("#load_status_div").show();Fb("saveData",300,[])});saveData=function(){function a(b,g){return"fontFamily"==b?g.replace(/"/g,""):g}$(".all_menus").remove();
f.deactivateAll();Bb();xa();f.globalScale=m;f.grid_showing=P;f.grid=ca;f.snap_grid=ka;is_staff_page()||(f.template=thisTemplate);var c=f.toDataURL({format:"png",left:trim,top:trim,width:f.width-2*trim,height:f.height-2*trim,quality:1,multiplier:200/(1/m*(f.width-trim))*4}),d=f.toDatalessJSON(Wb);d.backgroundImage&&0===d.backgroundImage.src.indexOf("http")&&(d.backgroundImage.src=(new URL(d.backgroundImage.src)).pathname);d.objects&&$.each(d.objects,function(b,g){g.primarySrc&&0===g.primarySrc.indexOf("http")&&
(g.primarySrc=(new URL(g.primarySrc)).pathname);g.src&&0===g.src.indexOf("http")&&(g.src=(new URL(g.src)).pathname)});var e=null;e=is_staff_page()?{page_json_data:JSON.stringify(d,a),page_thumbnail:c,id:thisTemplate}:{page:thisPage,page_json_data:JSON.stringify(d,a),page_thumbnail:c,new_template:page_template_id?1:0,page_template_id:thisTemplate};page_template_id=0;is_com_user_page()?req="/red/yrb_pges/sve_com_ajax":is_client_page()?req="/red/yrb_pges/sve_ajax":is_staff_page()&&(req="/templates/saveTemplate_ajax");
$.ajax({url:req,data:e,type:"POST",dataType:"json",success:function(b){if(!check_login_ajax(b))return!1;b?$("#load_status_div").delay(5E3).fadeOut(1E3):alert("There was a problem saving. Please try again.");La();P&&ja();$("#load_status_div").hide();ya=!1;clearInterval(pb);ob();$("#save").removeAttr("disabled");is_com_user_page()&&xb&&window.open(base_url+"red/upload_ph/mng_pge_com/"+thisPage,"_self")},xhr:function(){var b=new window.XMLHttpRequest;b.upload.addEventListener("progress",function(g){g.lengthComputable&&
(g=g.loaded/g.total*100,$("div.progress > div.progress-bar").css({width:g+"%"}),ya?$("#load_status").html("Autosaving: "+Math.floor(g)+"% Complete"):$("#load_status").html(Math.floor(g)+"% Complete"))},!1);return b}})};var ba=!1;fabric.Object.prototype.toObject=function(a){return function(){return fabric.util.object.extend(a.call(this),{my:this.my,borderDashArray:this.borderDashArray,padding:this.padding,_controlsVisibility:this._controlsVisibility,hasRotatingPoint:this.hasRotatingPoint,hasBorders:this.hasBorders,
lockScalingY:this.lockScalingY,cornerSize:this.cornerSize,frame_round_border:this.frame_round_border,name:this.name,imageID:this.imageID,graphic:this.graphic,panel:this.panel})}}(fabric.Object.prototype.toObject);var ca=20,J=0,P=!1,ka=!1;$(".nav").on("click","#change_grid",function(a){a.preventDefault();if($("#grid_settings_div").is(":visible"))return!0;$("#grid_settings_div").show()});$("#grid_settings_div").on("click","#update_grid",function(a){Kb()});$("#grid_settings_div").on("change","#show_grid",
function(a){"NO"==$(this).val()?$("#grid_options_div").hide():$("#grid_options_div").show()});if(is_com_user_page())var xb=!1;var ya=!1,pb;setInterval(function(){Lb()},6E4);$(window).bind("beforeunload",function(){return"Did you save your work? Any changes will be lost."});Ja();var A=[],F=[],l=0,la=!1,za,K=[],U=[],L=[];$(".undo").click(function(){if(0>=l)l=0;else{var a=ea(A[l-1].itemID,"itemID","","");A[l].itemID!=A[l-1].itemID&&a&&0<l-2?l-=2:l--;obj=A[l];var c=!0;a&&"Removed"!=L[l]||(f.add(obj),
Q("add",obj));-1!=$.inArray(L[l],["Added","Cloned"])&&0!=l&&(a=obj,obj.remove(),Q("remove",a),$(".all_menus").remove(),c=!1);c&&(obj.setOptions(JSON.parse(F[l])),obj.clipTo=K[l],obj.setCoords(),la=!0,f.setActiveObject(obj),"CzImage"===obj.type&&(qb(obj),"Cropped"==L[l]&&obj.rerender(null,null)),"SendBack"==U[l]?obj.bringForward():"SendFront"==U[l]&&obj.sendBackwards());y=!0;Na()}});$(".redo").click(function(){if(!(l>=F.length-1)){var a=ea(A[l+1].itemID,"itemID","","");A[l].itemID!=A[l+1].itemID&&
a&&l+2<F.length-1?l+=2:l++;obj=A[l];var c=!0;a&&-1==$.inArray(L[l],["Added","Cloned"])||(f.add(obj),Q("add",obj));"Removed"==L[l]&&(a=obj,obj.remove(),Q("add",a),$(".all_menus").remove(),c=!1);c&&(obj.setOptions(JSON.parse(F[l])),obj.clipTo=K[l],obj.setCoords(),la=!0,f.setActiveObject(obj),"CzImage"===obj.type&&(qb(obj),"Cropped"==L[l]&&obj.rerender(null,null)),"SendBack"==U[l]?obj.sendBackwards():"SendFront"==U[l]&&obj.bringForward());y=!0;Na()}f.renderAll()});$("#upload_photos").click(function(a){is_client_page()?
($(".close_option").trigger("click"),window.open(base_url+"red/upload_ph/mng_pge/"+thisPage,"_blank")):is_com_user_page()?(xb=!0,alert("Please wait while we save your file first."),$("#save").trigger("click")):is_staff_page()&&($(".close_option").trigger("click"),window.open(base_url+"red/upload_ph/mng_pge/"+thisTemplate,"_blank"))});is_com_user_page()&&$("#goBack").click(function(a){$(location).attr("href",base_url+"/red/yrb_pges/list_com")});var Aa=0;$(".nav").on("click","#restore_page",function(a){a.preventDefault();
if($("#restore_div").is(":visible"))return!0;Mb();$("#restore_div").show()});$("#restore_div").on("click",".restore_thumb",function(a){a=$("img",this).attr("restore_id");if(!confirm("Are you sure you want to restore your page to this date?"))return!1;is_com_user_page()?$(location).attr("href",base_url+"red/yrb_pges/edt_pges_com/"+thisPage+"/"+a):is_client_page()?$(location).attr("href",base_url+"red/yrb_pges/edt_pges/"+thisPage+"/"+a):is_staff_page()&&$(location).attr("href",base_url+"templates/page_templates/"+
thisTemplate+"/"+a)});$("#add_clipart").click(function(a){a.preventDefault();if($("#clipart_div").is(":visible"))return!1;$("#clipart_folder").prop("selectedIndex",0);Qa("Clipart")});$("#clipart_folder").change(function(a){Ua("clipart");$(".clipart_thumb, .clipart_cat_search_link").remove();$("#clipart_thumbs").width("");$("#clipart_search_term").val("");if(""==$(this).val())return!1;a=$(this).val().split("|")[1];Ra(a,"Clipart")});$(".image_search").click(function(a){a=$(this).attr("cat");var c=a.toLowerCase(),
d=$("#"+c+"_search_term").val();if(""==d)return!1;Ua("clipart");$("."+c+"_thumb, ."+c+"_cat_search_link, .graphic_"+c+"_thumb").remove();$("#"+c+"_thumbs").width("");$("#"+c+"_folder").val("");Ob(a,d)});$("#clipart_thumbs").on("click",".clipart_cat_search_link",function(a){a=$(this).attr("category");$("#clipart_folder").val(a).change()});$("#border_thumbs").on("click",".border_cat_search_link",function(a){a=$(this).attr("category");$("#border_folder").val(a).change()});$("#background_thumbs").on("click",
".background_cat_search_link",function(a){a=$(this).attr("category");$("#background_folder").val(a).change()});$("#add_page_border").click(function(a){a.preventDefault();if($("#border_div").is(":visible"))return!1;$("#border_folder").prop("selectedIndex",0);$(".border_thumb").remove();Qa("Border")});$("#border_folder").change(function(a){$(".border_thumb, .border_cat_search_link").remove();$("#border_thumbs").width("");$("#border_search_term").val("");if(""==$(this).val())return!1;a=$(this).val().split("|")[1];
Ra(a,"Border")});$("#border_div").on("click",".border_thumb",function(a){var c=$(this).attr("image_id"),d=$("img",this).attr("src")+"/1";$("#remove_border").after('<span id="border_loading_gif"><br><i style="font-size: 1.5em;" class="fa fa-spinner fa-pulse fa-fw"></i> The border is loading...</span>');var e=f.item(0);if("border"==e.graphic){var b=new Image;b.onload=function(){e.setElement(b);e.set({src:d,primarySrc:d,imageID:c});f.renderAll();$("#border_loading_gif").remove();$(".brdr_used").each(function(g,
h){$(this).hasClass("yellow")||$(this).remove()});Q("add",{imageID:c,graphic:"border"})};b.src=d}else v.init(d,{x:0,y:0,scalex:1,scaley:1,scale:m,imageID:c,graphic:"border",evented:!1,group_photo:null});y=!0;E()});$("#border_div").on("click","#remove_border",function(a){a=f.item(0);"border"==a.graphic&&(a.remove(),$(".brdr_used").each(function(c,d){$(this).hasClass("yellow")||$(this).remove()}),y=!0,E())});$("#add_background").click(function(a){a.preventDefault();if($("#background_div").is(":visible"))return!1;
$("#background_folder").prop("selectedIndex",0);$(".background_thumb").remove();Qa("Background")});is_com_user_page()&&$("#faq").click(function(a){a.preventDefault();if($("#faq_div").is(":visible"))return!1;$("#faq_div").show()});$("#background_folder").change(function(a){$(".background_thumb, .background_cat_search_link").remove();$("#background_thumbs").width("");$("#background_search_term").val("");if(""==$(this).val())return!1;"solid"==$(this).val()?Qb():(a=$(this).val().split("|")[1],Ra(a,"Background"))});
$("#background_div").on("click",".background_thumb",function(a){if($(this).hasClass("color"))f.setBackgroundImage(null,f.renderAll.bind(f)),f.setBackgroundColor($(this).css("background-color"),f.renderAll.bind(f)),$(".bg_used").remove(),html='<div title="Color Used" class="bg_used" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>',$(this).append(html);else{var c=$(this).attr("image_id");f.setBackgroundColor("",
f.renderAll.bind(f));a=$("img",this).attr("src")+"/1";var d=new Image;d.onload=function(){f.setBackgroundImage(d.src,f.renderAll.bind(f),{originX:"left",originY:"top",left:0,top:0,width:f.width,height:f.height});$(".bg_used").remove();Q("add",{imageID:c,graphic:"background"});$("#background_loading_gif").remove()};$("#remove_background").after('<span id="background_loading_gif"><br><i style="font-size: 1.5em;" class="fa fa-spinner fa-pulse fa-fw"></i> The background is loading...</span>');d.src=a}y=
!0});$("#background_div").on("click","#remove_background",function(a){f.setBackgroundColor("",f.renderAll.bind(f));f.setBackgroundImage(null,f.renderAll.bind(f));$(".bg_used").remove();y=!0});var Ca=0;$(".nav").on("click","#add_template",function(a){a.preventDefault();if($("#template_div").is(":visible"))return!0;Rb();$("#template_div").show()});$("#template_category").change(function(a){$(".template_thumb").remove();$("#template_thumbs").width("");if(""==$(this).val())return!1;a=$(this).val().split("|")[1];
Sb(a)});$("#template_div").on("click",".template_thumb",function(a){a=$(this).attr("image_id");if(!confirm("Are you sure you want to use this template? Your current page will be erased and replaced with the template."))return!1;is_com_user_page()?$(location).attr("href",base_url+"red/yrb_pges/edt_pges_com/"+thisPage+"/0/"+a):$(location).attr("href",base_url+"red/yrb_pges/edt_pges/"+thisPage+"/0/"+a)});$(".print_draft").click(function(a){xa();a=f.toDataURL({format:"jpg",left:trim,top:trim,width:f.width-
2*trim,height:f.height-2*trim,quality:1,multiplier:1});P&&ja();(new Image).src=a;a='<img src="'+a+'" width="100%">';var c=window.open();c.document.open();c.document.write(a);c.document.close()});$("#loading").show();var Ta=null;ba?Sa():Ta=setInterval(function(){Sa()},500);setTimeout(function(){ba||(ba=!0,Sa())},1E4);$("#add_photo_to_canvas").on("click",function(a){if(tb("photos")&&r){a=$(r).attr("im_id");var c=$(r).attr("graphic")?$(r).attr("graphic"):null,d=$(r).attr("group_photo")?$(r).attr("group_photo"):
null;v.init(r.src,{x:30,y:30,scalex:1,scaley:1,scale:m,imageID:a,graphic:c,evented:!0,group_photo:d});sb()}else alert("No photo selected!")});$("#add_clipart_to_canvas").on("click",function(a){if(tb("clipart")&&r){a=$(r).attr("im_id");var c=$(r).attr("graphic")?$(r).attr("graphic"):null,d=$(r).attr("group_photo")?$(r).attr("group_photo"):null;v.init(r.src,{x:30,y:30,scalex:1,scaley:1,scale:m,imageID:a,graphic:c,evented:!0,group_photo:d});sb()}else alert("No asset selected!")});$("#add_placeholder").click(function(a){$("#plc_div").show()});
$("#aspect_ratio_select").change(function(){"custom"==$(this).val()?$(".custom_ratio_div").show():$(".custom_ratio_div").hide()});$("#add_plc_to_canvas").click(function(a){var c=$("#aspect_ratio_select").val(),d=400,e=400;"custom"==c?(a=$("#aspect_width").val(),c=$("#aspect_height").val()):(a=parseInt(c.split(":")[0]),c=parseInt(c.split(":")[1]));var b=200*m,g=c/a;a>=c?e=d*c/a:d=e*a/c;v.init(.6>=g?"/fe/assets/images/placeholder/placeholder_16_9.png":.7>=g?"/fe/assets/images/placeholder/placeholder_4_3.png":
.77>=g?"/fe/assets/images/placeholder/placeholder_5_4.png":.9>=g?"/fe/assets/images/placeholder/placeholder_3_2.png":1.1>=g?"/fe/assets/images/placeholder/placeholder_1_1.png":1.28>=g?"/fe/assets/images/placeholder/placeholder_4_5.png":1.41>=g?"/fe/assets/images/placeholder/placeholder_3_4.png":1.65>=g?"/fe/assets/images/placeholder/placeholder_2_3.png":"/fe/assets/images/placeholder/placeholder_9_16.png",{x:b,y:b,scalex:1,scaley:1,width:d,height:e,scale:m,imageID:null,graphic:null,evented:!0,group_photo:null});
y=!0;E()})});

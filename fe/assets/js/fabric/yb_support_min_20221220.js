var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(l){return l.raw=l};$jscomp.createTemplateTagFirstArgWithRaw=function(l,r){l.raw=r;return l};$jscomp.arrayIteratorImpl=function(l){var r=0;return function(){return r<l.length?{done:!1,value:l[r++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var r="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return r?r.call(l):$jscomp.arrayIterator(l)};
$jscomp.arrayFromIterator=function(l){for(var r,p=[];!(r=l.next()).done;)p.push(r.value);return p};$jscomp.arrayFromIterable=function(l){return l instanceof Array?l:$jscomp.arrayFromIterator($jscomp.makeIterator(l))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,r,p){if(l==Array.prototype||l==Object.prototype)return l;l[r]=p.value;return l};$jscomp.getGlobal=function(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var r=0;r<l.length;++r){var p=l[r];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(l,r){var p=$jscomp.propertyToPolyfillSymbol[r];if(null==p)return l[r];p=l[p];return void 0!==p?p:l[r]};
$jscomp.polyfill=function(l,r,p,t){r&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(l,r,p,t):$jscomp.polyfillUnisolated(l,r,p,t))};$jscomp.polyfillUnisolated=function(l,r,p,t){p=$jscomp.global;l=l.split(".");for(t=0;t<l.length-1;t++){var v=l[t];if(!(v in p))return;p=p[v]}l=l[l.length-1];t=p[l];r=r(t);r!=t&&null!=r&&$jscomp.defineProperty(p,l,{configurable:!0,writable:!0,value:r})};
$jscomp.polyfillIsolated=function(l,r,p,t){var v=l.split(".");l=1===v.length;t=v[0];t=!l&&t in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var G=0;G<v.length-1;G++){var P=v[G];if(!(P in t))return;t=t[P]}v=v[v.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?t[v]:null;r=r(p);null!=r&&(l?$jscomp.defineProperty($jscomp.polyfills,v,{configurable:!0,writable:!0,value:r}):r!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[v]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[v]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(v):$jscomp.POLYFILL_PREFIX+p+"$"+v),$jscomp.defineProperty(t,$jscomp.propertyToPolyfillSymbol[v],{configurable:!0,writable:!0,value:r})))};$jscomp.polyfill("Array.prototype.fill",function(l){return l?l:function(r,p,t){var v=this.length||0;0>p&&(p=Math.max(0,v+p));if(null==t||t>v)t=v;t=Number(t);0>t&&(t=Math.max(0,v+t));for(p=Number(p||0);p<t;p++)this[p]=r;return this}},"es6","es3");$jscomp.typedArrayFill=function(l){return l?l:Array.prototype.fill};
$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.owns=function(l,r){return Object.prototype.hasOwnProperty.call(l,r)};
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(l,r){for(var p=1;p<arguments.length;p++){var t=arguments[p];if(t)for(var v in t)$jscomp.owns(t,v)&&(l[v]=t[v])}return l};$jscomp.polyfill("Object.assign",function(l){return l||$jscomp.assign},"es6","es3");$jscomp.polyfill("Object.is",function(l){return l?l:function(r,p){return r===p?0!==r||1/r===1/p:r!==r&&p!==p}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(l){return l?l:function(r,p){var t=this;t instanceof String&&(t=String(t));var v=t.length;p=p||0;for(0>p&&(p=Math.max(p+v,0));p<v;p++){var G=t[p];if(G===r||Object.is(G,r))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(l,r,p){if(null==l)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(r instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return l+""};$jscomp.polyfill("String.prototype.includes",function(l){return l?l:function(r,p){return-1!==$jscomp.checkStringArgs(this,r,"includes").indexOf(r,p||0)}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(l){if(l)return l;var r=function(G,P){this.$jscomp$symbol$id_=G;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:P})};r.prototype.toString=function(){return this.$jscomp$symbol$id_};var p="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",t=0,v=function(G){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new r(p+(G||"")+"_"+t++,G)};return v},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(l){if(l)return l;l=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),p=0;p<r.length;p++){var t=$jscomp.global[r[p]];"function"===typeof t&&"function"!=typeof t.prototype[l]&&$jscomp.defineProperty(t.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return l},"es6",
"es3");$jscomp.iteratorPrototype=function(l){l={next:l};l[Symbol.iterator]=function(){return this};return l};$jscomp.iteratorFromArray=function(l,r){l instanceof String&&(l+="");var p=0,t=!1,v={next:function(){if(!t&&p<l.length){var G=p++;return{value:r(G,l[G]),done:!1}}t=!0;return{done:!0,value:void 0}}};v[Symbol.iterator]=function(){return v};return v};$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(r){return r})}},"es6","es3");
$(document).ready(function(){function l(a,b,c,e,d,k,h){var m=b-e/2,u=c-d/2;if(void 0===h?0:h)m=b,u=c;k*=1.15;a.beginPath();a.moveTo(m+k,u);a.lineTo(m+e-k,u);a.quadraticCurveTo(m+e,u,m+e,u+k);a.lineTo(m+e,u+d-k);a.quadraticCurveTo(m+e,u+d,m+e-k,u+d);a.lineTo(m+k,u+d);a.quadraticCurveTo(m,u+d,m,u+d-k);a.lineTo(m,u+k);a.quadraticCurveTo(m,u,m+k,u);a.closePath()}function r(a){var b=f.getObjects().indexOf(a),c=!1;Q=a.get("type");var e=a.get("replaced");b!=J&&cropping&&(oa(),$(".all_menus").remove());if("CzImage"==
Q){if(0==$(".image_menus").length||J!=b||e||ia){$(".all_menus").remove();var d=g;c=!0}}else if("Textbox"==Q&&(0==$(".text_menus").length||J!=b||ia)){$(".all_menus").remove();d="";d+='<div class="text_menus all_menus panel" id="top_text_menu" style="display:none; width:'+Ja+'px;">';d+='\t<div id="top_text_menu_div" class="text_menu_divs">';d+='\t\t<button class="bring_front btn btn-default col-md-3" title="Bring Forward" type="button"><img src="'+img_path+'bring_front.png" width="20" height="20" alt=""/></button>';
d+='\t\t<button class="send_back btn btn-default col-md-3" title="Send Backward" type="button"><img src="'+img_path+'send_back.png" width="20" height="20" alt=""/></button>';d+='\t\t<button class="align_horizontal_center btn btn-default col-md-2" title="Align Horizontal Center" type="button"><img src="'+img_path+'h-align-center.svg" width="20" height="20" alt=""/></button>';d+='\t\t<button class="align_vertical_center btn btn-default col-md-2" title="Align Vertical Center" type="button"><img src="'+
img_path+'v-align-center.svg" width="20" height="20" alt=""/></button>';d+='\t\t<button class="copy_object copy_text btn btn-default col-md-2" title="Copy Text" type="button"><img src="'+img_path+'copy.png" width="20" height="20" alt=""/></button>';d+="\t</div>";d+="</div>";d+='<div class="text_menus panel all_menus text_menu_divs" id="bot_text_menu" style="display:none; width:'+ja+'px;" >';d+='\t<div id="bottom_text_menu_div" class="text_menu_divs" >';d+='\t\t<button class="opacity_text_btn btn btn-default col-md-3" title="Adjust Opacity" type="button"><img src="'+
img_path+'opacity.png" width="20" height="20" alt=""/></button>';d+='\t\t<button class="font_text_btn btn btn-default col-md-3" title="Change Font" type="button"><img src="'+img_path+'font-icon.png" width="20" height="20" alt=""/></button>';d+='\t\t<button class="shadow_text_btn btn btn-default col-md-3" title="Shadow" type="button"><img src="'+img_path+'shadow.png" width="20" height="20" alt=""/></button>';d+='\t\t<button class="delete_btn btn btn-default col-md-3" title="Delete" type="button"><img src="'+
img_path+'trash.png" width="20" height="20" alt=""/></button>';d+="\t</div>";d+='\t<div id="font_text_div" class="" style="display:none;">';d+='\t\t<div class="panel panel-default">';d+='\t\t\t<div class="panel-body form-horizontal">';d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="font_text_fontsize" class="col-md-7 text-left control-label small">Font Size:</label>';d+='\t\t\t\t\t<div class="col-md-5">';d+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontsize" >';
for(c=1;150>=c;c++)d+="\t\t\t\t\t\t\t<option "+(20==c?'selected="selected"':"")+' value="'+c+'">'+c+"</option>";d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="font_text_fontfamily" class="col-md-3 text-left control-label small">Font Family:</label>';d+='\t\t\t\t\t<div class="col-md-9">';d+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontfamily" >';c="Arial;Calibri;Courier New;Myriad Pro;Delicious;Verdana;Georgia;Courier;Comic Sans MS;Impact;Monaco".split(";");
0<fonts.length&&(c=$.merge(c,fonts),c.sort());$.each(c,function(k,h){h=h.split(":");k=h[0];1<h.length?(h=h[1],"italic"==h?d+='\t\t\t\t\t\t\t<option style="font-family:'+k+'; font-style:italic" value="'+k+':italic">'+k+" (Italic)</option>":"bold"==h?d+='\t\t\t\t\t\t\t<option style="font-family:'+k+'; font-weight:bold; font-style:normal" value="'+k+':bold">'+k+" (Bold)</option>":"bolditalic"==h&&(d+='\t\t\t\t\t\t\t<option style="font-family:'+k+'; font-weight:bold; font-style:italic" value="'+k+':bolditalic">'+
k+" (Bold-Italic)</option>")):d+='\t\t\t\t\t\t\t<option style="font-family:'+k+'" value="'+k+'">'+k+"</option>"});d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="font_text_color_colorpicker" class="col-md-8 text-left control-label small">Font Color:</label>';d+='\t\t\t\t\t<div class="col-md-4">';d+='\t\t\t\t\t\t<input id="font_text_color_colorpicker" class="colorpicker font_option"/>';d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";
d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="font_text_textalign" class="col-md-6 text-left control-label small">Text Align:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_textalign" >';d+='\t\t\t\t\t\t\t<option value="left">Left</option>';d+='\t\t\t\t\t\t\t<option value="center">Center</option>';d+='\t\t\t\t\t\t\t<option value="right">Right</option>';d+='\t\t\t\t\t\t\t<option value="justify">Justify</option>';
d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group" style="display:none;">';d+='\t\t\t\t\t<label for="font_text_fontstyle" class="col-md-6 text-left control-label small">Font Style:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontstyle" >';d+='\t\t\t\t\t\t\t<option value="normal">Normal</option>';d+='\t\t\t\t\t\t\t<option value="italic">Italic</option>';d+='\t\t\t\t\t\t\t<option value="oblique">Oblique</option>';
d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="font_text_textdecoration" class="col-md-6 text-left control-label small">Font Decoration:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_textdecoration" >';d+='\t\t\t\t\t\t\t<option value="normal">Normal</option>';d+='\t\t\t\t\t\t\t<option value="underline">Underline</option>';d+='\t\t\t\t\t\t\t<option value="overline">Overline</option>';
d+='\t\t\t\t\t\t\t<option value="linethrough">Line-Through</option>';d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group" style="display:none;">';d+='\t\t\t\t\t<label for="font_text_fontweight" class="col-md-6 text-left control-label small">Font Weight:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<select class="form-control small font_option" id="font_text_fontweight" >';d+='\t\t\t\t\t\t\t<option value="normal">Normal</option>';
d+='\t\t\t\t\t\t\t<option value="bold">Bold</option>';d+='\t\t\t\t\t\t\t<option value="400">400</option>';d+='\t\t\t\t\t\t\t<option value="600">600</option>';d+='\t\t\t\t\t\t\t<option value="800">800</option>';d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label id="font_text_fontlineheight_text" for="font_text_fontlineheight" style="width:55%;" class="col-md-7 control-label small">Line Height:</label>';d+='\t\t\t\t\t<div class="col-md-5" style="width:45%;">';
d+='\t\t\t\t\t\t<input id="font_text_fontlineheight" class="font_option" type="range" max="3" min="1" step=".1" value="1">';d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label id="font_text_fontstrokewidth_text" for="font_text_fontstrokewidth" style="width:55%;" class="col-md-7 text-left control-label small">Stroke Width:</label>';d+='\t\t\t\t\t<div class="col-md-5" style="width:45%;">';d+='\t\t\t\t\t\t\t<input id="font_text_fontstrokewidth" class="font_option" type="range" max="5" min="0" step=".25" value="0">';
d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="font_text_fontstroke_colorpicker_text" class="col-md-8 text-left control-label small">Stroke Color:</label>';d+='\t\t\t\t\t<div class="col-md-4">';d+='\t\t\t\t\t\t<input id="font_text_fontstroke_colorpicker" class="colorpicker font_option"/>';d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+="\t\t\t</div>";d+="\t\t</div>";d+='\t\t<button title="Exit Font Mode" id="exit_font_text_mode" style="width:100%" class="btn btn-default" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Font Mode</span></button>';
d+="\t</div>";d+='\t<div id="shadow_text_div" class="" style="display:none;">';d+='\t\t<div class="panel panel-default">';d+='\t\t\t<div class="panel-body form-horizontal">';d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="shadow_text_status" class="col-md-7 control-label small">Shadow:</label>';d+='\t\t\t\t\t<div class="col-md-5">';d+='\t\t\t\t\t\t<select class="form-control small shadow_text" id="shadow_text_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';
d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label id="shadow_text_blur_text" for="shadow_text_blur" class="col-md-6 text-left control-label small">Blur:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<input id="shadow_text_blur" class="shadow_text" type="range" max="50" min="0" step="2" value="10">';d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label id="shadow_text_offsetx_text" for="shadow_text_offsetx" class="col-md-6 text-left control-label small">Offset-X:</label>';
d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<input id="shadow_text_offsetx" class="shadow_text" type="range" max="50" min="-50" step="2" value="10">';d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label id="shadow_text_offsety_text" for="shadow_text_offsety" class="col-md-6 text-left control-label small">Offset-Y:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<input id="shadow_text_offsety" class="shadow_text" type="range" max="50" min="-50" step="2" value="10">';
d+="\t\t\t\t\t\t</select>";d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label for="shadow_text_colorpicker" class="col-md-8 text-left control-label small">Color:</label>';d+='\t\t\t\t\t<div class="col-md-4">';d+='\t\t\t\t\t\t<input class="shadow_text colorpicker" id="shadow_text_colorpicker"/>';d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+="\t\t\t</div>";d+="\t\t</div>";d+='\t\t<button title="Exit Shadow Mode" style="width:100%" class="btn btn-default exit_text_shadow_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Shadow Mode</span></button>';
d+="\t</div>";d+='\t<div id="opacity_text_div" class="" style="display:none;">';d+='\t\t<div class="panel panel-default">';d+='\t\t\t<div class="panel-body form-horizontal">';d+='\t\t\t\t<div class="form-group">';d+='\t\t\t\t\t<label id="opacity_text_value_text" for="opacity_text_value" class="col-md-6 text-left control-label small">Opacity:</label>';d+='\t\t\t\t\t<div class="col-md-6">';d+='\t\t\t\t\t\t<input id="opacity_text_value" type="range" min="0" max="100" step="5" value="100">';d+="\t\t\t\t\t\t</select>";
d+="\t\t\t\t\t</div>";d+="\t\t\t\t</div>";d+="\t\t\t</div>";d+="\t\t</div>";d+='\t\t<button title="Exit Opacity Mode" style="width:100%" id="exit_text_opacity_mode" class="btn btn-default" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Opacity Mode</span></button>';d+="\t</div>";d+="</div>";c=!0}c&&(a.set("replaced",!1),$("#canvas_div").append(d),gb(),t(a),$(".text_menus").show(),loadMenuValues(a),ia=!1,"CzImage"===Q&&-1!=a.primarySrc.indexOf("placeholder")&&$(".flip_image_btn").attr("disabled",
!0));J=b}function p(){$(".all_menus").remove();var a=f.getActiveObject().toGroup(),b=a.left,c=a.top,e=a.width;a=a.height;f.getActiveObject().toActiveSelection();$("#canvas_div").append(g);H=b;e<H?H=b-(aa-e)/2:e>H&&(H=b+(e-aa)/2);$("#top_image_menu").css({position:"absolute",top:c-Ka-hb+"px",left:H+"px"});$("#bot_image_menu").css({position:"absolute",top:c+a+La+"px",left:H+"px"});$(".image_menus").show();gb();$(".crop_mode").attr("disabled",!0);$(".border_image_btn").attr("disabled",!0)}function t(a){if(a)if("CzImage"==
Q){$(".image_menus").hide();var b=a.getBoundingRect();a=b.width;var c=b.height,e=b.left;b=b.top;H=e;a<H?H=e-(aa-a)/2:a>H&&(H=e+(a-aa)/2);$("#top_image_menu").css({position:"absolute",top:b-Ka-hb+"px",left:H+"px"});$("#bot_image_menu").css({position:"absolute",top:b+c+La+"px",left:H+"px"});$(".image_menus").show()}else"Textbox"==Q&&($(".text_menus").hide(),b=a.getBoundingRect(),a=b.width,c=b.height,e=b.left,b=b.top,pa=e,a<ja?pa=e-(ja-a)/2:a>ja&&(pa=e+(a-ja)/2),ba=e,a<ba?ba=e-(Ja-a)/2:a>ba&&(ba=e+(a-
Ja)/2),$("#top_text_menu").css({position:"absolute",top:b-Ka-Mb+"px",left:ba+"px"}),$("#bot_text_menu").css({position:"absolute",top:b+c+La+"px",left:pa+"px"}),$(".text_menus").show())}function v(){f.forEachObject(function(a){"CzImage"!==a.type||"border"==a.graphic||a.panel||(("clipPath"in a||"clipTo"in a)&&(a.clipPath||a.clipTo)&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?x.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||
0!=a.cx||0!=a.cy||a.cw!=a.width||a.ch!=a.height)&&x.frame_round_border(null,a))})}function G(){f.forEachObject(function(a){"CzImage"===a.type?(a.stateProperties.push("borderDashArray","filters","frame_round_border","my","cw","ch","clipPath"),a.saveState()):"Textbox"===a.type&&(a.stateProperties.push("borderDashArray","filters","my"),a.saveState())})}function P(a,b,c){setTimeout(function(){if(c){var e=qa();R({stroke:1,strokeWidth:1,strokeDashArray:1,strokeLineJoin:1,oval_width:e.oval_width,oval_height:e.oval_height,
radius:e.radius},!1)}setTimeout(function(){if(b){var d=f.getActiveObject();d&&(d.applyFilters(),f.requestRenderAll())}a&&oa()},200)},100);y=!0}function oa(){f.off("mouse:move");cropping=!1;f.item(W).lockMovementX=f.item(W).lockMovementY=!1;f.item(W).lockScalingX=f.item(W).lockScalingY=!1;f.item(W).lockRotation=!1;f.item(W).setControlsVisibility({br:!0,bl:!0});$("#crop_parent").remove();$("#zoom_div").hide();$(".image_menu_divs").show()}function ib(){ra=!1;clearInterval(jb);sa=!0;Ma?Ma=!1:P(!1,!0,
!0);ta=!1;ka=0}function kb(a){var b=new fabric.Textbox(a.text,{fontFamily:a.fontFamily,fontSize:a.fontSize,left:a.left+50*q,top:a.top+50*q,width:a.width,cornerSize:20,fill:a.fill,padding:7,borderDashArray:[10,5],hasRotatingPoint:!1,type:"Textbox",originX:"center",originY:"center",scaleX:q,scaleY:q,lockScalingY:!1,stroke:a.stroke,strokeWidth:a.strokeWidth,fontStyle:a.fontStyle,textDecoration:a.textDecoration,lineHeight:a.lineHeight,textAlign:a.textAlign,shadow:a.shadow?a.shadow:null,opacity:a.opacity,
itemID:Na++});b.set(a.textDecoration,!0);return b}function lb(a){f.discardActiveObject();a.clone(function(b){var c=b.filters;b.set({top:b.get("top")+50*q,left:b.get("left")+50*q,itemID:a.itemID++,filters:[],my:Object.assign({},b.my)});f.setActiveObject(b);"CzImage"===b.type&&(c&&0<c.length?c.map(function(e){"Brightness"===e.type?b.filters.push(new fabric.Image.filters.Brightness({brightness:ua(e.brightness)})):"Contrast"===e.type?b.filters.push(new fabric.Image.filters.Contrast({contrast:ua(e.contrast)})):
b.filters.push(new fabric.Image.filters.Grayscale)}):b.filters=[new fabric.Image.filters.Brightness({brightness:.01})],b.applyFilters());b.frame_round_border&&b.my&&b.my.frame_style?(mb(b),x.frame_round_border(b.frame_round_border,b)):a.primarySrc.includes("placeholder")&&b.rerender(!1,function(){return f.renderAll()});f.add(b)})}function la(a,b){var c=null;a.filters&&0<a.filters.length&&$.each(a.filters,function(e,d){if("Grayscale"===b){if(d&&0===Object.keys(d).length)return c=e,!1}else if(Object.keys(d)[0].toLowerCase()===
b.toLowerCase())return c=e,!1});return c}function va(a,b){"brightness"==a?$("#brightness_image_value_text").html("Brightness:&nbsp;&nbsp;"+b):"contrast"==a&&$("#contrast_image_value_text").html("Contrast:&nbsp;&nbsp;"+b)}function Nb(a){var b=f.getActiveObjects();if(1===b.length){b=b[0];var c=$("#shadow_"+a+"_status").val(),e={};e.blur=Number($("#shadow_"+a+"_blur").val());e.offsetX=Number($("#shadow_"+a+"_offsetx").val());e.offsetY=Number($("#shadow_"+a+"_offsety").val());wa(a,e);c="ON"==c?{color:$("#shadow_"+
a+"_colorpicker").spectrum("get").toRgbString(),blur:e.blur,offsetX:e.offsetX,offsetY:e.offsetY,affectStroke:!1}:null;b.shadow=c}else 2<b.length&&b.forEach(function(d){if("CzImage"!==d.type||"oval"!==d.my.frame_style&&"round"!==d.my.frame_style){var k=$("#shadow_image_status").val(),h={};h.blur=Number($("#shadow_image_blur").val());h.offsetX=Number($("#shadow_image_offsetx").val());h.offsetY=Number($("#shadow_image_offsety").val());wa(a,h);k="ON"==k?{color:$("#shadow_image_colorpicker").spectrum("get").toRgbString(),
blur:h.blur,offsetX:h.offsetX,offsetY:h.offsetY,affectStroke:!1}:null;d.shadow=k}});f.renderAll()}function wa(a,b){$("#shadow_"+a+"_blur_text").html("Blur:&nbsp;&nbsp;"+b.blur);$("#shadow_"+a+"_offsetx_text").html("Offset-X:&nbsp;&nbsp;"+b.offsetX);$("#shadow_"+a+"_offsety_text").html("Offset-Y:&nbsp;&nbsp;"+b.offsetY)}function nb(a){$("#font_text_fontlineheight_text").html("Line Height:&nbsp;&nbsp;"+a.lineHeight);$("#font_text_fontstrokewidth_text").html("Stroke Width:&nbsp;&nbsp;"+a.strokeWidth)}
function ob(){return{lineHeight:$("#font_text_fontlineheight").val(),strokeWidth:$("#font_text_fontstrokewidth").val()}}function R(a,b){var c=$("#border_image_status").val(),e=$("#border_image_frame_style").val(),d=f.getActiveObject(),k=!1;if(d){"my"in d||(d.my={});if("ON"==c){d.my.hasBorder="ON";var h=$("#border_image_colorpicker").spectrum("get").toRgbString();c=Number($("#border_image_size").val());var m="dashed"==$("#border_image_line_style").val()?[15,10]:[];"CzImage"===d.type&&d.filters.length&&
d.set("opacity",.1);a=qa();d.strokeWidth=0;var u=$("#border_image_frame_radius").val(),z=Number(a.oval_width);a=Number(a.oval_height);var A=d.get("width"),F=d.get("height");e={radius:Number(u),rx:z,ry:a,stroke:h,ow:A,oh:F,offsetx:Number($("#border_image_frame_radius_offsetx").val()),offsety:Number($("#border_image_frame_radius_offsety").val()),strokeWidth:2*c,strokeDashArray:m,style:e};d.my.strokeWidth=c;x.frame_round_border(e,d)}else d.my.hasBorder="OFF",d.my.frame_style="square",d.my.corner_radius=
0,d.my.stroke="rgb(0,0,0)",d.my.strokeWidth=1,loadMenuValues(d),d.stroke="#000000",d.strokeWidth=0,d.strokeDashArray=[],d.strokeLineJoin="miter",d.clipPath=null,x.frame_round_border(null,d);b?Oa(!1):k=!0;k&&pb(d)}}function pb(a){var b=$("#opacity_image_value").val();"CzImage"===a.type&&a.filters.length?setTimeout(function(){a.applyFilters();f.requestRenderAll();a.set("opacity",.01*b);f.renderAll()},150):(a.set("opacity",.01*b),f.renderAll());y=!0;0==sa?D():sa=!1}function qb(a){"round"==a?($(".image_frame").show(),
$(".image_frame_oval").hide(),$(".border_image_radius_frame").hide()):"oval"==a?($(".image_frame").show(),$(".image_frame_round").hide(),$(".border_image_radius_frame").hide()):"square"==a&&($(".image_frame").hide(),$(".border_image_radius_frame").show());var b=$("#border_image_status").val();"round"!=a&&"oval"!=a||"ON"!=b?$(".shadow_image_btn").attr("disabled",!1):$(".shadow_image_btn").attr("disabled",!0)}function Pa(a){$("#border_image_frame_radius_text").html("Radius:&nbsp;&nbsp;"+a.radius);$("#border_image_frame_radius_offsetx_text").html("Offset-X:&nbsp;&nbsp;"+
a.offsetx);$("#border_image_frame_radius_offsety_text").html("Offset-Y:&nbsp;&nbsp;"+a.offsety);$("#border_image_frame_radius_width_text").html("Width:&nbsp;&nbsp;"+a.oval_width);$("#border_image_frame_radius_height_text").html("Height:&nbsp;&nbsp;"+a.oval_height)}function qa(){return{radius:$("#border_image_frame_radius").val(),offsetx:$("#border_image_frame_radius_offsetx").val(),offsety:$("#border_image_frame_radius_offsety").val(),oval_width:$("#border_image_frame_radius_width").val(),oval_height:$("#border_image_frame_radius_height").val()}}
function rb(a){var b=Math.min(a.height,a.width)/2;return a.my.corner_radius<=b?a.my.corner_radius:b}function Oa(a){var b=$("#border_image_status").val(),c=f.getActiveObject(),e=!1;if("CzImage"==c.type){var d=qa();Pa(d);"my"in c||(c.my={});c.my.radius=d.radius;c.my.offsetx=d.offsetx;c.my.offsety=d.offsety;c.my.oval_width=d.oval_width;c.my.oval_height=d.oval_height;var k=$("#border_image_frame_style").val();c.my.frame_style=k;if("ON"==b){c.my.hasBorder="ON";"CzImage"===c.type&&c.filters.length&&c.set("opacity",
.1);c.shadow=null;var h=c.get("width");b=c.get("height");if("round"==k)k=h>b?d.radius/100*(b/2):d.radius/100*(h/2),h=d.offsetx/100*(h/2)*((h/2-k)/(h/2)),d=d.offsety/100*(b/2)*((b/2-k)/(b/2)),c.my.x=h,c.my.y=d,c.my.circle_radius=k,c.clipPath=null,c.clipPath=new fabric.Circle({top:d,left:h,radius:k,startAngle:0,angle:2*Math.PI,originX:"center",originY:"center"});else if("square"==k){k=d.oval_width;var m=d.oval_height;k=k/100*h;m=m/100*b;h=d.offsetx/100*(h/2)*((h/2-k/2)/(h/2));d=d.offsety/100*(b/2)*
((b/2-m/2)/(b/2));c.my.x=h;c.my.y=d;c.my.oval_rx=k;c.my.oval_ry=m;c.opacity=1;c.my.strokeWidth=Number($("#border_image_size").val());c.my.stroke=$("#border_image_colorpicker").spectrum("get").toRgbString();c.my.corner_radius=Number($("#border_image_radius").val());d=rb(c);c.my.corner_radius>d&&(c.my.corner_radius=d,$("#border_image_radius").val(d));c.clipPath=null;c.clipPath=new fabric.Rect({left:-c.width/2,top:-c.height/2,width:c.width,height:c.height,rx:d,ry:d})}else k=d.oval_width,m=d.oval_height,
k=k/100*h,m=m/100*b,h=d.offsetx/100*(h/2)*((h/2-k/2)/(h/2)),d=d.offsety/100*(b/2)*((b/2-m/2)/(b/2)),c.my.x=h,c.my.y=d,c.my.oval_rx=k,c.my.oval_ry=m,c.clipPath=null,c.clipPath=new fabric.Ellipse({left:h,top:d,rx:k/2,ry:m/2,angle:0,originX:"center",originY:"center"});a?R(data,!1):e=!0}else c.my.hasBorder="OFF",c.clipTo=null,a?(data={},R(data,!1)):e=!0;e?pb(c):f.renderAll()}}function gb(){$(".colorpicker").spectrum({showPalette:!0,clickoutFiresChange:!0,color:"#000000",showAlpha:!0,palette:["#000 #444 #666 #999 #ccc #eee #f3f3f3 #fff".split(" "),
"#f00 #f90 #ff0 #0f0 #0ff #00f #90f #f0f".split(" "),"#f4cccc #fce5cd #fff2cc #d9ead3 #d0e0e3 #cfe2f3 #d9d2e9 #ead1dc".split(" "),"#ea9999 #f9cb9c #ffe599 #b6d7a8 #a2c4c9 #9fc5e8 #b4a7d6 #d5a6bd".split(" "),"#e06666 #f6b26b #ffd966 #93c47d #76a5af #6fa8dc #8e7cc3 #c27ba0".split(" "),"#c00 #e69138 #f1c232 #6aa84f #45818e #3d85c6 #674ea7 #a64d79".split(" "),"#900 #b45f06 #bf9000 #38761d #134f5c #0b5394 #351c75 #741b47".split(" "),"#600 #783f04 #7f6000 #274e13 #0c343d #073763 #20124d #4c1130".split(" ")]})}
function Qa(){var a=new BigNumber(f.width),b=new BigNumber($("#canvas_size").width());new BigNumber(1);if(f.width!=$("#canvas_size").width()){$(".all_menus").remove();f.discardActiveObject();b=b.div(a);q=q?Number(b.times(q).toFixed(E)):a.lt(ca)?Number(b.times(a.div(ca)).toFixed(E)):Number(b.times(ca.div(a)).toFixed(E));a=f.getObjects();for(var c in a)a[c].scaleX=Number(b.times(a[c].scaleX).toFixed(E)),a[c].scaleY=Number(b.times(a[c].scaleY).toFixed(E)),a[c].left=Number(b.times(a[c].left).toFixed(E)),
a[c].top=Number(b.times(a[c].top).toFixed(E)),a[c].setCoords();f.backgroundImage&&(f.backgroundImage.scaleX=Number(b.times(f.backgroundImage.scaleX).toFixed(E)),f.backgroundImage.scaleY=Number(b.times(f.backgroundImage.scaleY).toFixed(E)));c=Number(b.times(f.getWidth()).toFixed(E));b=Number(b.times(f.getHeight()).toFixed(E));f.setWidth(c);f.setHeight(b);f.renderAll();f.calcOffset();$("#canvas_div").css("width",c);$("#canvas_div").css("height",b)}else b=a.div(b),q=q?Number(b.times(q).toFixed(E)):a.lt(ca)?
Number(b.times(a.div(ca)).toFixed(E)):Number(b.times(ca.div(a)).toFixed(E))}function sb(){$(".all_menus").remove();f.discardActiveObject();new BigNumber(1);var a=new BigNumber(q);q+=xa;S+=xa;.2>q?(S=q=.2,$(".canvas-zoom-out").attr("disabled",!0)):$(".canvas-zoom-out").removeAttr("disabled");2<q?(S=q=2,$(".canvas-zoom-in").attr("disabled",!0)):$(".canvas-zoom-in").removeAttr("disabled");a=(new BigNumber(q)).div(a);var b=f.getObjects();for(c in b)b[c].scaleX=Number(a.times(b[c].scaleX).toFixed(E)),
b[c].scaleY=Number(a.times(b[c].scaleY).toFixed(E)),b[c].left=Number(a.times(b[c].left).toFixed(E)),b[c].top=Number(a.times(b[c].top).toFixed(E)),b[c].setCoords();f.backgroundImage&&(f.backgroundImage.scaleX=Number(a.times(f.backgroundImage.scaleX).toFixed(E)),f.backgroundImage.scaleY=Number(a.times(f.backgroundImage.scaleY).toFixed(E)));var c=Number(a.times(f.getWidth()).toFixed(E));a=Number(a.times(f.getHeight()).toFixed(E));f.setWidth(c);f.setHeight(a);f.renderAll();f.calcOffset();$("#canvas_div").css("width",
c);$("#canvas_div").css("height",a)}function tb(a){if(a.target){var b=a.target.get("type"),c=a.target.get("name");if("Textbox"==b||"line"==b&&"gridLine"==c)a.target=null}w&&f.fire("object:over",{e:a})}function ub(a){if(w){var b=!0,c=a.e.target,e=$(w).attr("graphic");if(c&&(-1==c.primarySrc.indexOf("placeholder")&&(b=!1),b&&"clipart"!==e)){c.hoverCursor="crosshair";f.renderAll();var d=$(w).attr("graphic")?$(w).attr("graphic"):null,k=$(w).attr("group_photo")?$(w).attr("group_photo"):null,h=$(w).attr("im_id");
var m="im";$(w).attr("group_photo")?m="grp":$(w).attr("graphic")&&(m="gr");var u=document.getElementById(m+"_"+h).naturalWidth,z=document.getElementById(m+"_"+h).naturalHeight;c.getBoundingRect();var A=c.width,F=c.height;var K=A/u;var Ra=F/z;m=Math.max(K,Ra);d={x:K<=Ra?c.left+A/2-F*u/(2*z):c.left,y:K>Ra?c.top+F/2-A*z/(2*u):c.top,scalex:m,scaley:m,scale:q,replaced:!0,imageID:h,graphic:d,evented:!0,group_photo:k,opacity:0};c.width==c.height&&--c.width;f.remove(c);x.init(w.src,d,c)}c&&b&&"clipart"!==
e||(a=f.getPointer(a.e.e),d=$(w).attr("graphic")?$(w).attr("graphic"):null,k=$(w).attr("group_photo")?$(w).attr("group_photo"):null,h=$(w).attr("im_id"),d={x:a.x,y:a.y,scalex:1,scaley:1,scale:q,imageID:h,graphic:d,evented:!0,group_photo:k},x.init(w.src,d));vb();w=null;draggedAdded=ya=y=!0}}function vb(){f.off("object:over",ub);f.off("mouse:move",tb)}function za(a){function b(d){$(".all_menus").remove();f.discardActiveObject();f.on("mouse:move",tb);f.on("object:over",ub);$(".item").removeClass("img_dragging");
$(this).addClass("img_dragging")}function c(d){$(".item").removeClass("img_dragging")}$(a+" .check_mark").mousedown(function(){return!1});var e=document.querySelectorAll(a+" img");$.each(e,function(d,k){if($(this).hasClass("check_mark"))return!0;this.addEventListener("dragstart",b,!1);this.addEventListener("dragend",c,!1)});e=document.getElementById("canvas_div");e.addEventListener("dragenter",function(d){this.classList.add("over")},!1);e.addEventListener("dragover",function(d){d=d||event;d.preventDefault();
d.dataTransfer.dropEffect="copy";return!1},!1);e.addEventListener("dragleave",function(d){this.classList.remove("over");vb()},!1);e.addEventListener("drop",function(d){d=d||event;d.preventDefault();w=document.querySelector(a+" img.img_dragging");return!1},!1)}function Ob(){if(0!==Aa.length)$.each(Aa,function(b,c){f.remove(c)}),Aa=[];else{var a=f.getObjects();$(a).reverse().each(function(b,c){"line"==c.type&&"tick"==c.name&&f.remove(c)})}}function Pb(){$.each(C,function(a,b){f.remove(b)});C=[]}function Sa(){function a(b,
c){return new fabric.Line(b,{stroke:c,strokeWidth:1,strokeUniform:!0,selectable:!1,strokeDashArray:[5,5],bottom:!0,hoverCursor:"default"})}safe1=safe*q;trim1=trim*q;bleed1=bleed*q;gutter1=gutter*q;1==numPages?(C.push(a([safe1,safe1,f.width-safe1,safe1],"green")),C.push(a([f.width-safe1,safe1,f.width-safe1,f.height-safe1],"green")),C.push(a([f.width-safe1,f.height-safe1,safe1,f.height-safe1],"green")),C.push(a([safe1,f.height-safe1,safe1,safe1],"green"))):(C.push(a([safe1,safe1,f.width/2-gutter1,safe1],
"green")),C.push(a([f.width/2-gutter1,safe1,f.width/2-gutter1,f.height-safe1],"green")),C.push(a([f.width/2-gutter1,f.height-safe1,safe1,f.height-safe1],"green")),C.push(a([safe1,f.height-safe1,safe1,safe1],"green")),C.push(a([f.width/2+gutter1,safe1,f.width-safe1,safe1],"green")),C.push(a([f.width-safe1,safe1,f.width-safe1,f.height-safe1],"green")),C.push(a([f.width-safe1,f.height-safe1,f.width/2+gutter1,f.height-safe1],"green")),C.push(a([f.width/2+gutter1,safe1,f.width/2+gutter1,f.height-safe1],
"green")));C.push(a([trim1,trim1,f.width-trim1,trim1],"blue"));C.push(a([f.width-trim1,trim1,f.width-trim1,f.height-trim1],"blue"));C.push(a([f.width-trim1,f.height-trim1,trim1,f.height-trim1],"blue"));C.push(a([trim1,f.height-trim1,trim1,trim1],"blue"));C.push(a([bleed1,bleed1,f.width-bleed1,bleed1],"red"));C.push(a([f.width-bleed1,bleed1,f.width-bleed1,f.height-bleed1],"red"));C.push(a([f.width-bleed1,f.height-bleed1,bleed1,f.height-bleed1],"red"));C.push(a([bleed1,f.height-bleed1,bleed1,bleed1],
"red"));2==numPages&&C.push(a([f.width/2,0,f.width/2,f.height],"black"));$.each(C,function(b,c){f.add(c)})}function Qb(a){L=0;$(this);$.ajax({url:base_url+"red/yrb_pges/gt_grp_ajax",data:"page="+a,type:"POST",dataType:"json",success:function(b){if(!check_login_ajax(b))return!1;if(b){if($(".image").remove(),b[0].id){$("#photos_div").show();var c=[];f.forEachObject(function(e){"CzImage"===e.type&&e.group_photo&&c.push(e.imageID)});$("#thumbs").css("height","140px");$.each(b,function(e,d){Rb(d,c)});
za("#thumbs")}}else $("#photo_message").html("No group photos were found.")}})}function Rb(a,b){var c=a.image.split("/")[1];b=-1!=$.inArray(a.id,b)?!0:!1;var e=thisPage.toString(),d=!1;if(null!=a.used_pages){var k=a.used_pages.split(",");0<k.length&&$.each(k,function(m,u){if(u!=e)return d=!0,!1})}k=a.grade_division_onphoto?a.grade_division_onphoto:"&nbsp;";c=c+"<br>"+k;a.is_roster_associated&&(c=a.is_roster_associated+"<br>"+k);a.teachergroup_name_onphoto&&(c=a.teachergroup_name_onphoto+"<br>"+k);
k='<div class="list_image image group_thumb" title="" image_id="'+a.id+'" style="max-height:140px;">';k=k+'\t<div id="img_div">\t\t<img title="'+(c+'" draggable="true" group_photo="group" im_id="'+a.id+'" id="grp_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >');b&&!d?k+='\t<div title="Image Used" id="used_grp_'+a.id+'" style="position:absolute;bottom:30px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':
d&&null!=a.used_pages&&(k+='\t<div title="Image Used On Other Pages" id="used_grp_'+a.id+'" style="position:absolute;bottom:30px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>');k=k+'\t</div>\t<div style="font-size:12px;" >'+(c+"</div></div>");$("#thumbs").append(k);var h=new Image;h.id=a.id;h.onload=function(){$("#grp_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));setTimeout(function(){var m=$('.group_thumb[image_id="'+
h.id+'"]').width();L+=m+150;$("#thumbs").css("width",L)},500)};h.src="/red/yrb_pges/get_group_thmb/"+a.image;$(".list_image.image").on("click",function(m){$(".list_image.clipart_thumb").removeClass("active");m=$(".list_image.image");for(var u=0;u<m.length;u++)$(m[u]).attr("image_id")!=$(this).attr("image_id")&&$(m[u]).removeClass("active");$(this).addClass("active");w=this.querySelector("img")})}function wb(a){L=0;$(this);is_com_user_page()?req="/red/upload_ph/srch_pge_com_ajax":is_client_page()&&
(req="/red/upload_ph/srch_pge_ajax");$.ajax({url:req,data:"page="+a+"&term=",type:"POST",dataType:"json",success:function(b){if(!check_login_ajax(b))return!1;$("#photos_div").show();if(b){if($(".image").remove(),b[0].id){var c=[];f.forEachObject(function(e){"CzImage"!==e.type||e.group_photo||e.graphic||c.push(e.imageID)});$("#thumbs").css("height","110px");$.each(b,function(e,d){Sb(d,!1,c)});za("#thumbs")}}else $("#photo_message").html("No photos were found.")}})}function Sb(a,b,c){var e="";b||(a.image=
a.image.split("|")[1],0<=a.uploaded_by.indexOf("@")&&(e="client_border"));b=-1!=$.inArray(a.id,c)?!0:!1;var d=thisPage.toString(),k=!1;1E3==a.page&&(c=a.used_pages.split("|"),0<c.length&&$.each(c,function(h,m){if(m!=d)return k=!0,!1}));e='<div class="list_image image '+e+'" title="" image_id="'+a.id+'">';e=e+'\t<div id="img_div">\t\t<img title="'+(a.o_image_name+'" draggable="true" im_id="'+a.id+'" id="im_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >');b&&!k?e+='\t<div title="Image Used" id="used_im_'+
a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':k&&""!=a.used_pages&&(e+='\t<div title="Image Used On Other Pages" id="used_im_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>');e+="\t</div></div>";$("#thumbs").append(e);e=new Image;e.id=a.id;e.onload=function(){$("#im_"+
this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));var h=$("#im_"+this.id).width(),m=$("#thumbs").width();L+=h+15;m<L&&$("#thumbs").css("width",L)};is_com_user_page()?e.src="/red/get_med_com/"+a.image:e.src="/red/get_med/"+a.image;$(".list_image.image").on("click",function(h){$(".list_image.clipart_thumb").removeClass("active");h=$(".list_image.image");for(var m=0;m<h.length;m++)$(h[m]).attr("image_id")!=$(this).attr("image_id")&&$(h[m]).removeClass("active");$(this).addClass("active");w=this.querySelector("img")})}
function Tb(a,b,c){setTimeout(function(){window[a].apply(this,c)},b)}function Ub(){f.forEachObject(function(a){"Textbox"==a.type&&(a.textDecoration&&a.set(a.textDecoration,!0),a.set("dirty",!0),a.visible=!0)})}function mb(a){a.clipPath=null;if("round"==a.my.frame_style)a.clipPath=new fabric.Circle({top:a.my.y,left:a.my.x,radius:a.my.circle_radius,startAngle:0,angle:2*Math.PI,originX:"center",originY:"center"});else if("oval"==a.my.frame_style)a.clipPath=new fabric.Ellipse({left:a.my.x,top:a.my.y,
rx:a.my.oval_rx/2,ry:a.my.oval_ry/2,angle:0,originX:"center",originY:"center"});else if("square"==a.my.frame_style){var b=rb(a);a.clipPath=new fabric.Rect({left:-a.width/2,top:-a.height/2,width:a.width,height:a.height,rx:b,ry:b})}}function xb(){console.log("load canvas");if(is_com_user_page())req="/red/yrb_pges/ld_pge_com_ajax",data={p:thisPage,page_template_id:page_template_id};else if(is_client_page())req="/red/yrb_pges/ld_pge_ajax",data={p:thisPage,page_template_id:page_template_id};else if(is_staff_page()){req=
"/templates/loadEditTemplate_ajax";data={id:thisTemplate};var a='{"objects":[],"background":"","globalScale":1,"grid_showing":true,"grid":"30","snap_grid":true}'}$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(b){if(!check_login_ajax(b))return!1;if(b){if(is_staff_page()){var c="Template: "+b.template_name;$("#template_title").text(c)}is_staff_page()&&!b.template_json_data&&(b.template_json_data=a);if(is_client_page()||is_com_user_page())var e=$.parseJSON(b);else is_staff_page()&&
(e=$.parseJSON(b.template_json_data));b=new BigNumber(e.globalScale);var d=new BigNumber(1);d=(new BigNumber(q)).div(b);d.equals(1)||$.each(e.objects,function(k,h){h.scaleX=d.times(h.scaleX).toNumber();h.scaleY=d.times(h.scaleY).toNumber();h.left=d.times(h.left).toNumber();h.top=d.times(h.top).toNumber()});e.backgroundImage&&(e.backgroundImage.scaleX=d.times(e.backgroundImage.scaleX),e.backgroundImage.scaleY=d.times(e.backgroundImage.scaleY),e.backgroundImage.src&&0===e.backgroundImage.src.indexOf("http")&&
(e.backgroundImage.src=(new URL(e.backgroundImage.src)).pathname));e.backgroundOpacity?$("#background-opacity").val(e.backgroundOpacity):$("#background-opacity").val(100);$.each(e.objects,function(k,h){h.primarySrc&&0===h.primarySrc.indexOf("http")&&(h.primarySrc=(new URL(h.primarySrc)).pathname);h.src&&0===h.src.indexOf("http")&&(h.src=(new URL(h.src)).pathname)});$.each(e.objects,function(k,h){"Textbox"==h.type&&(h.visible=!1);h._controlsVisibility&&(h._controlsVisibility.br=h._controlsVisibility.bl=
!0,h._controlsVisibility.mtr=!1);h.lockMovementX=h.lockMovementY=h.lockScalingX=h.lockScalingY=h.lockRotation=!1;h.my||(h.stroke="rgb(0, 0, 0)");h.my&&""==h.my.stroke&&(h.my.stroke="rgb(0, 0, 0)",h.stroke="rgb(0, 0, 0)");h.filters&&0<h.filters.length&&(h.tempFilters=h.filters,h.filters=[]);h.clipPath=null;h.frame_round_border&&h.my&&h.my.frame_style&&mb(h);"line"===h.type&&(h.selectable=!1)});console.log("before load from json");f.loadFromJSON(e,function(){console.log("after load from json");v();
setTimeout(function(){Ub();Vb();G();Aa=[];Ob();Sa();yb(e);$("#loading").hide();if(is_com_user_page()||is_client_page())page_template_id||(thisTemplate=e.template?e.template:0)},300)})}else Sa(),yb(!1),$("#loading").hide();zb();$(".undo_div").show()}})}function ma(){var a=$("#c").width(),b=$("#c").height();safe1=safe*q;M=da*q;for(var c=1;c<(a-2*safe1)/M;c++){var e=new fabric.Line([c*M+safe1,0+safe1,c*M+safe1,b-safe1],{stroke:"#ccc",strokeWidth:1,strokeUniform:!0,selectable:!1,name:"gridLine",bottom:!0,
hoverCursor:"default"});f.add(e);f.sendToBack(e)}for(c=1;c<(b-2*safe1)/M;c++)e=new fabric.Line([0+safe1,c*M+safe1,a-safe1,c*M+safe1],{stroke:"#ccc",strokeWidth:1,strokeUniform:!0,selectable:!1,name:"gridLine",bottom:!0,hoverCursor:"default"}),f.add(e),f.sendToBack(e);T=!0;Wb()}function Ba(){var a=f.getObjects();$(a).reverse().each(function(b,c){"line"==c.type&&"gridLine"==c.name&&f.remove(c)})}function yb(a){a?($("#show_grid").val(1==a.grid_showing?"YES":"NO"),$("#grid_spacing").val(a.grid),da=a.grid,
$("#snap_grid").val(1==a.snap_grid?"YES":"NO"),na=a.snap_grid,$("#show_grid").trigger("change"),a.grid_showing&&ma()):($("#show_grid").val("YES"),$("#grid_spacing").val("10"),da=10,$("#snap_grid").val("YES"),na=!0,$("#show_grid").trigger("change"),ma())}function Xb(){$("#update_grid").before('<span id="grid_loading_gif"><i style="font-size: 1.5em;" class="fa fa-spinner fa-pulse fa-fw"></i></span>');setTimeout(function(){"NO"==$("#show_grid").val()?(Ba(),T=!1):da==$("#grid_spacing").val()&&T||(Ba(),
da=$("#grid_spacing").val(),ma(),T=!0);$("#grid_loading_gif").remove();na="YES"==$("#snap_grid").val()?!0:!1},20);y=!0}function zb(){Ab=setInterval(function(){Ca=!0;y?$("#save").trigger("click"):Ca=!1},3E5)}function Yb(){if(is_com_user_page())req="/red/yrb_pges/pg_lk_com_ajax",data={p:thisPage};else if(is_client_page())req="/red/yrb_pges/pg_lk_ajax",data={p:thisPage};else if(is_staff_page())return;$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(a){if(!check_login_ajax(a))return!1;
a||alert("We could not update your page status. Please save and then reload this page. Thank You.")}})}function D(){var a=f.getActiveObject();if(a){if(0==n&&0==B.length)B=[],I=[],N=[],X=[],O=[],Y=[],draggedAdded?draggedAdded=!1:(I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,Z(n,a),O[n]=null,n++),a.saveState(),I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,Z(n,a),ea(n,a),Y.push(a.itemID);else{if(n<B.length-1){for(var b=0,c=B.length-1;0<c;--c)if(c>n||c==n&&B[c-1].itemID!=
B[n].itemID)B.splice(c,1),I.splice(c,1),N.splice(c,1),X.splice(c,1),O.splice(c,1),b++;Y=[];$.each(B,function(e,d){-1==$.inArray(d.itemID,Y)&&Y.push(d.itemID)});Da=a;n>B.length-1&&(n=B.length-1)}-1==$.inArray(a.itemID,Y)?(n++,I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,Z(n,a),ea(n,a),n++,a.saveState(),I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,ea(n,a),Z(n,a),Y.push(a.itemID)):(a.itemID!=Da.itemID&&(n++,I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,
ea(n,a),Z(n,a)),a.saveState(),n++,I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,ea(n,a),Z(n,a))}Da=$.extend(!0,{},a)}else removedObject&&(a=Ta,a.saveState(),n++,I[n]=JSON.stringify(a._stateProperties),B[n]=a,N[n]=a.clipPath,Z(n,a),ea(n,a),Da=$.extend(!0,{},a));Ua()}function Z(a,b){X[a]=Va?"SendBack":sendObjectFront?"SendFront":null}function ea(a,b){O[a]=ya?"Added":removedObject?"Removed":Ea?"Cloned":croppedObject?"Cropped":null;ya=removedObject=Ea=croppedObject=!1}function Ua(){n>=
B.length-1?$(".redo").attr("disabled",!0):$(".redo").removeAttr("disabled");0==n?$(".undo").attr("disabled",!0):$(".undo").removeAttr("disabled")}function Bb(a){if(a.filters&&0<a.filters.length){var b=[];$.each(a.filters,function(c,e){e&&e.brightness?b.push(new fabric.Image.filters.Brightness({brightness:e.brightness})):e&&e.contrast?b.push(new fabric.Image.filters.Contrast({contrast:e.contrast})):e&&e.grayscale&&b.push(new fabric.Image.filters.Grayscale)});a.filters=[];0<b.length&&$.each(b,function(c,
e){a.filters.push(this)})}"clipPath"in a&&a.clipPath&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?x.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||0!=a.cx||0!=a.cy||a.cw!=a.width||a.ch!=a.height)&&x.frame_round_border(null,a);setTimeout(function(){a.applyFilters();f.requestRenderAll()},50)}function fa(a,b,c,e){var d=f.getObjects(),k=!1;c?$(d).each(function(h,m){if(m[b]==a&&m[e]==c)return k=!0,!1}):$(d).each(function(h,m){if(m[b]==
a)return k=!0,!1});return k}function U(a,b){var c=b.imageID,e="im",d=0;-1!=$.inArray(b.graphic,["border","background","clipart"])?e="gr":b.group_photo&&(d=18,e="grp");var k="";"background"==b.graphic?k='class="bg_used"':"border"==b.graphic&&(k='class="brdr_used"');"add"==a?(a='<div title="Image Used" id="used_'+e+"_"+c+'" '+k+' style="position:absolute;bottom:'+d+'px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>',$("#"+e+"_"+c).after(a)):
fa(c,"imageID")?b.group_photo&&(fa(c,"imageID","group_photo","group")?"gr"==e&&(fa(c,"imageID","graphic","clipart")||fa(c,"imageID","graphic","border")||$("#used_"+e+"_"+c).remove()):$("#used_"+e+"_"+c).remove()):$("#used_"+e+"_"+c).remove()}function Zb(){Fa=0;is_com_user_page()?(req="/red/yrb_pges/gt_rstr_com_ajax",data={page:thisPage}):is_client_page()?(req="/red/yrb_pges/gt_rstr_ajax",data={page:thisPage}):is_staff_page()&&(req=base_url+"templates/getRestoreTemplateThumbs_ajax",data={id:thisTemplate});
$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(a){if(!check_login_ajax(a))return!1;a?($(".restore_thumb").remove(),a&&($("#restore_div").show(),$.each(a,function(b,c){$b(c)}))):alert("It appears there are no restore points to show, or there was a problem retrieving them.")}})}function $b(a){var b='<div class="restore_thumb panel panel-default">\t<img title="Click to restore this page." restore_id="'+(a.id+'" id="restore_'+a.id+'" class="restore_item" src="'+img_path+'indicator_big.gif" width="210" >');
b+='\t<div style="font-size:12px;" >Saved by: '+a.created_by+"<br>"+a.created_at+"</div>";b+="</div>";$("#restore_thumbs").append(b);b=new Image;b.id=a.id;b.onload=function(){$("#restore_"+this.id).attr("src",this.src);var c=$("#restore_"+this.id).width(),e=$("#restore_thumbs").width();Fa+=c+20;e<Fa&&$("#restore_thumbs").css("width",Fa)};is_com_user_page()?b.src="/red/gt_rstr_img_com/"+a.page_thumbnail:is_client_page()&&(b.src="/red/gt_rstr_img/"+a.page_thumbnail)}function Wa(a){$.ajax({url:base_url+
"red/grphc/gtCtsLst_ajax",data:is_staff_page()?{type:a}:{type:a,com:is_com_user_page()},type:"POST",dataType:"json",success:function(b){if(!check_login_ajax(b))return!1;if(b){var c='<option value="">Select</option>';"Background"==a&&(c+='<option value="solid">Color Palette</option>');$.each(b,function(e,d){if("1"==d.catdisabled||"1"==d.subcatdisabled)return!0;c+='<option value="'+d.cid+"|"+d.scid+'" >'+d.category+"->"+d.subcategory+"</option>"});$("#"+a.toLowerCase()+"_folder").html(c);$("#"+a.toLowerCase()+
"_div").show()}else alert("There was a problem. Please try again.")}})}function ac(a,b){L=0;var c=a.toLowerCase();$.ajax({url:base_url+"red/grphc/srchClprt",data:"type="+a+"&term="+b,type:"POST",dataType:"json",success:function(e){if(!check_login_ajax(e))return!1;$("#"+c+"_message").text("");if(e){if($("."+c+"_thumb").remove(),e[0].id){var d=[];f.forEachObject(function(k){"CzImage"===k.type&&k.graphic&&d.push(k.imageID)});$.each(e,function(k,h){Cb(h,!1,d,c,a,!0)});"Clipart"==a&&za("#"+c+"_thumbs")}}else $("#"+
c+"_message").text("No Images Found. Please try different search terms.")}})}function Xa(a,b){L=0;var c=b.toLowerCase();is_com_user_page()?(req="/red/grphc/gtClprt_com",data={subcat_id:a,type:b}):is_client_page()?(req="/red/grphc/gtClprt",data={subcat_id:a,type:b}):is_staff_page()&&(req=base_url+"red/grphc/gtClprt",data={subcat_id:a,staff:"staff"});$.ajax({url:req,data:data,type:"POST",dataType:"json",success:function(e){if(!check_login_ajax(e))return!1;$("#"+c+"_message").text("");if(e){if($("."+
c+"_thumb").remove(),e[0].id){var d=[];f.forEachObject(function(k){"CzImage"===k.type&&k.graphic&&d.push(k.imageID)});$.each(e,function(k,h){Cb(h,!1,d,c,b,!1)});"Clipart"==b&&za("#"+c+"_thumbs")}}else $("#"+c+"_message").text("No Images Found. Please try a different category.")}})}function Cb(a,b,c,e,d,k){b||(a.image=a.image.split("|")[1]);b=-1!=$.inArray(a.id,c)?!0:!1;var h=is_staff_page()?thisTemplate.toString():thisPage.toString(),m=!1;null!=a.used_pages&&(c=a.used_pages.split(","),0<c.length&&
$.each(c,function(F,K){if(K!=h)return m=!0,!1}));c=a.id;var u=null;null!=f.backgroundImage&&(u=f.backgroundImage._element.src.replace(/^.*\/\/[^\/]+/,""));u=null!=u&&u=="/red/grphc/get_med/"+a.image+"/"+d+"/1"?!0:!1;if("Background"==d)var z="bg_used";else"Border"==d&&(z="brdr_used");if(k){k=$("#"+e+"_folder option[value='"+a.cat_id+"']").text();var A='<div class="graphic_thumb graphic_'+e+'_thumb">\t<div style="max-height: 140px;" class="list_image '+(e+'_thumb" title="" image_id="'+a.id+'">');A=
A+'\t\t<div id="img_div">\t\t\t<img graphic="'+(e+'" title="'+c+'" draggable="true" im_id="'+a.id+'" id="gr_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >');b&&!m||u?A+='\t\t<div title="Image Used" class="'+z+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':m&&null!=a.used_pages&&(A+='\t\t<div title="Image Used On Other Pages" class="yellow '+
z+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>');A=A+'\t\t</div>\t</div>\t<div category="'+(a.cat_id+'" class="'+e+'_cat_search_link" style="font-size:10px; text-align: center; text-decoration: underline; cursor:pointer;" >'+k.replace("->",":<br>")+"</div>");A+="</div>";$("#"+e+"_thumbs").css("height","140px")}else A='<div class="list_image '+e+'_thumb" title="" image_id="'+
a.id+'">',A=A+'\t<div id="img_div">\t\t<img graphic="'+(e+'" title="'+c+'" draggable="true" im_id="'+a.id+'" id="gr_'+a.id+'" class="item" src="'+img_path+'indicator_big.gif" height="100" >'),b&&!m||u?A+='\t<div title="Image Used" class="'+z+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>':m&&null!=a.used_pages&&(A+='\t<div title="Image Used On Other Pages" class="yellow '+
z+'" id="used_gr_'+a.id+'" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'yellow_check_circle.png"></div>'),A+="\t</div></div>",$("#"+e+"_thumbs").css("height","110px");$("#"+e+"_thumbs").append(A);z=new Image;z.id=a.id;z.onload=function(){$("#gr_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));var F=$("#gr_"+this.id).width(),K=$("#thumbs").width();L+=F+30;K<L&&$("#"+e+"_thumbs").css("width",L)};z.src="/red/grphc/get_med/"+
a.image+"/"+d;$(".list_image."+e+"_thumb").on("click",function(F){$(".list_image.image").removeClass("active");F=$(".list_image."+e+"_thumb");for(var K=0;K<F.length;K++)$(F[K]).attr("image_id")!=$(this).attr("image_id")&&$(F[K]).removeClass("active");$(this).addClass("active");w=this.querySelector("img")})}function Wb(){f.forEachObject(function(a){"CzImage"===a.type&&"border"==a.graphic&&a.sendToBack()})}function bc(a){return(a=a.match(/^rgb?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&
4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""}function cc(){$("#background_search_term").val("");Ga=0;var a=null;null!=f.backgroundColor&&(a=bc(f.backgroundColor).toUpperCase());$.each("#FF00FF #FF33FF #CC00CC #FF66FF #CC33CC #990099 #FF99FF #CC66CC #993399 #660066 #FFCCFF #CC99CC #996699 #663366 #330033 #CC00FF #CC33FF #9900CC #CC66FF #9933CC #660099 #CC99FF #9966CC #663399 #330066 #9900FF #9933FF #6600CC #9966FF #6633CC #330099 #6600FF #6633FF #3300CC #3300FF #0000FF #3333FF #0000CC #6666FF #3333CC #000099 #9999FF #6666CC #333399 #000066 #CCCCFF #9999CC #666699 #333366 #000033 #0033FF #3366FF #0033CC #0066FF #6699FF #3366CC #003399 #3399FF #0066CC #0099FF #99CCFF #6699CC #336699 #003366 #66CCFF #3399CC #006699 #33CCFF #0099CC #00CCFF #00FFFF #33FFFF #00CCCC #66FFFF #33CCCC #009999 #99FFFF #66CCCC #339999 #006666 #CCFFFF #99CCCC #669999 #336666 #003333 #00FFCC #33FFCC #00CC99 #66FFCC #33CC99 #009966 #99FFCC #66CC99 #339966 #006633 #00FF99 #33FF99 #00CC66 #66FF99 #33CC66 #009933 #00FF66 #33FF66 #00CC33 #00FF33 #00FF00 #33FF33 #00CC00 #66FF66 #33CC33 #009900 #99FF99 #66CC66 #339933 #006600 #CCFFCC #99CC99 #669966 #336633 #003300 #33FF00 #66FF33 #33CC00 #66FF00 #99FF66 #66CC33 #339900 #99FF33 #66CC00 #99FF00 #CCFF99 #99CC66 #669933 #336600 #CCFF66 #99CC33 #669900 #CCFF33 #99CC00 #CCFF00 #FFFF00 #FFFF33 #CCCC00 #FFFF66 #CCCC33 #999900 #FFFF99 #CCCC66 #999933 #666600 #FFFFCC #CCCC99 #999966 #666633 #333300 #FFCC00 #FFCC33 #CC9900 #FFCC66 #CC9933 #996600 #FFCC99 #CC9966 #996633 #663300 #FF9900 #FF9933 #CC6600 #FF9966 #CC6633 #993300 #FF6600 #FF6633 #CC3300 #FF3300 #FF0000 #FF3333 #CC0000 #FF6666 #CC3333 #990000 #FF9999 #CC6666 #993333 #660000 #FFCCCC #CC9999 #996666 #663333 #330000 #FF0033 #FF3366 #CC0033 #FF0066 #FF6699 #CC3366 #990033 #FF3399 #CC0066 #FF0099 #FF99CC #CC6699 #993366 #660033 #FF66CC #CC3399 #990066 #FF33CC #CC0099 #FF00CC #FFFFFF #CCCCCC #999999 #666666 #333333 #000000".split(" "),
function(b,c){b='<div class="background_thumb color" id="clr_'+b+'" title="Select This Color" style="background-color:'+c+'">&nbsp;';a==c&&(b+='<div title="Color Used" class="bg_used" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>');b+="</div>";$("#background_thumbs").append(b);c=$("#background_thumbs").width();Ga+=104;c<Ga&&$("#background_thumbs").css("width",Ga)});$("#background_div").show()}
function dc(){$.ajax({url:base_url+"red/tmplt/gtPgTmpltsLst_ajax",data:{cats:"cats",com:is_com_user_page()},type:"POST",dataType:"json",success:function(a){if(!check_login_ajax(a))return!1;var b="";a?($.each(a,function(c,e){b+='<option value="'+e.cid+"|"+e.scid+'" >'+e.category+"->"+e.subcategory+"</option>"}),$("#template_category").html(b),$("#template_category").trigger("change")):alert("Errr..., no categories exist!")}})}function ec(a){$("#template_message").html("");Ha=0;$(this);$.ajax({url:base_url+
"red/tmplt/gtPgTmplts_ajax",data:{subcat_id:a,client:"client",com:is_com_user_page()},type:"POST",dataType:"json",success:function(b){if(!check_login_ajax(b))return!1;b?($(".template_thumb").remove(),b[0].id&&($("#template_div").show(),$.each(b,function(c,e){fc(e)}))):($(".template_thumb").remove(),$("#template_message").html("No results found."))}})}function fc(a){if(a.image)var b=a.image,c="";else b="new_template.png",c="newtemplate";var e=a.template_name?a.template_name:"No Name Entered";c='<div class="template_thumb panel panel-default '+
c+'" title="" image_id="'+a.id+'" >';c+='\t\t<img title="'+e+'" template_id="'+a.id+'" id="template_'+a.id+'" class="template_item" src="'+img_path+'indicator_big.gif" width="210" >';if(a.used||a.id==thisTemplate)c+='\t<div title="Template Used" template_id="used_template_'+a.id+'" style="position:absolute;bottom:18px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+img_path+'green_check_circle.png"></div>';c+='\t<div style="font-size:12px;" >'+e+"</div></div>";$("#template_thumbs").append(c);
e=new Image;e.id=a.id;e.onload=function(){$("#template_"+this.id).attr("src",this.src.replace(/^.*\/\/[^\/]+/,""));var d=$("#template_"+this.id).width(),k=$("#template_thumbs").width();Ha+=d+15;k<Ha&&$("#template_thumbs").css("width",Ha)};e.src="/red/tmplt/get_tmpl_med/"+b}function Db(){$(".list_image").removeClass("active");w=null}function Ya(a){var b="";"photos"===a&&(b="clipart_thumb");"clipart"===a&&(b="image");a=$(".list_image."+b);b=!0;for(var c=0;c<a.length;c++)if($(a[c]).hasClass("active")){b=
!1;break}b&&(w=null)}function Eb(a){var b="";"photos"===a&&(b="clipart_thumb");"clipart"===a&&(b="image");a=$(".list_image."+b);b=!0;for(var c=0;c<a.length;c++)if($(a[c]).hasClass("active")){b=!1;break}return b}function Fb(a,b){var c=["red","green","blue","alpha"],e={};a.slice(a.indexOf("(")+1,a.indexOf(")")).split(", ").forEach(function(d,k){e[c[k]]=d});e.alpha=b;return"rgb("+e.red+", "+e.green+", "+e.blue+", "+e.alpha+")"}fabric.devicePixelRatio=2;var y=!1,Na=0,Y=[],Ma=!1;fabric.CzImage=fabric.util.createClass(fabric.Image,
{type:"CzImage",zoomedXY:!1,initialize:function(a,b){b||(b={});this.callSuper("initialize",a,b);this.set({primarySrc:b.primarySrc,cx:b.cx?b.cx:0,cy:b.cy?b.cy:0,cw:b.cw?b.cw:a.width,ch:b.ch?b.ch:a.height,itemID:Na++,imageID:b.imageID,origWidth:a.width,origHeight:a.height})},zoomBy:function(a,b,c,e){var d=this.cw,k=this.ch,h=this.cx,m=this.cy;if(a||b)this.zoomedXY=!0;this.cx+=a;this.cy+=b;c&&(this.cw-=c,this.ch-=c/(this.width/this.height));a=!1;if(this.width<this.origWidth||this.height<this.origHeight)a=
!0;c&&!this.zoomedXY?(this.cx=(this.origWidth-this.cw)/2,this.cy=(this.origHeight-this.ch)/2):c&&a&&(this.cx+=c/2,this.cy+=c/(this.width/this.height)/2,consol.log("center cx cy = ",this.cx,this.cy));a?this.cw>this.origWidth||this.ch>this.origHeight?(this.cw=d,this.ch=k,this.cx=h,this.cy=m,Ma=!0):(1>this.cw&&(this.cw=1),1>this.ch&&(this.ch=1),this.cx>this.origWidth-this.cw&&(this.cx=this.origWidth-this.cw),this.cy>this.origHeight-this.ch&&(this.cy=this.origHeight-this.ch),0>this.cx&&(this.cx=0),0>
this.cy&&(this.cy=0)):(this.cw>this.width&&(this.cw=this.width),this.ch>this.height&&(this.ch=this.height),1>this.cw&&(this.cw=1),1>this.ch&&(this.ch=1),0>this.cx&&(this.cx=0),0>this.cy&&(this.cy=0),this.cx>this.width-this.cw&&(this.cx=this.width-this.cw),this.cy>this.height-this.ch&&(this.cy=this.height-this.ch));this.cropY=this.cropX=0;this.rerender(!1,e)},crop:function(a){var b=f.getActiveObjects()[0].scaleX,c=$("#crop_div").width()/b,e=$("#crop_div").height()/b,d=$("#crop_div").position(),k=d.top/
b;this.cx+=d.left/b/this.width*this.cw;this.cy+=k/this.height*this.ch;this.cw*=c/this.width;this.ch*=e/this.height;this.width=this.cw;this.height=this.ch;this.scaleX=this.scaleY=b;this.cropX=this.cx;this.cropY=this.cy;this.zoomBy(0,0,0,a)},cropDrag:function(a,b){var c=a.getScaledWidth()/q,e=a.getScaledHeight()/q,d=this.getBoundingRect(),k=d.width,h=d.height,m=d.left;d=d.top;0!=a.angle?k='<div id="crop_parent" style="width:'+k+"px;height:"+h+"px;top:"+d+"px;left:"+m+'px; position:absolute;background:transparent;pointer-events:none;">\t<div id="crop_div" style="width:'+
(.5*c+"px;height:"+.5*e+"px;top:"+e/2+"px;left:"+c/2+'px;pointer-events:auto;"></div></div>'):(h=this.height/2-e/2,m=this.width/2-c/2,k='<div id="crop_parent" style="width:'+this.width+"px;height:"+this.height+"px;top:"+this.top+"px;left:"+this.left+'px; position:absolute;background:transparent;pointer-events:none;">',k+='\t<div id="crop_div" style="width:'+c+"px;height:"+e+"px;top:"+h+"px;left:"+m+'px;pointer-events:auto;"></div></div>');$("#canvas_div").append(k);0!=a.angle&&$("#crop_div").rotate(a.angle,
{x:"left",y:"top"});k=$("#crop_div").position();a=k.left;k=k.top;$("#crop_parent").remove();c>=this.width||e>=this.height?(this.cx=this.cy=0,this.cw=c,this.ch=e,this.width=this.cw,this.height=this.ch,this.scaleX=this.scaleY=q,this.cropX=this.cx,this.cropY=this.cy,c>=this.width&&(this.cx+=a/this.width*this.cw,this.width=this.cw*=c/this.width,this.cropX=this.cx),e>=this.height&&(this.cy+=k/this.height*this.ch,this.height=this.ch*=e/this.height,this.cropY=this.cy),c=c>=e?Math.round(this.cw-this.origWidth+
6):Math.round(this.width/this.height*(this.height-this.origHeight)+6)):(this.cw*=c/this.width,this.ch*=e/this.height,this.cx=(this.width-this.cw)/2,this.cy=(this.height-this.ch)/2,this.width=this.cw,this.height=this.ch,this.scaleX=this.scaleY=q,this.cropX=this.cx,this.cropY=this.cy,c=c>=e?Math.round(this.cw-this.origWidth+6):Math.round(this.width/this.height*(this.height-this.origHeight)+6));this.zoomBy(0,0,c,b)},rerender:function(a,b){var c=new Image,e=this;c.crossOrigin="";c.round_border=a;c.objWidth=
e.getScaledWidth();c.objHeight=e.getScaledHeight();c.onload=function(){var d=fabric.util.createCanvasElement(),k=new Image;d.width=e.width;d.height=e.height;var h=d.getContext("2d"),m=Math.floor(e.width),u=Math.floor(e.height);h.drawImage(this,e.cx,e.cy,e.cw,e.ch,0,0,m,u);if(this.round_border&&e.frame_round_border){var z=e.frame_round_border;h.setLineDash(z.strokeDashArray);h.lineWidth=z.strokeWidth+3;h.strokeStyle=z.stroke;if("round"===this.round_border){var A=m>u?z.radius/100*(u/2):z.radius/100*
(m/2);m=z.offsetx/100*(m/2)*((m/2-A)/(m/2))+m/2;u=z.offsety/100*(u/2)*((u/2-A)/(u/2))+u/2;h.arc(m,u,A,0,2*Math.PI,!1)}else if("oval"===this.round_border){A=z.rx/100*m;var F=z.ry/100*u;m=z.offsetx/100*(m/2)*((m/2-A/2)/(m/2))+m/2;u=z.offsety/100*(u/2)*((u/2-F/2)/(u/2))+u/2;h.ellipse(m,u,A/2,F/2,0,0,2*Math.PI)}else l(h,e.my.x+m/2,e.my.y+u/2,m,u,e.my.corner_radius);h.stroke()}k.onload=function(){e.setElement(this,null,{width:e.width,height:e.height});f.renderAll();e.set({left:e.left,top:e.top,angle:e.angle});
e.setCoords();b&&b(e)};k.src=d.toDataURL("image/png")};c.src=this.primarySrc},frame_round_border:null,toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{primarySrc:this.primarySrc,src:this.primarySrc,cx:this.cx,cy:this.cy,cw:this.cw,ch:this.ch,imageID:this.imageID,cropX:this.cropX,cropY:this.cropY,graphic:this.graphic,selectable:this.selectable,evented:this.evented,group_photo:this.group_photo,panel:this.panel})}});fabric.CzImage.async=!0;fabric.CzImage.fromObject=function(a,
b){fabric.util.loadImage(a.src.replace(/^.*\/\/[^\/]+/,""),function(c){fabric.Image.prototype._initFilters.call(a,a.filters,function(e){a.filters=e||[];fabric.Image.prototype._initFilters.call(a,a.resizeFilters,function(d){a.resizeFilters=d||[];d=new fabric.CzImage(c,a);b&&b(d)})})},null,a.crossOrigin)};var x={canvas:null,zoomBy:function(a,b,c){x.canvas=f;var e=x.canvas.getActiveObject();e&&e.zoomBy(a,b,c,null)},crop_by_placeholder:function(a,b){if(!a)return!0;console.log("crop_by_placeholder");f.renderAll()},
crop:function(a,b){a||(a=x.canvas.getActiveObject());if(!a)return!0;b?a.cropDrag(b,function(){a.replaced?setTimeout(function(){"clipPath"in a&&a.clipPath&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?x.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||0!=a.cx||0!=a.cy||a.cw!=a.width||a.ch!=a.height)&&x.frame_round_border(null,a)},200):(a.set("opacity",1),a.applyFilters(),f.requestRenderAll(),f.setActiveObject(a),a.saveState())}):
a.crop(function(){t(a);$("#bot_image_menu").hide();a.applyFilters();"clipPath"in a&&a.clipPath&&"my"in a&&"ON"==a.my.hasBorder&&"frame_round_border"in a&&a.frame_round_border&&"hasBorder"in a.my?x.frame_round_border(a.frame_round_border,a):("cropX"in a||"cropY"in a||0!=a.cx||0!=a.cy||a.cw!=a.width||a.ch!=a.height)&&x.frame_round_border(null,a);f.requestRenderAll()})},objManip:function(a,b){var c=x.canvas.getActiveObject();if(!c)return!0;switch(a){case "zoomBy-x":c.zoomBy(b,0,0,null);break;case "zoomBy-y":c.zoomBy(0,
b,0,null);break;case "zoomBy-z":c.zoomBy(0,0,b,null);break;default:c.set(a,c.get(a)+b)}"left"!==a&&"top"!==a||c.setCoords();x.canvas.renderAll();return!1},frame_round_border:function(a,b){x.canvas=f;b&&a?(b.set("dirty",!0),b.frame_round_border=a,b.rerender(a.style,function(){b.replaced&&(b.applyFilters(),f.requestRenderAll(),f.setActiveObject(b),b.saveState());f.renderAll()})):(b.rerender(!1,function(){b.replaced&&(b.applyFilters(),f.requestRenderAll(),f.setActiveObject(b),b.saveState());f.renderAll()}),
b.frame_round_border=null)},init:function(a,b,c){x.canvas=f;var e=new Image;e.onload=function(){var d=new fabric.CzImage(this,{originX:"left",originY:"top",left:b.x,top:b.y,scaleX:b.scalex*b.scale,scaleY:b.scaley*b.scale,primarySrc:e.src,imageID:b.imageID,graphic:b.graphic,evented:b.evented,selectable:b.evented,group_photo:b.group_photo,opacity:b.hasOwnProperty("opacity")?0==b.opacity?0:1:1,filters:[new fabric.Image.filters.Brightness({brightness:.01})]});b.width&&(d.width=b.width);b.height&&(d.height=
b.height);d.hasRotatingPoint=!1;d.cornerSize=20;d.padding=7;d.borderDashArray=[10,5];b.replaced&&d.set("replaced",!0);d.stateProperties.push("borderDashArray","filters","frame_round_border","my","cw","ch","imageID","cropY","cropX","graphic","selectable","evented","group_photo","panel");x.canvas.add(d);if("border"==d.graphic)d.sendToBack(),$("#border_loading_gif").remove(),d.saveState();else if(c){if(d.replaced){d.set("opacity",c.opacity);d.set("my",c.my);d.my.radius=c.my.radius*c.scaleX/q;"0"!=c.my.offsetx&&
(d.my.offsetx=c.my.offsetx*c.scaleX/q);"0"!=c.my.offsety&&(d.my.offsety=c.my.offsety*c.scaleX/q);"0"!=c.my.corner_radius&&(d.my.corner_radius=c.my.corner_radius/q);0!=c.my.x&&(d.my.x=c.my.x*c.scaleX/q);0!=c.my.y&&(d.my.y=c.my.y*c.scaleX/q);0<c.my.circle_radius&&(d.my.circle_radius=c.my.circle_radius*c.scaleX/q);0<c.my.strokeWidth&&(d.my.strokeWidth=c.my.strokeWidth*c.scaleX/q,d.my.strokeWidth=1<=d.my.strokeWidth?d.my.strokeWidth:1);0!=c.my.oval_rx&&(d.my.oval_rx=c.my.oval_rx*c.scaleX/q);0!=c.my.oval_ry&&
(d.my.oval_ry=c.my.oval_ry*c.scaleX/q);d.set("frame_round_border",c.frame_round_border);c.frame_round_border&&(d.frame_round_border.radius=c.frame_round_border.radius/q,0!=c.frame_round_border.ow&&(d.frame_round_border.ow=c.frame_round_border.ow*c.scaleX/q),0!=c.frame_round_border.oh&&(d.frame_round_border.oh=c.frame_round_border.oh*c.scaleX/q),0<c.frame_round_border.strokeWidth&&(d.frame_round_border.strokeWidth=c.frame_round_border.strokeWidth*c.scaleX/q));if(c.frame_round_border&&c.my&&c.my.frame_style)if(d.clipPath=
null,"round"==c.my.frame_style)d.clipPath=new fabric.Circle({top:d.my.y,left:d.my.x,radius:d.my.circle_radius,startAngle:0,angle:2*Math.PI,originX:"center",originY:"center"});else if("oval"==c.my.frame_style)d.clipPath=new fabric.Ellipse({left:d.my.x,top:d.my.y,rx:d.my.oval_rx/2,ry:d.my.oval_ry/2,angle:0,originX:"center",originY:"center"});else if("square"==c.my.frame_style){var k=Math.min(c.my.oval_ry,c.my.oval_rx)/2;k=d.my.corner_radius<=k?d.my.corner_radius:k;d.clipPath=new fabric.Rect({left:-c.my.oval_rx/
2,top:-c.my.oval_ry/2,width:c.my.oval_rx,height:c.my.oval_ry,rx:k,ry:k})}d.set("angle",c.angle);d.set("stroke",c.stroke);d.set("strokeWidth",c.strokeWidth*c.scaleX/q);d.set("strokeLineJoin",c.strokeLineJoin);d.set("strokeDashArray",c.strokeDashArray);c.shadow&&(d.set("shadow",c.shadow),0<c.shadow.blur&&(d.shadow.blur=Math.round(c.shadow.blur*c.scaleX/q)),0<c.shadow.offsetX&&(d.shadow.offsetX=Math.round(c.shadow.offsetX*c.scaleX/q)),0<c.shadow.offsetY&&(d.shadow.offsetY=Math.round(c.shadow.offsetY*
c.scaleX/q)));d.set("filters",c.filters)}x.crop(d,c);d.set("left",c.left);d.set("top",c.top);f.renderAll()}else x.canvas.discardActiveObject(),x.canvas.setActiveObject(d),d.saveState();U("add",d)};e.src=a}};aspectRatio=canvasWidth*numPages/canvasHeight;var Gb=$("#canvas_size").width(),gc=Math.round(Gb/aspectRatio);$("#canvas_div").css("width",Gb);$("#canvas_div").css("height",gc);var f=new fabric.Canvas("c",{rotationCursor:"url("+rotationCursorSRC+"), default",uniScaleTransform:!1,width:canvasWidth*
numPages,height:canvasHeight});fabric.Object.NUM_FRACTION_DIGITS=10;var J,aa=350,H,hb=30,ja=250,Ja=250,ba,pa,Mb=30,Ka=40,La=20,Q,g="";g+='<div class="image_menus all_menus panel" id="top_image_menu" style="display:none; width:'+aa+'px;">';g+='\t<div id="top_image_menu_div" class="image_menu_divs">';g+='\t\t<button class="bring_front btn btn-default col-md-2" title="Bring Forward" type="button"><img src="'+img_path+'bring_front.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="send_back btn btn-default col-md-2" title="Send Backward" type="button"><img src="'+
img_path+'send_back.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="align_horizontal_center btn btn-default col-md-2" title="Align Horizontal Center" type="button"><img src="'+img_path+'h-align-center.svg" width="20" height="20" alt=""/></button>';g+='\t\t<button class="align_vertical_center btn btn-default col-md-2" title="Align Vertical Center" type="button"><img src="'+img_path+'v-align-center.svg" width="20" height="20" alt=""/></button>';g+='\t\t<button class="crop_mode btn btn-default col-md-2" title="Crop Image" type="button"><img src="'+
img_path+'crop_zoom.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="copy_object copy_image btn btn-default col-md-2" title="Copy Image" type="button"><img src="'+img_path+'copy.png" width="20" height="20" alt=""/></button>';g+="\t</div>";g+='\t<div id="zoom_div" class="text-right" style="display:none;">';g+='\t\t<div class="col-md-6" style="padding-left: 0px; padding-right: 0px;">';g+='\t\t<button title="Zoom In" class="btn btn-default crop_btn zoom-in col-md-3 gi-1-5x" type="button"><span class="glyphicon glyphicon-zoom-in"></span></button>';
g+='\t\t<button title="Zoom Out" class="btn btn-default crop_btn zoom-out col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-zoom-out"></span></button>';g+='\t\t<button title="Move Left" class="btn btn-default crop_btn arrow-left col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-left"></span></button>';g+='\t\t<button title="Move Up" class="btn btn-default crop_btn arrow-up col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-up"></span></button>';
g+="\t\t</div>";g+='\t\t<div class="col-md-6" style="padding-left: 0px; padding-right: 0px;">';g+='\t\t<button title="Move Down" class="btn btn-default crop_btn arrow-down col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-down"></span></button>';g+='\t\t<button title="Move Right" class="btn btn-default crop_btn arrow-right col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><span class="glyphicon glyphicon-circle-arrow-right"></span></button>';
g+='\t\t<button title="Set Crop" disabled class="btn btn-default set_crop col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button"><i class="fa fa-crop"></i></button>';g+='\t\t<button title="Crop" disabled class="btn btn-default crop_now col-md-3 gi-1-5x 1inline-block-left-space-fix" type="button" style="font-size:15px;">OK</button>';g+="\t\t</div>";g+='\t\t<button title="Exit Crop Mode" style="width:100%" class="btn btn-default exit_crop_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Crop Mode</span></button>';
g+="\t</div>";g+="</div>";g+='<div class="image_menus panel all_menus image_menu_divs" id="bot_image_menu" style="display:none; width:'+aa+'px;" >';g+='\t<div id="bottom_image_menu_div" class="image_menu_divs" >';g+='\t\t<button class="brightcon_image_btn btn btn-default " title="Adjust Brightness/Contrast" type="button"><img src="'+img_path+'brightness_contrast.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="opacity_image_btn btn btn-default " title="Adjust Opacity" type="button"><img src="'+
img_path+'opacity.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="grayscale_image_btn btn btn-default " title="Grayscale" type="button"><img src="'+img_path+'grayscale.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="border_image_btn btn btn-default " title="Border" type="button"><img src="'+img_path+'border.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="shadow_image_btn btn btn-default " title="Shadow" type="button"><img src="'+img_path+
'shadow.png" width="20" height="20" alt=""/></button>';g+='\t\t<button class="flip_image_btn btn btn-default " title="Flip" type="button"><img src="'+img_path+'flip.svg" width="20" height="20" alt=""/></button>';g+='\t\t<button class="delete_btn btn btn-default " title="Delete" type="button"><img src="'+img_path+'trash.png" width="20" height="20" alt=""/></button>';g+="\t</div>";g+='\t<div id="border_image_div" class="" style="display:none;">';g+='\t\t<div class="panel panel-default">';g+='\t\t\t<div class="panel-body form-horizontal">';
g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="border_image_status" class="col-md-7 control-label small">Border:</label>';g+='\t\t\t\t\t<div class="col-md-5">';g+='\t\t\t\t\t\t<select class="form-control small" id="border_image_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="border_image_size" class="col-md-7 text-left control-label small">Size:</label>';
g+='\t\t\t\t\t<div class="col-md-5">';g+='\t\t\t\t\t\t<select class="form-control small" id="border_image_size" >';for(var Ia=1;100>=Ia;Ia++)g+='\t\t\t\t\t\t\t<option value="'+Ia+'">'+Ia+"</option>";g+="\t\t\t\t\t\t</select>";g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="border_image_colorpicker" class="col-md-8 text-left control-label small">Color:</label>';g+='\t\t\t\t\t<div class="col-md-4">';g+='\t\t\t\t\t\t<input id="border_image_colorpicker" class="colorpicker"/>';
g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="border_image_line_style" class="col-md-6 text-left control-label small">Line Style:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<select class="form-control small" id="border_image_line_style" >';g+='\t\t\t\t\t\t\t<option value="solid">Solid</option><option value="dashed">Dashed</option>';g+="\t\t\t\t\t\t</select>";g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';
g+='\t\t\t\t\t<label for="border_image_frame_style" class="col-md-6 text-left control-label small">Frame Style:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<select class="form-control small" id="border_image_frame_style" >';g+='\t\t\t\t\t\t\t<option value="square">Square</option><option value="round">Round</option><option value="oval">Oval</option>';g+="\t\t\t\t\t\t</select>";g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group image_frame image_frame_round" style="display:none;">';
g+='\t\t\t\t\t<label id="border_image_frame_radius_text" for="border_image_frame_radius" class="col-md-6 control-label small">Radius:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="border_image_frame_radius" class="image_frame_option" type="range" max="100" min="10" step="5" value="30">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group image_frame" style="display:none;">';g+='\t\t\t\t\t<label id="border_image_frame_radius_offsetx_text" for="border_image_frame_radius_offsetx" class="col-md-6 control-label small">Offset-X:</label>';
g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="border_image_frame_radius_offsetx" class="image_frame_option" type="range" max="100" min="-100" step="5" value="0">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group image_frame" style="display:none;">';g+='\t\t\t\t\t<label id="border_image_frame_radius_offsety_text" for="border_image_frame_radius_offsety" class="col-md-6 control-label small">Offset-Y:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="border_image_frame_radius_offsety" class="image_frame_option" type="range" max="100" min="-100" step="5" value="0">';
g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group image_frame image_frame_oval" style="display:none;">';g+='\t\t\t\t\t<label id="border_image_frame_radius_width_text" for="border_image_frame_radius_width" class="col-md-6 control-label small">Width:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="border_image_frame_radius_width" class="image_frame_option" type="range" max="100" min="10" step="5" value="100">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";
g+='\t\t\t\t<div class="form-group image_frame image_frame_oval" style="display:none;">';g+='\t\t\t\t\t<label id="border_image_frame_radius_height_text" for="border_image_frame_radius_height" class="col-md-6 control-label small">Height:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="border_image_frame_radius_height" class="image_frame_option" type="range" max="100" min="10" step="5" value="100">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group border_image_radius_frame">';
g+='\t\t\t\t\t<label for="border_image_radius" class="col-md-6 text-left control-label small">Border Radius:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="border_image_radius" class="form-control" type="number" max="100" min="1" value="0" step="1" value="5">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+="\t\t\t</div>";g+="\t\t</div>";g+='\t\t<button title="Exit Border Mode" style="width:100%" class="btn btn-default exit_image_border_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Border Mode</span></button>';
g+="\t</div>";g+='\t<div id="shadow_image_div" class="" style="display:none;">';g+='\t\t<div class="panel panel-default">';g+='\t\t\t<div class="panel-body form-horizontal">';g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="shadow_image_status" class="col-md-7 control-label small">Shadow:</label>';g+='\t\t\t\t\t<div class="col-md-5">';g+='\t\t\t\t\t\t<select class="form-control small shadow_image" id="shadow_image_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';
g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label id="shadow_image_blur_text" for="shadow_image_blur" class="col-md-6 text-left control-label small">Blur:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="shadow_image_blur" class="shadow_image" type="range" max="50" min="0" step="2" value="10">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label id="shadow_image_offsetx_text" for="shadow_image_offsetx" class="col-md-6 text-left control-label small">Offset-X:</label>';
g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="shadow_image_offsetx" class="shadow_image" type="range" max="50" min="-50" step="2" value="10">';g+="\t\t\t\t\t\t</select>";g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label id="shadow_image_offsety_text" for="shadow_image_offsety" class="col-md-6 text-left control-label small">Offset-Y:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="shadow_image_offsety" class="shadow_image" type="range" max="50" min="-50" step="2" value="10">';
g+="\t\t\t\t\t\t</select>";g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="shadow_image_colorpicker" class="col-md-8 text-left control-label small">Color:</label>';g+='\t\t\t\t\t<div class="col-md-4">';g+='\t\t\t\t\t\t<input class="shadow_image colorpicker" id="shadow_image_colorpicker"/>';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+="\t\t\t</div>";g+="\t\t</div>";g+='\t\t<button title="Exit Shadow Mode" style="width:100%" class="btn btn-default exit_image_shadow_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Shadow Mode</span></button>';
g+="\t</div>";g+='\t<div id="grayscale_image_div" class="" style="display:none;">';g+='\t\t<div class="panel panel-default">';g+='\t\t\t<div class="panel-body form-horizontal">';g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label for="grayscale_image_status" class="col-md-7 control-label small">Grayscale:</label>';g+='\t\t\t\t\t<div class="col-md-5">';g+='\t\t\t\t\t\t<select class="form-control small grayscale_image" id="grayscale_image_status" ><option value="OFF">OFF</option><option value="ON">ON</option></select>';
g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+="\t\t\t</div>";g+="\t\t</div>";g+='\t\t<button title="Exit Grayscale Mode" style="width:100%" class="btn btn-default exit_image_grayscale_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Grayscale Mode</span></button>';g+="\t</div>";g+='\t<div id="opacity_image_div" class="" style="display:none;">';g+='\t\t<div class="panel panel-default">';g+='\t\t\t<div class="panel-body form-horizontal">';g+='\t\t\t\t<div class="form-group">';
g+='\t\t\t\t\t<label id="opacity_image_value_text" for="opacity_image_value" class="col-md-7 text-left control-label small">Opacity:</label>';g+='\t\t\t\t\t<div class="col-md-5">';g+='\t\t\t\t\t\t<input id="opacity_image_value" type="range" min="0" max="100" step="5" value="100">';g+="\t\t\t\t\t\t</select>";g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+="\t\t\t</div>";g+="\t\t</div>";g+='\t\t<button title="Exit Opacity Mode" style="width:100%" id="exit_image_opacity_mode" class="btn btn-default" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Opacity Mode</span></button>';
g+="\t</div>";g+='\t<div id="brightcon_image_div" class="" style="display:none;">';g+='\t\t<div class="panel panel-default">';g+='\t\t\t<div class="panel-body form-horizontal">';g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label id="brightness_image_value_text" for="brightness_image_value" class="col-md-6 text-left control-label small">Brightness:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="brightness_image_value" type="range" max="100" min="-100" step="5" value="0">';
g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+='\t\t\t\t<div class="form-group">';g+='\t\t\t\t\t<label id="contrast_image_value_text" for="contrast_image_value" class="col-md-6 text-left control-label small">Contrast:</label>';g+='\t\t\t\t\t<div class="col-md-6">';g+='\t\t\t\t\t\t<input id="contrast_image_value" type="range" min="-100" max="100" step="5" value="0">';g+="\t\t\t\t\t</div>";g+="\t\t\t\t</div>";g+="\t\t\t</div>";g+="\t\t</div>";g+='\t\t<button title="Exit Brightness-Contrast Mode" style="width:100%" class="btn btn-default exit_image_brightcon_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Brightness-Contrast Mode</span></button>';
g+="\t</div>";g+='\t<div id="flip_image_div" class="" style="display:none;">';g+='\t\t<button title="Flip horizontally" class="v-flip-image btn btn-default col-md-6"><img src="'+img_path+'flip-h.svg" width="20" height="20" alt=""/></button>';g+='\t\t<button title="Flip vertically" class="h-flip-image btn btn-default col-md-6"><img src="'+img_path+'flip-v.svg" width="20" height="20" alt=""/></button>';g+='\t\t<button title="Exit Flip Mode" style="width:100%" class="btn btn-default exit_flip_mode" type="button"><span style="font-size: 70%; font-weight:bold;">Exit Flip Mode</span></button>';
g+="\t</div>";g+="</div>";var Za="",Hb=function(){var a=f.getActiveObjects();1===a.length?(Za="single",r(a[0])):(Za="multi",p())};f.on({"selection:updated":Hb,"selection:created":Hb});loadMenuValues=function(a){if("Textbox"==Q)$("#font_text_fontsize").val(a.fontSize),$("#font_text_color_colorpicker").spectrum("set",a.fill),$("#font_text_textalign").val(a.textAlign),$("#font_text_fontstyle").val(a.fontStyle),$("#font_text_fontweight").val(a.fontWeight),"italic"==a.fontStyle&&"bold"==a.fontWeight?$("#font_text_fontfamily").val(a.fontFamily+
":bolditalic"):"normal"==a.fontStyle&&"bold"==a.fontWeight?$("#font_text_fontfamily").val(a.fontFamily+":bold"):"italic"==a.fontStyle&&"normal"==a.fontWeight?$("#font_text_fontfamily").val(a.fontFamily+":italic"):$("#font_text_fontfamily").val(a.fontFamily),$("#font_text_textdecoration").val(a.textDecoration),$("#font_text_fontlineheight").val(a.lineHeight),$("#font_text_fontlineheight_text").html("Line Height:&nbsp;&nbsp;"+a.lineHeight),$("#font_text_fontstroke_colorpicker").spectrum("set",a.stroke),
$("#font_text_fontstrokewidth").val(a.strokeWidth),$("#font_text_fontstrokewidth_text").html("Stroke Width:&nbsp;&nbsp;"+a.strokeWidth),a.shadow&&($("#shadow_text_status").val("ON"),$("#shadow_text_blur").val(a.shadow.blur),$("#shadow_text_offsetx").val(a.shadow.offsetX),$("#shadow_text_offsety").val(a.shadow.offsetY),$("#shadow_text_colorpicker").spectrum("set",a.shadow.color),wa("text",a.shadow)),$("#opacity_text_value").val(a.opacity/.01),$("#opacity_text_value_text").html("Opacity:&nbsp;&nbsp;"+
a.opacity/.01);else if("CzImage"==Q){0==a.strokeWidth&&null!=a.frame_round_border?$("#border_image_size").val(a.my.strokeWidth):0==a.strokeWidth?$("#border_image_size").val(1):$("#border_image_size").val(a.strokeWidth);null!=a.frame_round_border?$("#border_image_colorpicker").spectrum("set",a.frame_round_border.stroke):a.stroke&&$("#border_image_colorpicker").spectrum("set",a.stroke);a.strokeDashArray&&$("#border_image_line_style").val($.isEmptyObject(a.strokeDashArray)?"solid":"dashed");a.my?($("#border_image_status").val(a.my.hasBorder),
$("#border_image_frame_style").val(a.my.frame_style),qb(a.my.frame_style),$("#border_image_frame_radius").val(a.my.radius),$("#border_image_frame_radius_offsetx").val(a.my.offsetx),$("#border_image_frame_radius_offsety").val(a.my.offsety),$("#border_image_frame_radius_width").val(a.my.oval_width),$("#border_image_frame_radius_height").val(a.my.oval_height),$("#border_image_radius").val(a.my.corner_radius),$("#border_image_colorpicker").val(a.my.stroke),Pa(a.my)):($("#border_image_status").val("OFF"),
Oa(!0));a.shadow&&($("#shadow_image_status").val("ON"),$("#shadow_image_blur").val(a.shadow.blur),$("#shadow_image_offsetx").val(a.shadow.offsetX),$("#shadow_image_offsety").val(a.shadow.offsetY),$("#shadow_image_colorpicker").spectrum("set",a.shadow.color),wa("image",a.shadow));a.my&&a.my.hasGrayscale&&"ON"==a.my.hasGrayscale?$("#grayscale_image_status").val("ON"):$("#grayscale_image_status").val("OFF");var b=0,c=la(a,"Brightness");null!=c&&(b=100*a.filters[c].brightness);$("#brightness_image_value").val(b);
va("brightness",b);b=0;c=la(a,"Contrast");null!=c&&(b=100*a.filters[c].contrast);$("#contrast_image_value").val(b);va("contrast",b);$("#opacity_image_value").val(a.opacity/.01);$("#opacity_image_value_text").html("Opacity:&nbsp;&nbsp;"+a.opacity/.01)}};f.on("object:scaling",function(a){a=f.getActiveObject();$(".all_menus").is(":visible")&&$(".all_menus").hide();xlimit=ylimit=30*q;a.scaleX>xlimit&&(a.scaleX=xlimit);a.scaleY>ylimit&&(a.scaleY=ylimit);xmin=ymin=.05*q;a.scaleX<xmin&&(a.scaleX=xmin);a.scaleY<
ymin&&(a.scaleY=ymin)});f.on("object:rotating",function(a){$(".all_menus").hide()});f.on("object:modified",function(a){a.target&&a.target._objects&&1===a.target._objects.length?t(f.getActiveObject()):a.target&&a.target._objects&&1<a.target._objects.length&&p();y=!0;D()});f.on("mouse:up",function(a){$(".all_menus").show();a.target&&a.target._objects&&1<a.target._objects.length?p():!cropping&&a.target&&a.target.type&&"single"===Za&&t(a.target)});f.on("object:moving",function(a){if($a)return $a=!1;if(!cropping){$(".all_menus").hide();
var b=a.target,c=b.getCenterPoint();0>c.x?b.left-=c.x:c.x>b.canvas.width&&(b.left-=c.x-b.canvas.width);0>c.y?b.top-=c.y:c.y>b.canvas.height&&(b.top-=c.y-b.canvas.height);na&&T&&a.target.set({left:Math.round((a.target.left-safe*q)/(M*q))*M*q+safe*q,top:Math.round((a.target.top-safe*q)/(M*q))*M*q+safe*q})}});var ab,bb,cb=!1,V,Ib,Jb,db=!1,$a=!1;f.on("mouse:down",function(a){$a=!0;if(cropping){if(f.getObjects().indexOf(a.target)!=J)return oa(),$(".all_menus").remove(),!1;V=f.getPointer(a.e);ab=V.x;bb=
V.y;f.on("mouse:move",function(b){if(cropping&&!cb&&(cb=!0,setTimeout(function(){cb=!1;V=f.getPointer(b.e);Ib=ab-V.x;Jb=bb-V.y;x.zoomBy(Ib,Jb,0);ab=V.x;bb=V.y},50),0==db)){var c=function(e){db=!1;f.off("mouse:move");f.off("mouse:up",c);P(!1,!0,!0)};f.on("mouse:up",c);db=!0}})}else a.target&&a.target.type||$(".all_menus").remove()});var ua=function(a){return 1<a?1:-1>a?-1:a},Vb=function(){f.forEachObject(function(a){"CzImage"===a.type&&(a.tempFilters&&a.tempFilters.length?a.tempFilters.map(function(b){"Brightness"===
b.type?a.filters.push(new fabric.Image.filters.Brightness({brightness:ua(b.brightness)})):"Contrast"===b.type?a.filters.push(new fabric.Image.filters.Contrast({contrast:ua(b.contrast)})):a.filters.push(new fabric.Image.filters.Grayscale)}):a.filters=[new fabric.Image.filters.Brightness({brightness:.01})],a.applyFilters())});f.renderAll()};fabric.Object.prototype.setControlsVisibility({tl:!1,mt:!1,tr:!1,ml:!1,mr:!1,bl:!0,mb:!1,br:!0,mtr:!1});var eb=new Image,ha=new Image,Kb=new fabric.Control({x:-.5,
y:.5,actionHandler:fabric.controlsUtils.rotationWithSnapping,cursorStyleHandler:function(){return"url("+rotationCursorSRC+"), default"},withConnection:!0,actionName:"rotate",render:function(a,b,c){a.save();eb.onload=function(){a.drawImage(eb,b-12.5,c-12.5,25,25)};eb.src=rotateSRC;a.restore()}}),hc=new fabric.Control({x:.5,y:.5,actionHandler:fabric.controlsUtils.changeWidth,cursorStyleHandler:function(){return"w-resize"},actionName:"resizing",render:function(a,b,c,e,d){ha.src=scale2SRC;ha.onload=function(){a.save();
a.translate(b,c);a.rotate(d.angle*Math.PI/180);a.translate(-b,-c);a.drawImage(ha,b-12.5,c-12.5,25,25);a.restore()}}}),ic=new fabric.Control({x:.5,y:.5,actionHandler:fabric.controlsUtils.scalingEqually,cursorStyleHandler:function(){return"se-resize"},render:function(a,b,c,e,d){ha.src=scale1SRC;ha.onload=function(){a.save();a.translate(b,c);a.rotate(d.angle*Math.PI/180);a.translate(-b,-c);a.drawImage(ha,b-12.5,c-12.5,25,25);a.restore()}}});fabric.Textbox.prototype.controls.bl=Kb;fabric.Textbox.prototype.controls.br=
hc;fabric.Image.prototype.controls.bl=Kb;fabric.Image.prototype.controls.br=ic;$("#add_text").click(function(a){a=new fabric.Textbox("Start Typing",{fontFamily:"Arial",fontSize:20,left:f.width/6,top:f.height/6,width:150,cornerSize:20,fill:"#000",padding:7,borderDashArray:[10,5],hasRotatingPoint:!1,type:"Textbox",originX:"center",originY:"center",scaleX:q,scaleY:q,lockScalingY:!1,stroke:"#000",strokeWidth:0,fontStyle:"normal",textDecoration:"normal",lineHeight:1,textAlign:"left",itemID:Na++});f.add(a).setActiveObject(a);
a.selectAll();a.enterEditing();a.hiddenTextarea.focus();a.stateProperties.push("borderDashArray","filters","my");a.saveState();y=ya=!0;D()});var Ta;$("#canvas_div").on("click",".delete_btn",function(a){if(!confirm("Are you sure you want to remove this?"))return!1;f.getActiveObjects().forEach(function(b){Ta=b;f.remove(b);U("remove",Ta);$(".all_menus").remove();removedObject=y=!0;D()});f.discardActiveObject()});var Va=sendObjectFront=!1;$("#canvas_div").on("click",".send_back",function(a){a=f.getActiveObject();
a=f.getObjects().indexOf(a)-1;a=f._objects[a];if(a.bottom&&1==a.bottom)return!1;f.getActiveObject().sendBackwards();Va=y=!0;D();Va=!1});$("#canvas_div").on("click",".bring_front",function(a){a=f.getActiveObject();a=f.getObjects().indexOf(a)+1;if((a=f._objects[a])&&a.bottom&&1==a.bottom)return!1;f.getActiveObject().bringForward();sendObjectFront=y=!0;D();sendObjectFront=!1});var W;$("#canvas_div").on("click",".crop_mode",function(a){$("#zoom_div").is(":visible")?oa():(f.item(J).lockMovementX=f.item(J).lockMovementY=
!0,f.item(J).lockScalingX=f.item(J).lockScalingY=!0,f.item(J).lockRotation=!0,f.item(J).setControlsVisibility({br:!1,bl:!1}),cropping=!0,W=J,$("#zoom_div, .image_menu_divs").toggle(),"square"==$("#border_image_frame_style").val()?$(".set_crop").removeAttr("disabled"):$(".set_crop").attr("disabled",!0))});$("#canvas_div").on("click",".set_crop",function(a){if($("#crop_div").is(":visible"))return $(this).attr("disabled",!0),!1;a=f.getActiveObject();var b=a.getScaledWidth(),c=a.getScaledHeight(),e=a.getBoundingRect(),
d=e.width,k=e.height,h=e.left;e=e.top;0!=a.angle?d='<div id="crop_parent" style="width:'+d+"px;height:"+k+"px;top:"+e+"px;left:"+h+'px; position:absolute;background:transparent;pointer-events:none;">\t<div id="crop_div" style="width:'+(.5*b+"px;height:"+.5*c+"px;top:"+c/2+"px;left:"+b/2+'px;pointer-events:auto;"></div></div>'):(d='<div id="crop_parent" style="width:'+b+"px;height:"+c+"px;top:"+a.top+"px;left:"+a.left+'px; position:absolute;background:transparent;pointer-events:none;">',d+='\t<div id="crop_div" style="width:'+
.5*b+"px;height:"+.5*c+"px;top:"+c/4+"px;left:"+b/4+'px;pointer-events:auto;"></div></div>');$("#canvas_div").append(d);$("#crop_div").resizable({handles:"n, e, s, w, nw, ne, sw,se",containment:"parent"});$("#crop_div").draggable({containment:"parent"});0!=a.angle&&$("#crop_div").rotate(a.angle,{x:"left",y:"top"});$(".crop_now").removeAttr("disabled");$(this).attr("disabled",!0)});$("#canvas_div").on("click",".align_horizontal_center",function(a){a=f.getActiveObject();var b=new fabric.Point(f.width/
2,a.getCenterPoint().y);a.setPositionByOrigin(b,"center","center");y=!0;D();f.renderAll();"activeSelection"===a.type?p():t(a)});$("#canvas_div").on("click",".align_vertical_center",function(a){a=f.getActiveObject();var b=new fabric.Point(a.getCenterPoint().x,f.height/2);a.setPositionByOrigin(b,"center","center");y=!0;D();f.renderAll();"activeSelection"===a.type?p():t(a)});$("#canvas_div").on("resize","#crop_div",function(a){a.stopPropagation()});$("#canvas_div").on("click",".crop_now",function(a){if(!$("#crop_div").is(":visible"))return $(".set_crop").removeAttr("disabled"),
$(".crop_now").attr("disabled",!0),!1;x.crop(!1,!1);$("#crop_parent").remove();$(".set_crop").removeAttr("disabled");$(".crop_now").attr("disabled",!0);croppedObject=y=!0;D()});var sa=!1;$("#canvas_div").on("click",".exit_crop_mode",function(a){P(!0,!0,!0);sa=!0});var jb,ka,ra=!1,ta=!1;$("#canvas_div").on("mousedown",".crop_btn",function(a){a=f.getActiveObject();if(a.width==a.cw&&a.height==a.ch&&this.width>=this.origWidth&&this.height>=this.origHeight&&!$(this).hasClass("zoom-in"))return!1;if(!ra){ka=
0;ta=!1;var b=$(this);jb=setInterval(function(){ta&&0<ka?ib():(ka++,b.hasClass("zoom-in")?x.zoomBy(0,0,10):b.hasClass("zoom-out")?x.zoomBy(0,0,-10):b.hasClass("arrow-left")?x.zoomBy(-5,0,0):b.hasClass("arrow-up")?x.zoomBy(0,-5,0):b.hasClass("arrow-down")?x.zoomBy(0,5,0):b.hasClass("arrow-right")&&x.zoomBy(5,0,0))},220);y=ra=!0}});$("#canvas_div").on("mouseup",".crop_btn",function(a){if(ra)if(0<ka)ib();else return ta=!0,!1});var Ea=!1;$("#canvas_div").on("click",".copy_object",function(a){a=f.getActiveObjects();
1===a.length?("CzImage"===a[0].type?lb(a[0]):"Textbox"===a[0].type&&f.add(kb(a[0])),Ea=y=!0,D()):(a.forEach(function(b){f.setActiveObject(b);"CzImage"===b.type?lb(b):"Textbox"===b.type&&f.add(kb(b));Ea=y=!0;D()}),$(".all_menus").remove(),a=new fabric.ActiveSelection(a,{canvas:f}),f.setActiveObject(a),f.requestRenderAll())});$("#canvas_div").on("click",".brightcon_image_btn",function(a){$("#brightcon_image_div").show();$("#bottom_image_menu_div").hide();$("#top_image_menu").css("visibility","hidden")});
$("#canvas_div").on("click",".flip_image_btn",function(a){$("#flip_image_div").show();$("#bottom_image_menu_div").hide();$("#top_image_menu").css("visibility","hidden")});$("#canvas_div").on("click",".v-flip-image",function(a){a=f.getActiveObject();a.set("flipX",!a.flipX);y=!0;D();f.renderAll()});$("#canvas_div").on("click",".h-flip-image",function(a){a=f.getActiveObject();a.set("flipY",!a.flipY);y=!0;D();f.renderAll()});$("#canvas_div").on("click",".exit_flip_mode",function(a){$("#flip_image_div").hide();
$("#bottom_image_menu_div").show();$("#top_image_menu").css("visibility","")});$("#canvas_div").on("change","#brightness_image_value",function(a){a=f.getActiveObjects();var b=Number($("#brightness_image_value").val());b=0===b?1:b;if(a=a.reduce(function(c,e){return"CzImage"===e.type?[].concat($jscomp.arrayFromIterable(c),[e]):c},[]))va("brightness",b),a.forEach(function(c){var e=la(c,"Brightness"),d=b/100;0!=b&&null==e?c.filters.push(new fabric.Image.filters.Brightness({brightness:d})):0!=b&&0<=e?
c.filters[e].brightness=d:c.filters.splice(e?e:0,1);c.applyFilters();y=!0;D()}),f.requestRenderAll()});$("#canvas_div").on("change","#contrast_image_value",function(a){a=f.getActiveObjects();var b=Number($("#contrast_image_value").val());if(a=a.reduce(function(c,e){return"CzImage"===e.type?[].concat($jscomp.arrayFromIterable(c),[e]):c},[]))va("contrast",b),a.forEach(function(c){console.log("apply contrast = ",c);var e=la(c,"Contrast"),d=b/100;0!=b&&null==e?c.filters.push(new fabric.Image.filters.Contrast({contrast:d})):
0!=b&&0<=e?c.filters[e].contrast=d:c.filters.splice(e?e:0,1);c.applyFilters();y=!0;D()}),f.requestRenderAll()});$("#canvas_div").on("click",".exit_image_brightcon_mode",function(a){$("#brightcon_image_div").hide();$("#bottom_image_menu_div").show();$("#top_image_menu").css("visibility","")});$("#canvas_div").on("click",".opacity_image_btn, .opacity_text_btn",function(a){var b;$(this).hasClass("opacity_image_btn")?b="image":$(this).hasClass("opacity_text_btn")&&(b="text");$("#opacity_"+b+"_div").show();
$("#bottom_"+b+"_menu_div").hide();$("#top_"+b+"_menu").css("visibility","hidden")});$("#canvas_div").on("change","#opacity_image_value,#opacity_text_value",function(a){a=f.getActiveObjects();if(1===a.length){a=a[0];var b=$(this).attr("id"),c;"opacity_image_value"==b?c="image":"opacity_text_value"==b&&(c="text");b=$("#opacity_"+c+"_value").val();$("#opacity_"+c+"_value_text").html("Opacity:&nbsp;&nbsp;"+b);a.set("opacity",.01*b);y=!0;D()}else 1<a.length&&a.forEach(function(e){var d=$("#opacity_image_value").val();
$("#opacity_image_value_text").html("Opacity:&nbsp;&nbsp;"+d);e.set("opacity",.01*d);y=!0;D()});f.renderAll()});$("#canvas_div").on("click","#exit_image_opacity_mode, #exit_text_opacity_mode",function(a){var b;a=$(this).attr("id");"exit_image_opacity_mode"==a?b="image":"exit_text_opacity_mode"==a&&(b="text");$("#opacity_"+b+"_div").hide();$("#bottom_"+b+"_menu_div").show();$("#top_"+b+"_menu").css("visibility","")});$("#canvas_div").on("click",".grayscale_image_btn",function(a){$("#grayscale_image_div").show();
$("#bottom_image_menu_div").hide();$("#top_image_menu").css("visibility","hidden")});$("#canvas_div").on("change","#grayscale_image_status",function(a){a=f.getActiveObjects();var b=$("#grayscale_image_status").val();if(a=a.reduce(function(c,e){return"CzImage"===e.type?[].concat($jscomp.arrayFromIterable(c),[e]):c},[]))a.forEach(function(c){"my"in c||(c.my={});if("ON"==b)"ON"!=c.my.hasGrayscale&&(c.my.hasGrayscale="ON",c.filters.push(new fabric.Image.filters.Grayscale));else{var e=la(c,"Grayscale");
c.my.hasGrayscale="OFF";c.filters.splice(e?e:0,1)}c.applyFilters();y=!0;D()}),f.requestRenderAll()});$("#canvas_div").on("click",".exit_image_grayscale_mode",function(a){$("#grayscale_image_div").hide();$("#bottom_image_menu_div").show();$("#top_image_menu").css("visibility","")});$("#canvas_div").on("click",".shadow_image_btn, .shadow_text_btn",function(a){var b;$(this).hasClass("shadow_image_btn")?b="image":$(this).hasClass("shadow_text_btn")&&(b="text");$("#shadow_"+b+"_div").show();$("#bottom_"+
b+"_menu_div").hide();$("#top_"+b+"_menu").css("visibility","hidden")});$("#canvas_div").on("change",".shadow_image, .shadow_text",function(a){var b;$(this).hasClass("shadow_image")?b="image":$(this).hasClass("shadow_text")&&(b="text");Nb(b);y=!0;D()});$("#canvas_div").on("click",".exit_image_shadow_mode, .exit_text_shadow_mode",function(a){var b;$(this).hasClass("exit_image_shadow_mode")?b="image":$(this).hasClass("exit_text_shadow_mode")&&(b="text");a=b;$("#shadow_"+a+"_div").hide();$("#bottom_"+
a+"_menu_div").show();$("#top_"+a+"_menu").css("visibility","")});$("#canvas_div").on("click",".border_image_btn, .font_text_btn",function(a){if($(this).hasClass("border_image_btn")){var b="border_image";var c="image"}else $(this).hasClass("font_text_btn")&&(b="font_text",c="text");$("#"+b+"_div").show();$("#bottom_"+c+"_menu_div").hide();$("#top_"+c+"_menu").css("visibility","hidden");"image"==c?(a=qa(),Pa(a)):"text"==c&&(a=ob(),nb(a))});$("#canvas_div").on("change",".font_option",function(a){a=
$(this).attr("id");var b;"font_text_fontsize"==a?b={fontSize:1}:"font_text_fontfamily"==a?b={fontFamily:1}:"font_text_color_colorpicker"==a?b={fill:1}:"font_text_textalign"==a?b={textAlign:1}:"font_text_fontlineheight"==a?b={lineHeight:1}:"font_text_fontstrokewidth"==a?b={strokeWidth:1}:"font_text_fontstroke_colorpicker"==a?b={stroke:1}:"font_text_fontstyle"==a?b={fontStyle:1}:"font_text_textdecoration"==a?b={textDecoration:1}:"font_text_fontweight"==a&&(b={fontWeight:1});a=f.getActiveObject();var c=
ob();nb(c);var e=Number($("#font_text_fontsize").val()),d=$("#font_text_fontfamily option:selected").css("font-family"),k=$("#font_text_color_colorpicker").spectrum("get").toRgbString(),h=$("#font_text_textalign").val(),m=$("#font_text_fontfamily option:selected").css("font-style"),u=$("#font_text_textdecoration").val(),z=$("#font_text_fontfamily option:selected").css("font-weight");"400"==z?z="normal":"700"==z&&(z="bold");var A=Number(c.lineHeight),F=$("#font_text_fontstroke_colorpicker").spectrum("get").toRgbString();
c=Number(c.strokeWidth);if(b.fontFamily||b.fontStyle||b.fontWeight)a.set("fontFamily",d),a.set("fontStyle",m),a.set("fontWeight",z);b.fontSize&&a.set("fontSize",e);b.fill&&a.set("fill",k);b.textAlign&&a.set("textAlign",h);b.textDecoration&&(a.set("textDecoration",u),a.normal&&delete a.normal,a.underline&&delete a.underline,a.overline&&delete a.overline,a.linethrough&&delete a.linethrough,"normal"!=u&&a.set(u,!0),a.dirty=!0);b.lineHeight&&a.set("lineHeight",A);b.stroke&&a.set("stroke",F);b.strokeWidth&&
a.set("strokeWidth",c);f.renderAll();t(a);y=!0;D()});$("#canvas_div").on("click","#exit_font_text_mode",function(a){$("#font_text_div").hide();$("#bottom_text_menu_div").show();$("#top_text_menu").css("visibility","")});$("#canvas_div").on("change","#border_image_status",function(a){R({stroke:1,strokeWidth:1,strokeDashArray:1,strokeLineJoin:1},!0)});$("#canvas_div").on("change.spectrum move.spectrum","#border_image_colorpicker",function(a){R({stroke:1,strokeLineJoin:1},!0)});$("#canvas_div").on("change",
"#border_image_size",function(a){R({strokeWidth:1},!0)});$("#canvas_div").on("change","#border_image_radius",function(a){R({strokeLineJoin:1},!0)});$("#canvas_div").on("change","#border_image_line_style",function(a){R({strokeDashArray:1},!0)});$("#canvas_div").on("change",".image_frame_option,#border_image_frame_style",function(a){a=$("#border_image_frame_style").val();qb(a);Oa(!0)});$("#canvas_div").on("click",".exit_image_border_mode",function(a){$("#border_image_div").hide();$("#bottom_image_menu_div").show();
$("#top_image_menu").css("visibility","")});var q;BigNumber.config({DECIMAL_PLACES:15});BigNumber.config({ROUNDING_MODE:BigNumber.ROUND_HALF_UP});BigNumber.config({ERRORS:!1});var fb;window.onresize=function(){fb&&clearTimeout(fb);fb=setTimeout(function(){Qa()},100)};var ca=new BigNumber(canvasWidth*numPages),E=10;$(".canvas-zoom-in, .canvas-zoom-out, .canvas-zoom-reset").click(function(a){if($(this).hasClass("canvas-zoom-in")){if(2==S)return!1;xa=.1;sb()}else if($(this).hasClass("canvas-zoom-out")){if(.2==
S)return!1;xa=-.1;sb()}else{if(1==S)return!1;Qa();S=1;$(".canvas-zoom-out,.canvas-zoom-in").removeAttr("disabled")}$(".zoom_status").text("Zoom Scale: "+S.toFixed(1)+"x")});var xa=0,S=1;$(".canvas-zoom-out,.canvas-zoom-in").removeAttr("disabled");var w,ya=removedObject=draggedAdded=croppedObject=!1,C=[],Aa=[];$("#add_photos").click(function(a){if($("#photos_div").is(":visible"))return!1;$("#photo_message").html("");$("#photos_folder").prop("selectedIndex",0);wb(thisPage)});$("#photos_folder").change(function(a){Ya("photos");
$(".image").remove();$("#thumbs").width("");a=$(this).val();$("#photo_message").html("");$.isNumeric(a)?wb(a):Qb(a)});var L=0,Ga=0;$(".panel").on("click",".close_option",function(a){a=$(this).attr("pnl");$("#"+a).hide();"background_div"==a?($(".background_thumb").remove(),$("#background_thumbs").width("")):"photos_div"==a?($(".image").remove(),$("#thumbs").width("")):"restore_div"==a&&($(".restore_thumb").remove(),$("#restore_thumbs").width(""))});var jc=["globalScale","grid_showing","grid","snap_grid",
"template"];$("#save").click(function(a){$("#save").attr("disabled",!0);y=!1;$("div.progress > div.progress-bar").css("width","0%");$("#load_status_div").show();Tb("saveData",300,[]);document.body.style.cursor="wait"});saveData=function(){function a(k,h){return"fontFamily"==k?h.replace(/"/g,""):h}$(".all_menus").remove();f.discardActiveObject();Pb();Ba();f.globalScale=q;f.grid_showing=T;f.grid=da;f.snap_grid=na;is_staff_page()||(f.template=thisTemplate);for(var b=f.toDataURL({format:"png",left:trim,
top:trim,width:f.width-2*trim,height:f.height-2*trim,quality:1,multiplier:200/(1/q*(f.width-trim))*4}),c=f.toDatalessJSON(jc),e=f.getObjects(),d=0;d<c.objects.length;d++)"Textbox"==c.objects[d].type&&(c.objects[d].text=e[d].text,c.objects[d].fontSize=e[d].fontSize,c.objects[d].fontFamily=e[d].fontFamily,c.objects[d].textAlign=e[d].textAlign,c.objects[d].lineHeight=e[d].lineHeight,c.objects[d].textDecoration=e[d].textDecoration);f.backgroundOpacity&&(c.backgroundOpacity=f.backgroundOpacity);c.backgroundImage&&
0===c.backgroundImage.src.indexOf("http")&&(c.backgroundImage.src=(new URL(c.backgroundImage.src)).pathname);c.objects&&$.each(c.objects,function(k,h){h.primarySrc&&0===h.primarySrc.indexOf("http")&&(h.primarySrc=(new URL(h.primarySrc)).pathname);h.src&&0===h.src.indexOf("http")&&(h.src=(new URL(h.src)).pathname)});e=null;e=is_staff_page()?{page_json_data:JSON.stringify(c,a),page_thumbnail:b,id:thisTemplate}:{page:thisPage,page_json_data:JSON.stringify(c,a),page_thumbnail:b,new_template:page_template_id?
1:0,page_template_id:thisTemplate};page_template_id=0;is_com_user_page()?req="/red/yrb_pges/sve_com_ajax":is_client_page()?req="/red/yrb_pges/sve_ajax":is_staff_page()&&(req="/templates/saveTemplate_ajax");$.ajax({url:req,data:e,type:"POST",dataType:"json",success:function(k){if(!check_login_ajax(k))return!1;k?$("#load_status_div").delay(5E3).fadeOut(1E3):alert("There was a problem saving. Please try again.");Sa();T&&ma();$("#load_status_div").hide();Ca=!1;clearInterval(Ab);zb();$("#save").removeAttr("disabled");
document.body.style.cursor="default";is_com_user_page()&&Lb&&window.open(base_url+"red/upload_ph/mng_pge_com/"+thisPage,"_self")},xhr:function(){var k=new window.XMLHttpRequest;k.upload.addEventListener("progress",function(h){h.lengthComputable&&(h=h.loaded/h.total*100,$("div.progress > div.progress-bar").css({width:h+"%"}),Ca?$("#load_status").html("Autosaving: "+Math.floor(h)+"% Complete"):$("#load_status").html(Math.floor(h)+"% Complete"))},!1);return k}})};(function(){var a="Arial;Calibri;Courier New;Myriad Pro;Delicious;Verdana;Georgia;Courier;Comic Sans MS;Impact;Monaco".split(";");
0<fonts.length?(a.push("Navajo:n4,i4,n7,i7"),WebFont.load({google:{families:fonts},classes:!1,active:function(){xb()},custom:{families:a}})):WebFont.load({custom:{families:a},classes:!1,active:function(){xb()}})})();fabric.Object.prototype.toObject=function(a){return function(){return fabric.util.object.extend(a.call(this),{my:this.my,borderDashArray:this.borderDashArray,padding:this.padding,_controlsVisibility:this._controlsVisibility,hasRotatingPoint:this.hasRotatingPoint,hasBorders:this.hasBorders,
lockScalingY:this.lockScalingY,cornerSize:this.cornerSize,frame_round_border:this.frame_round_border,name:this.name,imageID:this.imageID,graphic:this.graphic,panel:this.panel})}}(fabric.Object.prototype.toObject);var da=20,M=0,T=!1,na=!1;$(".nav").on("click","#change_grid",function(a){a.preventDefault();if($("#grid_settings_div").is(":visible"))return!0;$("#grid_settings_div").show()});$("#grid_settings_div").on("click","#update_grid",function(a){Xb()});$("#grid_settings_div").on("change","#show_grid",
function(a){"NO"==$(this).val()?$("#grid_options_div").hide():$("#grid_options_div").show()});if(is_com_user_page())var Lb=!1;var Ca=!1,Ab;setInterval(function(){Yb()},6E4);$(window).bind("beforeunload",function(){return"Did you save your work? Any changes will be lost."});Qa();var B=[],I=[],n=0,ia=!1,Da,N=[],X=[],O=[];$(".undo").click(function(){if(0>=n)n=0;else{f.discardActiveObject();var a=fa(B[n-1].itemID,"itemID","","");B[n].itemID!=B[n-1].itemID&&a&&0<n-2?n-=2:n--;obj=B[n];var b=!0;a&&"Removed"!=
O[n]||(f.add(obj),U("add",obj));-1!=$.inArray(O[n],["Added","Cloned"])&&0!=n&&(a=obj,f.remove(obj),U("remove",a),$(".all_menus").remove(),b=!1);b&&(obj.setOptions(JSON.parse(I[n])),obj.clipPath=N[n],obj.setCoords(),ia=!0,f.setActiveObject(obj),"CzImage"===obj.type&&(Bb(obj),"Cropped"==O[n]&&obj.rerender(null,null)),"SendBack"==X[n]?obj.bringForward():"SendFront"==X[n]&&obj.sendBackwards());y=!0;Ua()}});$(".redo").click(function(){if(!(n>=I.length-1)){f.discardActiveObject();var a=fa(B[n+1].itemID,
"itemID","","");B[n].itemID!=B[n+1].itemID&&a&&n+2<I.length-1?n+=2:n++;obj=B[n];var b=!0;a&&-1==$.inArray(O[n],["Added","Cloned"])||(f.add(obj),U("add",obj));"Removed"==O[n]&&(a=obj,f.remove(obj),U("add",a),$(".all_menus").remove(),b=!1);b&&(obj.setOptions(JSON.parse(I[n])),obj.clipPath=N[n],obj.setCoords(),ia=!0,f.setActiveObject(obj),"CzImage"===obj.type&&(Bb(obj),"Cropped"==O[n]&&obj.rerender(null,null)),"SendBack"==X[n]?obj.sendBackwards():"SendFront"==X[n]&&obj.bringForward());y=!0;Ua()}f.renderAll()});
$("#upload_photos").click(function(a){is_client_page()?($(".close_option").trigger("click"),window.open(base_url+"red/upload_ph/mng_pge/"+thisPage,"_blank")):is_com_user_page()?(Lb=!0,alert("Please wait while we save your file first."),$("#save").trigger("click")):is_staff_page()&&($(".close_option").trigger("click"),window.open(base_url+"red/upload_ph/mng_pge/"+thisTemplate,"_blank"))});is_com_user_page()&&$("#goBack").click(function(a){$(location).attr("href",base_url+"/red/yrb_pges/list_com")});
var Fa=0;$(".nav").on("click","#restore_page",function(a){a.preventDefault();if($("#restore_div").is(":visible"))return!0;Zb();$("#restore_div").show()});$("#restore_div").on("click",".restore_thumb",function(a){a=$("img",this).attr("restore_id");if(!confirm("Are you sure you want to restore your page to this date?"))return!1;is_com_user_page()?$(location).attr("href",base_url+"red/yrb_pges/edt_pges_com/"+thisPage+"/"+a):is_client_page()?$(location).attr("href",base_url+"red/yrb_pges/edt_pges/"+thisPage+
"/"+a):is_staff_page()&&$(location).attr("href",base_url+"templates/page_templates/"+thisTemplate+"/"+a)});$("#add_clipart").click(function(a){a.preventDefault();if($("#clipart_div").is(":visible"))return!1;$("#clipart_folder").prop("selectedIndex",0);Wa("Clipart")});$("#clipart_folder").change(function(a){Ya("clipart");$(".clipart_thumb, .clipart_cat_search_link").remove();$("#clipart_thumbs").width("");$("#clipart_search_term").val("");if(""==$(this).val())return!1;a=$(this).val().split("|")[1];
Xa(a,"Clipart")});$(".image_search").click(function(a){a=$(this).attr("cat");var b=a.toLowerCase(),c=$("#"+b+"_search_term").val();if(""==c)return!1;Ya("clipart");$("."+b+"_thumb, ."+b+"_cat_search_link, .graphic_"+b+"_thumb").remove();$("#"+b+"_thumbs").width("");$("#"+b+"_folder").val("");ac(a,c)});$("#clipart_thumbs").on("click",".clipart_cat_search_link",function(a){a=$(this).attr("category");$("#clipart_folder").val(a).change()});$("#border_thumbs").on("click",".border_cat_search_link",function(a){a=
$(this).attr("category");$("#border_folder").val(a).change()});$("#background_thumbs").on("click",".background_cat_search_link",function(a){a=$(this).attr("category");$("#background_folder").val(a).change()});$("#add_page_border").click(function(a){a.preventDefault();if($("#border_div").is(":visible"))return!1;$("#border_folder").prop("selectedIndex",0);$(".border_thumb").remove();Wa("Border")});$("#border_folder").change(function(a){$(".border_thumb, .border_cat_search_link").remove();$("#border_thumbs").width("");
$("#border_search_term").val("");if(""==$(this).val())return!1;a=$(this).val().split("|")[1];Xa(a,"Border")});$("#border_div").on("click",".border_thumb",function(a){var b=$(this).attr("image_id"),c=$("img",this).attr("src")+"/1";$("#remove_border").after('<span id="border_loading_gif"><br><i style="font-size: 1.5em;" class="fa fa-spinner fa-pulse fa-fw"></i> The border is loading...</span>');var e=f.item(0);if("border"==e.graphic){var d=new Image;d.onload=function(){e.setElement(d);e.set({src:c,
primarySrc:c,imageID:b});f.renderAll();$("#border_loading_gif").remove();$(".brdr_used").each(function(k,h){$(this).hasClass("yellow")||$(this).remove()});U("add",{imageID:b,graphic:"border"})};d.src=c}else x.init(c,{x:0,y:0,scalex:1,scaley:1,scale:q,imageID:b,graphic:"border",evented:!1,group_photo:null});y=!0;D()});$("#border_div").on("click","#remove_border",function(a){a=f.item(0);"border"==a.graphic&&(f.remove(a),$(".brdr_used").each(function(b,c){$(this).hasClass("yellow")||$(this).remove()}),
y=!0,D())});$("#add_background").click(function(a){a.preventDefault();if($("#background_div").is(":visible"))return!1;$("#background_folder").prop("selectedIndex",0);$(".background_thumb").remove();Wa("Background")});is_com_user_page()&&$("#faq").click(function(a){a.preventDefault();if($("#faq_div").is(":visible"))return!1;$("#faq_div").show()});$("#background_folder").change(function(a){$(".background_thumb, .background_cat_search_link").remove();$("#background_thumbs").width("");$("#background_search_term").val("");
if(""==$(this).val())return!1;"solid"==$(this).val()?cc():(a=$(this).val().split("|")[1],Xa(a,"Background"))});$("#background_div").on("click",".background_thumb",function(a){if($(this).hasClass("color"))f.setBackgroundImage(null,f.renderAll.bind(f)),a=Fb($(this).css("background-color"),$("#background-opacity").val()/100),f.setBackgroundColor(a,f.renderAll.bind(f)),$(".bg_used").remove(),html='<div title="Color Used" class="bg_used" style="position:absolute;bottom:0px;right:0px;"><img style="height:30px; width:30px;" class="check_mark" src="'+
img_path+'green_check_circle.png"></div>',$(this).append(html);else{var b=$(this).attr("image_id");f.setBackgroundColor("",f.renderAll.bind(f));a=$("img",this).attr("src")+"/1";var c=new Image;c.onload=function(){f.setBackgroundImage(c.src,f.renderAll.bind(f),{originX:"left",originY:"top",left:0,top:0,width:f.width,height:f.height});$(".bg_used").remove();U("add",{imageID:b,graphic:"background"});$("#background_loading_gif").remove()};$("#remove_background").after('<span id="background_loading_gif"><br><i style="font-size: 1.5em;" class="fa fa-spinner fa-pulse fa-fw"></i> The background is loading...</span>');
c.src=a}y=!0});$("#background_div").on("click","#remove_background",function(a){f.setBackgroundColor("",f.renderAll.bind(f));f.setBackgroundImage(null,f.renderAll.bind(f));f.backgroundOpacity=100;$("#background-opacity").val(100);$(".bg_used").remove();y=!0});var Ha=0;$(".nav").on("click","#add_template",function(a){a.preventDefault();if($("#template_div").is(":visible"))return!0;dc();$("#template_div").show()});$("#template_category").change(function(a){$(".template_thumb").remove();$("#template_thumbs").width("");
if(""==$(this).val())return!1;a=$(this).val().split("|")[1];ec(a)});$("#template_div").on("click",".template_thumb",function(a){a=$(this).attr("image_id");if(!confirm("Are you sure you want to use this template? Your current page will be erased and replaced with the template."))return!1;is_com_user_page()?$(location).attr("href",base_url+"red/yrb_pges/edt_pges_com/"+thisPage+"/0/"+a):$(location).attr("href",base_url+"red/yrb_pges/edt_pges/"+thisPage+"/0/"+a)});$(".print_draft").click(function(a){Ba();
a=f.toDataURL({format:"jpg",left:trim,top:trim,width:f.width-2*trim+1,height:f.height-2*trim+1,quality:1,multiplier:1});T&&ma();(new Image).src=a;a='<img src="'+a+'" width="100%">';var b=window.open();b.document.open();b.document.write(a);b.document.close()});$("#loading").show();$("#add_photo_to_canvas").on("click",function(a){if(Eb("photos")&&w){a=$(w).attr("im_id");var b=$(w).attr("graphic")?$(w).attr("graphic"):null,c=$(w).attr("group_photo")?$(w).attr("group_photo"):null;x.init(w.src,{x:30,y:30,
scalex:1,scaley:1,scale:q,imageID:a,graphic:b,evented:!0,group_photo:c});Db()}else alert("No photo selected!")});$("#add_clipart_to_canvas").on("click",function(a){if(Eb("clipart")&&w){a=$(w).attr("im_id");var b=$(w).attr("graphic")?$(w).attr("graphic"):null,c=$(w).attr("group_photo")?$(w).attr("group_photo"):null;x.init(w.src,{x:30,y:30,scalex:1,scaley:1,scale:q,imageID:a,graphic:b,evented:!0,group_photo:c});Db()}else alert("No asset selected!")});$("#add_placeholder").click(function(a){$("#plc_div").show()});
$("#aspect_ratio_select").change(function(){"custom"==$(this).val()?$(".custom_ratio_div").show():$(".custom_ratio_div").hide()});$("#add_plc_to_canvas").click(function(a){var b=$("#aspect_ratio_select").val(),c=400,e=400;"custom"==b?(a=$("#aspect_width").val(),b=$("#aspect_height").val()):(a=parseInt(b.split(":")[0]),b=parseInt(b.split(":")[1]));var d=200*q,k=b/a;a>=b?e=c*b/a:c=e*a/b;x.init(.6>=k?"/fe/assets/images/placeholder/placeholder_16_9.png":.7>=k?"/fe/assets/images/placeholder/placeholder_4_3.png":
.77>=k?"/fe/assets/images/placeholder/placeholder_5_4.png":.9>=k?"/fe/assets/images/placeholder/placeholder_3_2.png":1.1>=k?"/fe/assets/images/placeholder/placeholder_1_1.png":1.28>=k?"/fe/assets/images/placeholder/placeholder_4_5.png":1.41>=k?"/fe/assets/images/placeholder/placeholder_3_4.png":1.65>=k?"/fe/assets/images/placeholder/placeholder_2_3.png":"/fe/assets/images/placeholder/placeholder_9_16.png",{x:d,y:d,scalex:1,scaley:1,width:c,height:e,scale:q,imageID:null,graphic:null,evented:!0,group_photo:null});
y=!0;D()});$("#background-opacity").change(function(a){if(f.backgroundImage||f.backgroundColor){var b=parseInt(a.target.value);0>b?b=0:100<b&&(b=100);f.backgroundImage&&(f.backgroundImage.opacity=b/100);f.backgroundColor&&(f.backgroundColor=Fb(f.backgroundColor,b/100));f.backgroundOpacity=b;a.target.value=b;f.renderAll()}});$(".background-vertical-flip").click(function(a){f.backgroundImage&&(f.backgroundImage.set("flipX",!f.backgroundImage.flipX),f.renderAll())});$(".background-horizontal-flip").click(function(a){f.backgroundImage&&
(f.backgroundImage.set("flipY",!f.backgroundImage.flipY),f.renderAll())});$("#border-opacity").change(function(a){var b=f.item(0);if(b&&"border"==b.graphic){var c=parseInt(a.target.value);0>c?c=0:100<c&&(c=100);b.opacity=c/100;a.target.value=c;f.renderAll()}});$(".border-vertical-flip").click(function(a){(a=f.item(0))&&"border"==a.graphic&&(a.set("flipX",!a.flipX),f.renderAll())});$(".border-horizontal-flip").click(function(a){(a=f.item(0))&&"border"==a.graphic&&(a.set("flipY",!a.flipY),f.renderAll())})});
